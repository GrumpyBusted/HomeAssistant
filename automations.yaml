- id: '1735603602121'
  alias: Stue lys
  description: Automatik til at styre lys i stuen
  triggers:
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    attribute: event_type
    to: short_release
    id: button_1_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    attribute: event_type
    to: long_release
    id: button_1_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_2
    attribute: event_type
    to: short_release
    id: button_2_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_2
    attribute: event_type
    to: long_release
    id: button_2_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_3
    attribute: event_type
    to: short_release
    id: button_3_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_3
    attribute: event_type
    to: long_release
    id: button_3_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_4
    attribute: event_type
    to: short_release
    id: button_4_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_4
    attribute: event_type
    to: long_release
    id: button_4_long
  - trigger: state
    entity_id:
    - event.living_room_switch_rotary
    id: rotary
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - binary_sensor.living_room_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_strip_skylight
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
    - conditions:
      - condition: trigger
        id:
        - button_2_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 100
        target:
          entity_id:
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.living_room_light_strip_skylight
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 75
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.living_room_light_tv_left
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
    - conditions:
      - condition: trigger
        id:
        - button_3_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2100
          brightness_pct: 80
        target:
          entity_id:
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_skylight
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
    - conditions:
      - condition: trigger
        id:
        - button_4_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_skylight
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id:
          - button_1_long
          - button_2_long
          - button_3_long
          - button_4_long
          - no_one_home
        - condition: and
          conditions:
          - condition: trigger
            id:
            - lights_on
          - condition: state
            entity_id: binary_sensor.someone_home
            state: 'off'
        - condition: and
          conditions:
          - condition: trigger
            id:
            - sleeping
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_skylight
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
    - conditions:
      - condition: trigger
        id:
        - rotary
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: event.living_room_switch_rotary
            attribute: event_type
            state: clock_wise
          sequence:
          - action: script.living_room_light_rotary
            data:
              step: '{{ (state_attr(''event.living_room_switch_rotary'', ''steps'')|float
                / 3.60)|round(0) }}'
        default:
        - action: script.living_room_light_rotary
          data:
            step: '{{ (state_attr(''event.living_room_switch_rotary'', ''steps'')|float
              / -3.60)|round(0) }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1735658670560'
  alias: Indkørsel billader lås op
  description: Hvis en af bilerne er hjemme og tilsluttet, lås billaderen op
  triggers:
  - trigger: state
    entity_id:
    - sensor.driveway_ev_charger_status_description
    to: Locked, car connected
  - trigger: state
    entity_id:
    - device_tracker.volvo_ex30_location
    to: home
  - trigger: state
    entity_id:
    - device_tracker.volvo_xc40_location
    to: home
  - trigger: state
    entity_id:
    - sensor.volvo_ex30_charging_connection_status
    to:
    - connected
  - trigger: state
    entity_id:
    - sensor.volvo_xc40_charging_connection_status
    to:
    - connected
  conditions:
  - condition: state
    entity_id: sensor.driveway_ev_charger_status_description
    state: Locked, car connected
  actions:
  - if:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: device_tracker.volvo_ex30_location
          state: home
        - condition: state
          entity_id: sensor.volvo_ex30_charging_connection_status
          state: connected
      - condition: and
        conditions:
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        - condition: state
          entity_id: sensor.volvo_xc40_charging_connection_status
          state: connected
    then:
    - action: lock.unlock
      metadata: {}
      data: {}
      target:
        entity_id: lock.driveway_ev_charger_lock
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1735725983183'
  alias: Garage lys
  description: Automatik til at styre lys i garage
  triggers:
  - trigger: state
    entity_id:
    - event.garage_switch_button_1
    id: button_1
  - trigger: state
    entity_id:
    - event.garage_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.garage_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.garage_switch_button_4
    id: button_4
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - lock.garage_door
    to: locked
    id: door_locked
  - trigger: state
    entity_id:
    - lock.garage_door
    to: unlocked
    id: door_unlocked
  - trigger: state
    entity_id:
    - binary_sensor.garage_door_sensor_opening
    from: 'off'
    to: 'on'
    id: door_opened
  - trigger: state
    entity_id:
    - binary_sensor.garage_door_sensor_opening
    from: 'on'
    to: 'off'
    id: door_closed
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.garage_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_main
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_spots
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_projector
    - conditions:
      - condition: trigger
        id:
        - door_opened
        - door_unlocked
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_main
    - conditions:
      - condition: trigger
        id:
        - door_locked
        - no_one_home
        - sleeping
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.garage_lights
    - conditions:
      - condition: trigger
        id:
        - door_closed
      - condition: state
        entity_id: lock.garage_door
        state: locked
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.garage_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1735738251165'
  alias: Stue varmepumpe
  description: Styring af varmepumpe i stuen, for at varme hurtigere op hvis den ønskede
    temperatur er væsentligt koldere end den aktuelle.
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_target_temperature
  - trigger: state
    entity_id: sensor.living_room_current_temperature
    for:
      minutes: 1
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float(21)
          < states("sensor.living_room_target_temperature")|float(21) - 1 }}'
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'off'
      - condition: state
        entity_id: climate.living_room_heat_pump
        state: 'off'
      sequence:
      - action: climate.turn_on
        target:
          entity_id: climate.living_room_heat_pump
        data: {}
      - action: climate.set_temperature
        target:
          entity_id: climate.living_room_heat_pump
        data:
          temperature: '{{ states(''sensor.living_room_target_temperature'')|float(21)
            }}'
      - action: climate.set_hvac_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          hvac_mode: heat
      - action: climate.set_fan_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          fan_mode: Auto
      - action: climate.set_swing_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          swing_mode: Auto
    - conditions:
      - condition: or
        conditions:
        - condition: template
          value_template: '{{ states("sensor.living_room_current_temperature")|float(21)
            > states("sensor.living_room_target_temperature")|float(21) - 0.5 }}'
        - condition: state
          entity_id: binary_sensor.someone_home
          state: 'off'
        - condition: state
          entity_id: binary_sensor.everyone_sleeping
          state: 'on'
      - condition: state
        entity_id: climate.living_room_heat_pump
        state: heat
      sequence:
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.living_room_heat_pump
      - action: climate.set_preset_mode
        metadata: {}
        data:
          preset_mode: none
        target:
          entity_id: climate.living_room_heat_pump
  - if:
    - condition: state
      entity_id: climate.living_room_heat_pump
      state: heat
    then:
    - if:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float(21)
          < states("sensor.living_room_target_temperature")|float(21) - 1.5 }}'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: binary_sensor.everyone_sleeping
            attribute: preset_mode
            state: boost
        then:
        - action: climate.set_preset_mode
          metadata: {}
          data:
            preset_mode: boost
          target:
            entity_id: climate.living_room_heat_pump
      else:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: binary_sensor.everyone_sleeping
            attribute: preset_mode
            state: none
        then:
        - action: climate.set_preset_mode
          metadata: {}
          data:
            preset_mode: none
          target:
            entity_id: climate.living_room_heat_pump
  mode: restart
  trace:
    stored_traces: 100
- id: '1735743298155'
  alias: Hjem varmepumpe
  description: Automatik til styring af central luft-til-vand varmepumpe
  triggers:
  - trigger: time_pattern
    minutes: /15
  - trigger: state
    entity_id:
    - sensor.living_room_target_temperature
    - sensor.emils_room_target_temperature
    - sensor.charlies_room_target_temperature
    - sensor.bedroom_target_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.home_indoor_minimum_temperature_24h
        below: 20
      - condition: numeric_state
        entity_id: sensor.home_outside_minimum_temperature_24h
        below: 10
      - condition: numeric_state
        entity_id: sensor.home_outside_maximum_temperature_24_timer
        below: 15
      sequence: []
    - conditions:
      - condition: numeric_state
        entity_id: sensor.home_indoor_minimum_temperature_24h
        above: 20
      - condition: numeric_state
        entity_id: sensor.home_outside_minimum_temperature_24h
        above: 11
      - condition: numeric_state
        entity_id: sensor.home_outside_average_temperature_24h
        above: 16
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float
          < states("sensor.living_room_target_temperature")|float - 3 or states("sensor.emils_room_current_temperature")|float
          < states("sensor.emils_room_target_temperature")|float - 3 or states("sensor.charlies_room_current_temperature")|float
          < states("sensor.charlies_room_target_temperature")|float - 3 or states("sensor.bedroom_current_temperature")|float
          < states("sensor.bedroom_target_temperature")|float - 3 }}'
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float
          < states("sensor.living_room_target_temperature")|float - 1 or states("sensor.emils_room_current_temperature")|float
          < states("sensor.emils_room_target_temperature")|float - 1 or states("sensor.charlies_room_current_temperature")|float
          < states("sensor.charlies_room_target_temperature")|float - 1 or states("sensor.bedroom_current_temperature")|float
          < states("sensor.bedroom_target_temperature")|float - 1 }}'
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float
          < states("sensor.living_room_target_temperature")|float - 0.5 or states("sensor.emils_room_current_temperature")|float
          < states("sensor.emils_room_target_temperature")|float - 0.5 or states("sensor.charlies_room_current_temperature")|float
          < states("sensor.charlies_room_target_temperature")|float - 0.5 or states("sensor.bedroom_current_temperature")|float
          < states("sensor.bedroom_target_temperature")|float - 0.5 }}'
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float
          > states("sensor.living_room_target_temperature")|float - 0.5 and states("sensor.emils_room_current_temperature")|float
          > states("sensor.emils_room_target_temperature")|float - 0.5 and states("sensor.charlies_room_current_temperature")|float
          > states("sensor.charlies_room_target_temperature")|float - 0.5 and states("sensor.bedroom_current_temperature")|float
          > states("sensor.bedroom_target_temperature")|float - 0.5 }}'
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.living_room_current_temperature")|float
          > states("sensor.living_room_target_temperature")|float and states("sensor.emils_room_current_temperature")|float
          > states("sensor.emils_room_target_temperature")|float and states("sensor.charlies_room_current_temperature")|float
          > states("sensor.charlies_room_target_temperature")|float and states("sensor.bedroom_current_temperature")|float
          > states("sensor.bedroom_target_temperature")|float }}'
      sequence: []
  mode: queued
  max: 10
- id: '1735842629315'
  alias: Entre dør lås
  description: Automatik til at låse hoveddøren op og i baseret på hvem der er hjemme
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.anders_home
    from: 'off'
    to: 'on'
    id: anders_home
  - trigger: state
    entity_id:
    - binary_sensor.monique_home
    from: 'off'
    to: 'on'
    id: monique_home
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_home
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'off'
    to: 'on'
    id: charlie_home
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.entrance_door_locking_timer
    to: idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.entrance_door
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - anders_home
      - condition: state
        entity_id: lock.entrance_door
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_anders'') }}'
        target:
          entity_id: lock.entrance_door
    - conditions:
      - condition: trigger
        id:
        - monique_home
      - condition: state
        entity_id: lock.entrance_door
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_monique'') }}'
        target:
          entity_id: lock.entrance_door
    - conditions:
      - condition: trigger
        id:
        - emil_home
      - condition: state
        entity_id: lock.entrance_door
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_emil'') }}'
        target:
          entity_id: lock.entrance_door
    - conditions:
      - condition: trigger
        id:
        - charlie_home
      - condition: state
        entity_id: lock.entrance_door
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_charlie'') }}'
        target:
          entity_id: lock.entrance_door
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.entrance_door
        state:
        - unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.entrance_door
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.entrance_door_locking_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.entrance_door
        state:
        - unlocked
      sequence:
      - variables:
          persons:
          - device: notify.mobile_app_anders_iphone
            sensor: sensor.anders_distance_from_home
          - device: notify.mobile_app_monique_iphone
            sensor: sensor.monique_distance_from_home
          - device: notify.mobile_app_emil_iphone
            sensor: sensor.emil_distance_from_home
          - device: notify.mobile_app_charlie_iphone
            sensor: sensor.charlie_distance_from_home
          notify_persons: "{% set ns = namespace(list=[]) %} {% for person in persons
            %}\n  {% set distance = states(person.sensor) | float %}\n  {% set ns.list
            = ns.list + [{'device': person.device, 'distance': distance}] %}\n{% endfor
            %}  {% set notify_persons = ns.list | selectattr('distance', 'lt', 0.2)
            | list %}  {% if notify_persons | count == 0 %}\n  {% set first_distance
            = ((ns.list | sort(attribute='distance'))[0]).distance | float %}\n  {%
            set notify_persons = ns.list | selectattr('distance', 'lt', first_distance
            + 2.0) | list %}\n{% endif %} {{ notify_persons | map(attribute='device')
            | list }}"
          title: Advarsel
          message: Hoveddøren kunne ikke låses automatisk!
      - action: persistent_notification.create
        data:
          title: '{{ title }}'
          message: '{{ message }}'
          notification_id: entrance_door_auto_lock_warning
      - repeat:
          for_each: '{{ notify_persons }}'
          sequence:
          - action: '{{ repeat.item }} '
            data:
              title: '{{ title }}'
              message: '{{ message }}'
              data:
                push:
                  sound:
                    name: default
                    critical: 1
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1735847242174'
  alias: Terrasse lys
  description: Automatik til at styre lys på terrassen
  triggers:
  - trigger: state
    entity_id:
    - event.patio_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.patio_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.patio_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.patio_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.patio_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.patio_door
    from: 'off'
    to: 'on'
    id: door_opened
  - trigger: state
    entity_id:
    - lock.patio_door
    to: locked
    id: door_locked
  - trigger: state
    entity_id: binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.patio_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: state
    entity_id:
    - input_select.patio_light_scene
    to:
    - Jul
    id: christmas_scene
  - trigger: state
    entity_id:
    - input_select.patio_light_scene
    to:
    - Auto
    id: auto_scene
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 60
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: 10
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: -10
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          brightness_pct: 40
          rgb_color:
          - 253
          - 160
          - 83
        target:
          entity_id:
          - light.patio_light_dining_table
          - light.patio_light_sofa
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          brightness_pct: 40
          rgb_color:
          - 240
          - 106
          - 92
        target:
          entity_id:
          - light.patio_light_main
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          brightness_pct: 40
          rgb_color:
          - 199
          - 83
          - 253
        target:
          entity_id:
          - light.patio_light_bar
    - conditions:
      - condition: trigger
        id:
        - door_opened
      - condition: state
        entity_id: binary_sensor.patio_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 60
        target:
          entity_id:
          - light.patio_light_main
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - door_locked
        - sleeping
        - auto_scene
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - lights_on
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.home_outside_current_temperature
          below: 15
        - condition: state
          entity_id: binary_sensor.someone_home
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 0
        target:
          entity_id: light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - christmas_scene
      sequence:
      - action: scene.turn_on
        metadata: {}
        target:
          entity_id: scene.patio_lys_christmas
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1735851968042'
  alias: Gang lys
  description: Automatik til at styre lys i gangen
  triggers:
  - trigger: state
    entity_id:
    - event.hallway_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.hallway_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.hallway_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.hallway_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.hallway_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.anders_home
    - binary_sensor.monique_home
    - binary_sensor.emil_home
    - binary_sensor.charlie_home
    - input_boolean.house_sitter
    from: 'off'
    to: 'on'
    id: someone_home
  - trigger: state
    entity_id:
    - binary_sensor.hallway_occupancy
    to:
    - 'off'
    id: person_cleared
    for:
      hours: 0
      minutes: 2
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.hallway_occupancy
    to: 'on'
    id: person_detected
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
    to: 'on'
    id: bedroom_sleeping
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
    to: 'off'
    id: bedroom_waking
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_door
    from: 'off'
    to: 'on'
    id: bedroom_door_open
  - trigger: state
    entity_id:
    - binary_sensor.hallway_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: 10
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: -10
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
        - no_one_home
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - lights_on
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - someone_home
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 25
        target:
          entity_id:
          - light.hallway_light_bathroom
          - light.hallway_light_toilet
    - conditions:
      - condition: trigger
        id:
        - someone_home
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - bedroom_door_open
        - bedroom_sleeping
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - bedroom_waking
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 120
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      sequence: []
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - person_cleared
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.hallway_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1735852365839'
  alias: Emils værelse lys
  description: Automatik til at styre lys på Emils værelse
  triggers:
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'on'
    to: 'off'
    id: emil_leaving
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_home
  - trigger: state
    entity_id:
    - binary_sensor.emils_room_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: time
    at: input_datetime.emil_bedtime_alarm
    id: bedtime
  - trigger: time
    at: input_datetime.emil_wake_up_alarm
    id: wake_up
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
        - emil_home
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'off'
      - condition: trigger
        id:
        - button_2
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 60
          color_temp_kelvin: 2300
          brightness: 10
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: 10
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: -10
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - emil_leaving
        - lights_on
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 60
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - bedtime
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'on'
      - condition: numeric_state
        entity_id: light.emils_room_lights
        attribute: brightness
        above: 30
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 10
          brightness: 30
        target:
          entity_id:
          - light.emils_room_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736082177257'
  alias: Charlies værelse lys
  description: Automatik til at styre lys på Charlies værelse
  triggers:
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_2
    id: button_2_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_3
    id: button_3
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'on'
    to: 'off'
    id: charlie_leaving
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'off'
    to: 'on'
    id: charlie_home
  - trigger: state
    entity_id:
    - binary_sensor.charlies_room_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: time
    at: input_datetime.charlie_bedtime_alarm
    id: bedtime
  - trigger: time
    at: input_datetime.charlie_wake_up_alarm
    id: wake_up
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - parallel:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.charlies_room_smart_plug_string_lights
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            brightness_pct: 80
          target:
            entity_id:
            - light.charlies_room_light_desk_right
            - light.charlies_room_light_desk_mid
            - light.charlies_room_light_desk_left
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - parallel:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.charlies_room_smart_plug_string_lights
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            brightness_pct: 100
          target:
            entity_id:
            - light.charlies_room_light_desk_right
            - light.charlies_room_light_desk_mid
            - light.charlies_room_light_desk_left
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            color_temp_kelvin: 2700
            brightness_pct: 100
          target:
            entity_id:
            - light.charlies_room_light_dresser
            - light.charlies_room_light_bed_lamp
    - conditions:
      - condition: trigger
        id:
        - button_2_short
      sequence:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          brightness_pct: 80
        target:
          entity_id:
          - light.charlies_room_light_desk_right
          - light.charlies_room_light_desk_mid
          - light.charlies_room_light_desk_left
    - conditions:
      - condition: trigger
        id:
        - button_2
      - condition: state
        entity_id: event.charlies_room_switch_button_2
        attribute: event_type
        state: repeat
      sequence:
      - action: script.charlies_room_light_desk_adjust
        metadata: {}
        data:
          brightness_step: 25
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.charlies_room_smart_plug_string_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.charlies_room_lights
    - conditions:
      - condition: trigger
        id:
        - charlie_leaving
        - lights_on
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.charlies_room_lights
    - conditions:
      - condition: trigger
        id:
        - charlie_home
        - wake_up
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        target:
          entity_id: light.charlies_room_smart_plug_string_lights
        data: {}
    - conditions:
      - condition: trigger
        id:
        - bedtime
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 10
        target:
          entity_id:
          - light.charlies_room_light_desk_left
          - light.charlies_room_light_desk_mid
          - light.charlies_room_light_desk_right
          - light.charlies_room_light_dresser
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736083584615'
  alias: Soveværelse lys
  description: Automatik til at styre lys på soveværelset
  triggers:
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_1
    attribute: event_type
    to: initial_press
    id: button_1
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_2
    attribute: event_type
    to: initial_press
    id: button_2
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_3
    attribute: event_type
    to: initial_press
    id: button_3
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_4
    attribute: event_type
    to: initial_press
    id: button_4
  - trigger: state
    entity_id:
    - binary_sensor.parent_home
    from: 'on'
    to: 'off'
    id: parents_left_home
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence_sensor_occupancy
    from: 'on'
    to: 'off'
    id: bedroom_empty
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence_sensor_occupancy
    from: 'off'
    to: 'on'
    id: motion
  - trigger: state
    entity_id:
    - sensor.anders_iphone_battery_state
    - sensor.monique_iphone_battery_state
    to: Charging
    id: charging
  - trigger: time
    at: input_datetime.monique_wake_up_alarm
    id: wake_up
  - trigger: state
    entity_id:
    - timer.bedroom_light_sunrise_delay_timer
    to: idle
    from: active
    id: sunrise_script
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: script.bedroom_light_sunrise
        data: {}
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: script.bedroom_light_sunset
        data:
          transition: 180
          brightness_from: 200
          brightness_to: 50
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - parents_left_home
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - bedroom_empty
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - motion
      - condition: state
        entity_id: binary_sensor.bedroom_blind
        state: 'on'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - lights_on
      - condition: state
        entity_id: binary_sensor.bedroom_presence_sensor_occupancy
        state: 'off'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.bedroom_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      sequence:
      - action: script.bedroom_light_sunrise
        data: {}
    - conditions:
      - condition: trigger
        id:
        - sunrise_script
      sequence:
      - action: script.bedroom_light_sunrise
        data: {}
    - conditions:
      - condition: trigger
        id:
        - charging
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'on'
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'on'
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'off'
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.anders_home
            state: 'on'
          - condition: state
            entity_id: sensor.anders_iphone_battery_state
            state: Charging
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'off'
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.monique_home
            state: 'on'
          - condition: state
            entity_id: sensor.monique_iphone_battery_state
            state: Charging
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_light_sunrise_delay_timer
      - action: light.turn_off
        metadata: {}
        data:
          transition: 10
        target:
          entity_id:
          - light.bedroom_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1736103151599'
  alias: Emils værelse rullegardin
  description: Automatik for rullegardin på Emils værelse
  triggers:
  - device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_short_press
    subtype: open
    trigger: device
    id: open_short_pressed
  - trigger: device
    device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_short_press
    subtype: close
    id: close_short_pressed
  - trigger: device
    device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_long_release
    subtype: open
    id: open_long_pressed
  - trigger: device
    device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_long_release
    subtype: close
    id: close_long_pressed
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'on'
    to: 'off'
    id: emil_leaving
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_home
  - trigger: time
    at:
    - '12:00:00'
    id: noon
  - trigger: time
    at: input_datetime.emil_bedtime_alarm
    id: bedtime
  - trigger: time
    at:
      entity_id: input_datetime.emil_wake_up_alarm
      offset: 01:00:00
    id: wake_up
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'on'
    to: 'off'
    id: dark_outside
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'off'
    to: 'on'
    id: light_outside
  - trigger: state
    entity_id:
    - binary_sensor.emils_room_window_sensor_door
    from: 'on'
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id:
    - binary_sensor.emils_room_window_sensor_door
    from: 'off'
    to: 'on'
    id: window_opened
  conditions:
  - condition: state
    entity_id: input_boolean.house_sitter
    state: 'off'
  actions:
  - variables:
      position: '{{ state_attr(''cover.emils_room_blind'', ''current_position'') }}'
      command: move
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_long_pressed
        - close_long_pressed
      sequence:
      - variables:
          command: stop
    - conditions:
      - condition: trigger
        id:
        - open_short_pressed
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
      - condition: state
        entity_id: binary_sensor.emils_room_window_sensor_door
        state: 'on'
      - condition: numeric_state
        entity_id: cover.emils_room_blind
        attribute: current_position
        below: 21
      sequence:
      - variables:
          position: 0
          command: force
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - window_closed
      - condition: numeric_state
        entity_id: cover.emils_room_blind
        attribute: current_position
        below: 21
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - emil_leaving
        - light_outside
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - emil_leaving
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - emil_home
        - noon
        - wake_up
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - variables:
          position: 40
    - conditions:
      - condition: trigger
        id:
        - emil_home
        - noon
        - wake_up
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - emil_home
        - dark_outside
        - bedtime
      sequence:
      - variables:
          position: 0
  - if:
    - condition: state
      entity_id: binary_sensor.emils_room_window_sensor_door
      state: 'on'
    - condition: template
      value_template: '{{ command != ''force'' }}'
    then:
    - variables:
        position: '{{ [position | int, 20] | max }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ command == ''stop'' }}'
      sequence:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.emils_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position == 100 }}'
      - condition: numeric_state
        entity_id: cover.emils_room_blind
        attribute: current_position
        below: 100
      sequence:
      - action: cover.open_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.emils_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position == 0 }}'
      - condition: numeric_state
        entity_id: cover.emils_room_blind
        attribute: current_position
        above: 0
      sequence:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.emils_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position != state_attr(''cover.emils_room_blind'', ''current_position'')
          }}'
      sequence:
      - action: cover.set_cover_position
        metadata: {}
        data:
          position: '{{ position }}'
        target:
          entity_id: cover.emils_room_blind
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736106304486'
  alias: Charlies værelse rullegardin
  description: Automatik for rullegardin på Charlies værelse
  triggers:
  - trigger: device
    device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_short_press
    subtype: open
    id: open_short_pressed
  - trigger: device
    device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_short_press
    subtype: close
    id: close_short_pressed
  - device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_long_release
    subtype: open
    trigger: device
    id: open_long_pressed
  - device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_long_release
    subtype: close
    trigger: device
    id: close_long_pressed
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'off'
    to: 'on'
    id: charlie_home
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'on'
    to: 'off'
    id: charlie_leaving
  - trigger: time
    at:
    - '12:00:00'
    id: noon
  - trigger: time
    at: input_datetime.charlie_bedtime_alarm
    id: bedtime
  - trigger: time
    at:
      entity_id: input_datetime.charlie_wake_up_alarm
      offset: 01:00:00
    id: wake_up
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'on'
    to: 'off'
    id: dark_outside
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'off'
    to: 'on'
    id: light_outside
  - trigger: state
    entity_id:
    - binary_sensor.charlies_room_window_sensor_door
    from: 'on'
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id:
    - binary_sensor.charlies_room_window_sensor_door
    from: 'off'
    to: 'on'
    id: window_opened
  - device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_long_release
    subtype: open
    trigger: device
  conditions:
  - condition: state
    entity_id: input_boolean.house_sitter
    state: 'off'
  actions:
  - variables:
      position: '{{ state_attr(''cover.charlies_room_blind'', ''current_position'')
        }}'
      command: move
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_long_pressed
        - close_long_pressed
      sequence:
      - variables:
          command: stop
    - conditions:
      - condition: trigger
        id:
        - open_short_pressed
      sequence:
      - variables:
          position: 100
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
      sequence:
      - variables:
          position: 0
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 0
    - conditions:
      - condition: trigger
        id:
        - light_outside
        - charlie_leaving
        - charlie_home
        - noon
        - wake_up
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - variables:
          position: 100
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - dark_outside
        - charlie_leaving
        - charlie_home
        - bedtime
      sequence:
      - variables:
          position: 0
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 0
  - if:
    - condition: state
      entity_id: binary_sensor.charlies_room_window_sensor_door
      state: 'on'
    - condition: template
      value_template: '{{ command != ''force'' }}'
    then:
    - variables:
        position: '{{ [position | int, 20] | max }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ command == ''stop'' }}'
      sequence:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.charlies_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position == 100 }}'
      - condition: numeric_state
        entity_id: cover.charlies_room_blind
        attribute: current_position
        below: 100
      sequence:
      - action: cover.open_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.charlies_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position == 0 }}'
      - condition: numeric_state
        entity_id: cover.charlies_room_blind
        attribute: current_position
        above: 0
      sequence:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.charlies_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position != state_attr(''cover.charlies_room_blind'',
          ''current_position'') }}'
      sequence:
      - action: cover.set_cover_position
        metadata: {}
        data:
          position: '{{ position }}'
        target:
          entity_id: cover.charlies_room_blind
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736106591926'
  alias: Soveværelse rullegardin
  description: Automatik for rullegardin på soveværelse
  triggers:
  - device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_short_press
    subtype: open
    trigger: device
    id: open_short_pressed
  - trigger: device
    device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_short_press
    subtype: close
    id: close_short_pressed
  - device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_long_release
    subtype: open
    trigger: device
    id: open_long_pressed
  - device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_long_release
    subtype: close
    trigger: device
    id: close_long_pressed
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_2
    attribute: event_type
    to: initial_press
    id: button_2
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_3
    attribute: event_type
    to: initial_press
    id: button_3
  - trigger: time
    at: input_datetime.monique_wake_up_alarm
    id: wake_up
  - trigger: state
    entity_id:
    - timer.bedroom_blind_timer
    to: idle
    id: wake_up_delay
  - trigger: time
    at: input_datetime.monique_bedtime_alarm
    id: bedtime
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_occupancy
    from: 'on'
    to: 'off'
    id: bedroom_empty
  - trigger: state
    entity_id:
    - binary_sensor.parent_home
    from: 'off'
    to: 'on'
    id: parent_home
  - trigger: state
    entity_id:
    - binary_sensor.parent_home
    from: 'on'
    to: 'off'
    id: parent_left
  - trigger: state
    entity_id: binary_sensor.home_outside_light
    from: 'on'
    to: 'off'
    id: dark_outside
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'off'
    to: 'on'
    id: light_outside
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_light
    from: 'on'
    to: 'off'
    id: light_off
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_light
    from: 'off'
    to: 'on'
    id: light_on
  - trigger: state
    entity_id:
    - sensor.anders_iphone_battery_state
    - sensor.monique_iphone_battery_state
    to: Not Charging
    id: phone_unpluged
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sun_overheat
    to: 'on'
    id: sunny_overheat_on
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sun_overheat
    to: 'off'
    id: sunny_overheat_off
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_window_sensor_door
    from: 'on'
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_window_sensor_door
    from: 'off'
    to: 'on'
    id: window_opened
  - trigger: state
    entity_id: fan.bedroom_air_purifier_fan
    to: 'off'
    id: air_purifier_off
  - trigger: state
    entity_id: fan.bedroom_air_purifier_fan
    to: 'on'
    id: air_purifier_on
  conditions: []
  actions:
  - variables:
      position: '{{ state_attr(''cover.bedroom_blind'', ''current_position'') }}'
      command: move
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_long_pressed
        - close_long_pressed
      sequence:
      - variables:
          command: stop
    - conditions:
      - condition: trigger
        id:
        - open_short_pressed
        - button_2
        - wake_up_delay
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
        - button_3
      - condition: state
        entity_id: binary_sensor.bedroom_window_sensor_door
        state: 'on'
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        below: 21
      sequence:
      - variables:
          position: 0
          command: force
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
        - button_3
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - window_closed
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        below: 21
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - air_purifier_off
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        below: 61
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - light_off
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_blind_timer
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.bedroom_blind_timer
    - conditions:
      - condition: trigger
        id:
        - bedtime
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - bedroom_empty
        - phone_unpluged
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_occupancy
        state: 'off'
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.monique_iphone_battery_state
          state: Not Charging
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'off'
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.anders_iphone_battery_state
          state: Not Charging
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'off'
      - condition: template
        value_template: '{% set n = now().timestamp() %} {% set b = as_timestamp(states(''input_datetime.monique_bedtime_alarm''),
          0) %} {% set w = as_timestamp(states(''input_datetime.monique_wake_up_alarm''),
          0) %} {{ not (b <= n <= w if b < w else b <= n <= b + 43200) }}

          '
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - parent_home
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      - condition: template
        value_template: '{% set n = now().timestamp() %} {% set b = as_timestamp(states(''input_datetime.monique_bedtime_alarm''),
          0) %} {% set w = as_timestamp(states(''input_datetime.monique_wake_up_alarm''),
          0) %} {{ b <= n <= w if b < w else b <= n <= b + 43200 }}

          '
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - parent_home
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - dark_outside
        - parent_left
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - variables:
          position: 0
    - conditions:
      - condition: trigger
        id:
        - light_outside
        - parent_left
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - sunny_overheat_off
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        above: 59
      sequence:
      - variables:
          position: 100
    - conditions:
      - condition: trigger
        id:
        - light_on
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'on'
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.monique_iphone_battery_state
          state: Not Charging
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'off'
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.anders_iphone_battery_state
          state: Not Charging
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'off'
      sequence:
      - variables:
          position: 100
  - if:
    - condition: state
      entity_id: binary_sensor.bedroom_sun_overheat
      state: 'on'
    then:
    - variables:
        position: '{{ [position | int, 60] | min }}'
  - if:
    - condition: state
      entity_id: binary_sensor.bedroom_window_sensor_door
      state: 'on'
    - condition: template
      value_template: '{{ command != ''force'' }}'
    then:
    - variables:
        position: '{{ [position | int, 20] | max }}'
  - if:
    - condition: state
      entity_id: fan.bedroom_air_purifier_fan
      state: 'on'
    then:
    - variables:
        position: '{{ [position | int, 60] | max }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ command == ''stop'' }}'
      sequence:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.bedroom_blind
    - conditions:
      - condition: template
        value_template: '{{ position == 100 }}'
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        below: 100
      sequence:
      - action: cover.open_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.bedroom_blind
    - conditions:
      - condition: template
        value_template: '{{ position == 0 }}'
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        above: 0
      sequence:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.bedroom_blind
    - conditions:
      - condition: template
        value_template: '{{ position != state_attr(''cover.bedroom_blind'', ''current_position'')
          }}'
      sequence:
      - action: cover.set_cover_position
        metadata: {}
        data:
          position: '{{ position }}'
        target:
          entity_id: cover.bedroom_blind
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1737201831964'
  alias: Indkørsel billader sæt pris
  description: Sæt elektricitets prisen på billader
  triggers:
  - trigger: state
    entity_id:
    - sensor.energy_price
  - value_template: '{% set last = state_attr(''automation.driveway_ev_charger_set_price'',
      ''last_triggered'') %} {{ last is none or ( now() - last ).total_seconds() >
      3600 }}

      '
    trigger: template
  conditions: []
  actions:
  - action: number.set_value
    metadata: {}
    data:
      value: '{{ states(''sensor.energy_price'') }}'
    target:
      entity_id: number.driveway_ev_charger_energy_price
  mode: single
  trace:
    stored_traces: 10
- id: '1737240652738'
  alias: Teknik solcelle batteri sæt operating mode
  description: Sæt operation mode på solcelle batteri for at lade om natten hvis billigere
  triggers:
  - trigger: time
    at: 00:01:00
  conditions: []
  actions:
  - variables:
      charge_start: '{{ now().replace(hour=0, minute=0, second=0) }}'
      charge_end: '{{ now().replace(hour=6, minute=0, second=0) }}'
      charge_periods: "{% set g = namespace(count = 0) %}\n{% set start = as_timestamp(charge_start)
        %}\n{% set end = as_timestamp(charge_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for entry in prices %}\n  {% set ts = as_timestamp(entry.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.count = g.count + 1
        %}\n  {% endif %}\n{% endfor %}\n{{ g.count }}      \n"
      use_start: '{{ now().replace(hour=17, minute=0, second=0) }}'
      use_end: '{{ now().replace(hour=21, minute=0, second=0) }}'
      use_periods: "{% set g = namespace(count = 0) %}\n{% set start = as_timestamp(use_start)
        %}\n{% set end = as_timestamp(use_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for entry in prices %}\n  {% set ts = as_timestamp(entry.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.count = g.count + 1
        %}\n  {% endif %}\n{% endfor %}\n{{ g.count }}      \n"
      capacity: "{% set fixed_use = 700 %}\n{% set g = namespace(capacity = 0) %}\n{%
        set start = as_timestamp(charge_end) %}\n{% set end = as_timestamp(use_start)
        %} \n{% set forecast = state_attr('sensor.solar_forecast_energy_today',\n'detailedHourly')
        %}\n{% set g.capacity =\nstates('sensor.technic_room_solar_battery_installed_capacity_total')|float(0)\n%}\n{%
        set g.capacity = g.capacity * (1 - states('sensor.technic_room_solar_battery_battery_percentage_user')|float(0)
        / 100) %}\n{% for p in forecast %}\n  {% set ts = as_timestamp(p.period_start)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.capacity = max(0, g.capacity
        - max(0, p.pv_estimate * 1000 - fixed_use)) %}\n  {% endif %}\n{% endfor %}\n\n{{
        g.capacity|round(0) }}\n"
      schedule: "{{\n  \"[{\\\"start\\\": \\\"\" ~ (as_datetime(charge_start) + timedelta(minutes=1)).strftime('%H:%M')
        ~\n  \"\\\", \\\"stop\\\": \\\"\" ~ as_datetime(charge_end).strftime('%H:%M')
        ~\n  \"\\\", \\\"threshold_p_max\\\": \" ~ capacity ~\n  \"}, {\\\"start\\\":
        \\\"\" ~ (as_datetime(charge_end) + timedelta(minutes=1)).strftime('%H:%M')
        ~\n  \"\\\", \\\"stop\\\": \\\"\" ~ as_datetime(use_start).strftime('%H:%M')
        ~\n  \"\\\", \\\"threshold_p_max\\\": 0}]\"\n}}\n"
      charge_cost: "{% set g = namespace(charge_cost=0) %}\n{% set start = as_timestamp(charge_start)
        %}\n{% set end = as_timestamp(charge_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for p in prices %}\n  {% set ts = as_timestamp(p.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.charge_cost = g.charge_cost
        + p.price * (capacity / 1000 / charge_periods) %}\n  {% endif %}\n{% endfor
        %}\n{{ g.charge_cost | round(2) }}\n"
      use_cost: "{% set g = namespace(use_cost=0) %}\n{% set start = as_timestamp(use_start)
        %}\n{% set end = as_timestamp(use_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for p in prices %}\n  {% set ts = as_timestamp(p.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.use_cost = g.use_cost
        + p.price * (capacity / 1000 / use_periods) %}\n  {% endif %}\n{% endfor %}\n{{
        g.use_cost | round(2) }}\n"
  - action: system_log.write
    data:
      level: info
      message: 'Charge Start: {{ charge_start }}

        Charge End: {{ charge_end }}

        Charge Periods: {{ charge_periods }}

        Use Start: {{ use_start }}

        Use End: {{ use_end }}

        Use Periods: {{ use_periods }}

        Capacity: {{ capacity }}

        Schedule: {{ schedule }}

        Charge cost: {{ charge_cost }}

        Use cost: {{ use_cost }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ capacity | int > 0 and (use_cost | float - charge_cost
          | float) > 5 }}

          '
      sequence:
      - action: sonnenbatterie.set_operating_mode
        data:
          device_id: 11f8db43595fb97c43173da2b7b5b2b7
          mode: timeofuse
        response_variable: conversation_response
      - action: sonnenbatterie.set_tou_schedule
        data:
          device_id: 11f8db43595fb97c43173da2b7b5b2b7
          schedule: '{{ schedule }}'
        response_variable: conversation_response
    default:
    - action: sonnenbatterie.set_operating_mode
      data:
        device_id: 11f8db43595fb97c43173da2b7b5b2b7
        mode: automatic
      response_variable: conversation_response
  - action: system_log.write
    metadata: {}
    data:
      level: debug
      message: '{{ conversation_response }}'
  mode: single
- id: '1737244947943'
  alias: Volvo XC40 - Lås
  description: Lås døren op bilen hvis den ikke er låst
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.volvo_xc40_door_front_right
    - binary_sensor.volvo_xc40_door_front_left
    - binary_sensor.volvo_xc40_door_rear_right
    - binary_sensor.volvo_xc40_door_rear_left
    - binary_sensor.volvo_xc40_tailgate
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.volvo_xc40_engine_status
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: state
    entity_id: binary_sensor.volvo_xc40_door_front_right
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_xc40_door_front_left
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_xc40_door_rear_right
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_xc40_door_rear_left
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_xc40_tailgate
    state: 'off'
  - condition: state
    entity_id: sensor.volvo_xc40_charging_connection_status
    state: Disconnected
  - condition: state
    entity_id: binary_sensor.volvo_xc40_engine_status
    state: 'off'
  actions:
  - action: lock.lock
    metadata: {}
    data: {}
    target:
      entity_id: lock.volvo_xc40_lock
  mode: restart
- id: '1737245308947'
  alias: Volvo EX30 - Lås
  description: Lås døren op bilen hvis den ikke er låst
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.volvo_ex30_door_front_right
    - binary_sensor.volvo_ex30_door_front_left
    - binary_sensor.volvo_ex30_door_rear_right
    - binary_sensor.volvo_ex30_door_rear_left
    - binary_sensor.volvo_ex30_tailgate
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.volvo_ex30_engine_status
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: state
    entity_id: binary_sensor.volvo_ex30_door_front_right
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_ex30_door_front_left
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_ex30_door_rear_right
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_ex30_door_rear_left
    state: 'off'
  - condition: state
    entity_id: binary_sensor.volvo_ex30_tailgate
    state: 'off'
  - condition: state
    entity_id: sensor.volvo_ex30_charging_connection_status
    state: Disconnected
  - condition: state
    entity_id: binary_sensor.volvo_ex30_engine_status
    state: 'off'
  actions:
  - action: lock.lock
    metadata: {}
    data: {}
    target:
      entity_id: lock.volvo_ex30_lock
  mode: restart
- id: '1737299093662'
  alias: Emils værelse varme
  description: Automatik til at styre varmen på Emils værelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.home_central_heating
  - trigger: state
    entity_id: binary_sensor.emils_room_window_sensor_door
  - trigger: state
    entity_id: binary_sensor.emil_sleeping
  - trigger: state
    entity_id: binary_sensor.emil_home
  - trigger: state
    entity_id: input_boolean.house_sitter
  - trigger: time
    at:
      entity_id: input_datetime.emil_wake_up_alarm
      offset: -00:15:00
  - trigger: time
    at:
      entity_id: input_datetime.emil_wake_up_alarm
      offset: 00:15:00
  - trigger: state
    entity_id: timer.emils_room_heating_manual_timer
    to: idle
  conditions:
  - condition: state
    entity_id: timer.emils_room_heating_manual_timer
    state: idle
  actions:
  - variables:
      target: 21
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.emils_room_window_sensor_door
        state: 'on'
      sequence:
      - variables:
          target: 10
    - conditions:
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.emil_sleeping
        state: 'on'
      - condition: template
        value_template: '{% set n = now() %} {% set a = states(''input_datetime.emil_wake_up_alarm'')
          | as_datetime | as_local %} {% set s = a - timedelta(minutes=15) %} {% set
          e = a + timedelta(minutes=15) %} {{ s <= n < e }}'
      sequence:
      - variables:
          target: 21
    - conditions:
      - condition: state
        entity_id: binary_sensor.emil_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 19
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.emils_room_radiator_thermostat
  mode: restart
  trace:
    stored_traces: 50
- id: '1737309773463'
  alias: Charlies værelse varme
  description: Automatik til at styre varmen på Charlies værelse
  triggers:
  - trigger: state
    entity_id: sensor.charlies_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.charlies_room_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: binary_sensor.home_central_heating
  - trigger: state
    entity_id: binary_sensor.charlies_room_window_sensor_door
  - trigger: state
    entity_id: binary_sensor.charlie_sleeping
  - trigger: state
    entity_id: binary_sensor.charlie_home
  - trigger: state
    entity_id: input_boolean.house_sitter
  - trigger: time
    at:
      entity_id: input_datetime.charlie_wake_up_alarm
      offset: -00:15:00
  - trigger: time
    at:
      entity_id: input_datetime.charlie_wake_up_alarm
      offset: 00:15:00
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.charlies_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.charlies_room_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.charlies_room_target_temperature'') !=
          states(''input_number.charlies_room_auto_temperature'') }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.charlies_room_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.charlies_room_target_temperature'') ==
          states(''input_number.charlies_room_auto_temperature'') }}'
      - condition: state
        entity_id: timer.charlies_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.charlies_room_heating_manual_timer
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_auto_temperature
        data:
          value: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.charlies_room_window_sensor_door
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_auto_temperature
        data:
          value: 10
    - conditions:
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_auto_temperature
        data:
          value: 19
    - conditions:
      - condition: state
        entity_id: binary_sensor.charlie_sleeping
        state: 'on'
      - condition: template
        value_template: '{% set n = now() %} {% set a = states(''input_datetime.charlie_wake_up_alarm'')
          | as_datetime | as_local %} {% set s = a - timedelta(minutes=15) %} {% set
          e = a + timedelta(minutes=15) %} {{ s <= n < e }}'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_auto_temperature
        data:
          value: 21
    - conditions:
      - condition: state
        entity_id: binary_sensor.charlie_sleeping
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_auto_temperature
        data:
          value: 19
    default:
    - action: input_number.set_value
      target:
        entity_id: input_number.charlies_room_auto_temperature
      data:
        value: 21
  - if:
    - condition: state
      entity_id: timer.charlies_room_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''input_number.charlies_room_auto_temperature'') }}'
        entities:
        - climate.charlies_room_radiator_thermostat
        - climate.charlies_room_temperature_sensor
  mode: restart
  trace:
    stored_traces: 50
- id: '1737310160740'
  alias: Soveværelse varme
  description: Automatik til at styre varmen i soveværelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.home_central_heating
  - trigger: state
    entity_id: binary_sensor.bedroom_window_sensor_door
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
  - trigger: state
    entity_id: binary_sensor.bedroom_door
  - trigger: state
    entity_id: binary_sensor.bedroom_occupancy
  - trigger: state
    entity_id: binary_sensor.parent_home
  - trigger: state
    entity_id: input_boolean.house_sitter
  - trigger: state
    entity_id: timer.bedroom_door_timer
  - trigger: time
    at:
      entity_id: input_datetime.monique_wake_up_alarm
      offset: -00:15:00
  - trigger: time
    at:
      entity_id: input_datetime.monique_wake_up_alarm
      offset: 00:15:00
  - trigger: state
    entity_id: timer.bedroom_heating_manual_timer
    to: idle
  conditions:
  - condition: state
    entity_id: timer.bedroom_heating_manual_timer
    state: idle
  actions:
  - variables:
      target: 21
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_window_sensor_door
        state: 'on'
      sequence:
      - variables:
          target: 10
    - conditions:
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.bedroom_door
          state: 'off'
        - condition: state
          entity_id: timer.bedroom_door_timer
          state: active
      - condition: state
        entity_id: binary_sensor.bedroom_occupancy
        state: 'off'
      sequence:
      - variables:
          target: 19
    - conditions:
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: template
        value_template: '{{ today_at("11:00") <= now() < today_at("17:00") }}'
      sequence:
      - variables:
          target: 21
    - conditions:
      - condition: state
        entity_id: binary_sensor.monique_sleeping
        state: 'on'
      - condition: template
        value_template: '{% set n = now() %} {% set a = states(''input_datetime.monique_wake_up_alarm'')
          | as_datetime | as_local %} {% set s = a - timedelta(minutes=15) %} {% set
          e = a + timedelta(minutes=15) %} {{ s <= n < e }}'
      sequence:
      - variables:
          target: 21
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 19
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.bedroom_radiator_thermostat
  mode: restart
  trace:
    stored_traces: 50
- id: '1737310628140'
  alias: Toilet varme
  description: Automatik til at styre varmen på toilettet
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_central_heating
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
  - trigger: state
    entity_id:
    - binary_sensor.toilet_light
  conditions: []
  actions:
  - variables:
      target: 20
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 19
    - conditions:
      - condition: state
        entity_id: binary_sensor.toilet_light
        state: 'on'
      sequence:
      - variables:
          target: 22
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.toilet_radiator_thermostat
  mode: restart
  trace:
    stored_traces: 50
- id: '1737311363654'
  alias: Badeværelse varme
  description: Automatik til at styre varmen på badeværelset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_central_heating
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
  conditions: []
  actions:
  - variables:
      target: 21
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 20
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.bathroom_radiator_thermostat_floor
      - climate.bathroom_radiator_thermostat_wall
  mode: restart
  trace:
    stored_traces: 50
- id: '1737311656075'
  alias: Bryggers varme
  description: Automatik til at styre varmen på bryggers
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_central_heating
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_door
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_light
  conditions: []
  actions:
  - variables:
      target: 20
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.utility_room_door
        state: 'on'
      sequence:
      - variables:
          target: 10
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 19
    - conditions:
      - condition: state
        entity_id: binary_sensor.utility_room_light
        state: 'on'
      sequence:
      - variables:
          target: 22
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.utility_room_radiator_thermostat_wall
      - climate.utility_room_radiator_thermostat_floor
      - climate.utility_room_temperature_sensor
  mode: restart
  trace:
    stored_traces: 50
- id: '1737312016227'
  alias: Stue varme
  description: Automatik til at styre varmen i stuen
  triggers:
  - trigger: state
    entity_id: sensor.living_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.living_room_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: binary_sensor.home_central_heating
  - trigger: state
    entity_id: binary_sensor.living_room_window_sensor_sofa_door
  - trigger: state
    entity_id: binary_sensor.patio_door
  - trigger: state
    entity_id: cover.living_room_skylight_window_north
  - trigger: state
    entity_id: cover.living_room_skylight_window_south
  - trigger: state
    entity_id: binary_sensor.living_room_door_sensor_door
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: binary_sensor.living_room_light
  - trigger: state
    entity_id: binary_sensor.living_room_media
  - trigger: state
    entity_id: binary_sensor.kitchen_occupancy
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.living_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.living_room_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.living_room_target_temperature'') != states(''input_number.living_room_auto_temperature'')
          }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 02:00:00
        target:
          entity_id: timer.living_room_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_target_temperature'') == states(''input_number.living_room_auto_temperature'')
          }}'
      - condition: state
        entity_id: timer.living_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.living_room_heating_manual_timer
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.living_room_auto_temperature
        data:
          value: 23
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.living_room_window_sensor_sofa_door
          state: 'on'
        - condition: state
          entity_id: binary_sensor.patio_door
          state: 'on'
        - condition: state
          entity_id: cover.living_room_skylight_window_north
          state: open
        - condition: state
          entity_id: cover.living_room_skylight_window_south
          state: open
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.living_room_auto_temperature
        data:
          value: 10
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.living_room_auto_temperature
        data:
          value: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.living_room_auto_temperature
        data:
          value: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.living_room_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_media
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_occupancy
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.living_room_auto_temperature
        data:
          value: 19
    default:
    - action: input_number.set_value
      target:
        entity_id: input_number.living_room_auto_temperature
      data:
        value: 22
  - if:
    - condition: state
      entity_id: timer.living_room_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''input_number.living_room_auto_temperature'') }}'
        entities:
        - climate.living_room_radiator_thermostat_bookcase
        - climate.living_room_radiator_thermostat_dining_table
        - climate.living_room_radiator_thermostat_sofa
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1737313921011'
  alias: Gang varme
  description: Automatik til at styre varmen i gangen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_central_heating
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_door
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
  - trigger: state
    entity_id:
    - sensor.bedroom_target_temperature
  conditions: []
  actions:
  - variables:
      target: 21
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      sequence:
      - variables:
          target: '{{ states(''sensor.bedroom_target_temperature'') }}'
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 18
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.hallway_radiator_thermostat
  mode: restart
  trace:
    stored_traces: 50
- id: '1737405624054'
  alias: Stue varme manuelt
  description: Start timer for manuelt kontrol af varme
  triggers:
  - trigger: state
    entity_id: sensor.living_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: binary_sensor.someone_home
    from: 'on'
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_heating_manual_timer
    - conditions:
      - condition: trigger
        id:
        - target_changed
      - condition: template
        value_template: '{{ is_state_attr(''automation.living_room_heating'', ''current'',
          0) }}'
      - condition: template
        value_template: '{% set lt = state_attr(''automation.living_room_heating'',
          ''last_triggered'') %} {{ lt is none or (now().timestamp() - lt | as_datetime
          | as_timestamp) > 8 }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 02:00:00
        target:
          entity_id: timer.living_room_heating_manual_timer
  mode: restart
  trace:
    stored_traces: 50
- id: '1737748537241'
  alias: Soveværelse varme manuelt
  description: Start timer for manuelt kontrol af varme
  triggers:
  - trigger: state
    entity_id: sensor.bedroom_target_temperature
    id: target_changed
  - trigger: state
    entity_id: binary_sensor.parent_home
    from: 'on'
    to: 'off'
  - trigger: state
    entity_id: input_boolean.house_sitter
    from: 'on'
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_heating_manual_timer
    - conditions:
      - condition: trigger
        id:
        - target_changed
      - condition: template
        value_template: '{{ is_state_attr(''automation.bedroom_heating'', ''current'',
          0) }}'
      - condition: template
        value_template: '{% set lt = state_attr(''automation.bedroom_heating'', ''last_triggered'')
          %} {{ lt is none or (now().timestamp() - lt | as_datetime | as_timestamp)
          > 8 }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.bedroom_heating_manual_timer
  mode: restart
  trace:
    stored_traces: 50
- id: '1737748573372'
  alias: Emils værelse varme manuelt
  description: Start timer for manuelt kontrol af varme
  triggers:
  - trigger: state
    entity_id: sensor.emils_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: binary_sensor.emil_home
    from: 'on'
    to: 'off'
  - trigger: state
    entity_id: input_boolean.house_sitter
    from: 'on'
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_heating_manual_timer
    - conditions:
      - condition: trigger
        id:
        - target_changed
      - condition: template
        value_template: '{{ is_state_attr(''automation.emils_room_heating'', ''current'',
          0) }}'
      - condition: template
        value_template: '{% set lt = state_attr(''automation.emils_room_heating'',
          ''last_triggered'') %} {{ lt is none or (now().timestamp() - lt | as_datetime
          | as_timestamp) > 8 }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.emils_room_heating_manual_timer
  mode: restart
  trace:
    stored_traces: 50
- id: '1737748610394'
  alias: Charlies værelse varme manuelt
  description: Start timer for manuelt kontrol af varme
  triggers:
  - trigger: state
    entity_id: sensor.charlies_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: binary_sensor.charlie_home
    from: 'on'
    to: 'off'
  - trigger: state
    entity_id: input_boolean.house_sitter
    from: 'on'
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_heating_manual_timer
    - conditions:
      - condition: trigger
        id:
        - target_changed
      - condition: template
        value_template: '{{ is_state_attr(''automation.charlies_room_heating'', ''current'',
          0) }}'
      - condition: template
        value_template: '{% set lt = state_attr(''automation.charlies_room_heating'',
          ''last_triggered'') %} {{ lt is none or (now().timestamp() - lt | as_datetime
          | as_timestamp) > 8 }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.charlies_room_heating_manual_timer
  mode: restart
  trace:
    stored_traces: 50
- id: '1737757884659'
  alias: Hjem varme slukket
  description: 'Automatik til at motionere radiator ventiler når varmepumpe er slukket.

    '
  triggers:
  - trigger: time
    at: 01:00:00
  conditions:
  - condition: time
    weekday:
    - mon
  - condition: state
    entity_id: binary_sensor.home_central_heating
    state: 'off'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.exercising_radiator_valves
  mode: single
- id: '1737796089950'
  alias: Solcast PV Forecast opdater
  description: Opdater sol produktion udsigten i Solcast PV Forecast
  triggers:
  - trigger: time
    at: 00:00:00
  - trigger: sun
    event: sunrise
    offset: 0
  conditions: []
  actions:
  - action: solcast_solar.update_forecasts
    metadata: {}
    data: {}
  mode: single
  trace:
    stored_traces: 10
- id: '1737835831554'
  alias: Sæt huspasser
  description: Slår huspasser fra når familien kommer hjem, og til hvis andre låser
    op med keypad
  triggers:
  - entity_id: binary_sensor.family_home
    from: 'off'
    to: 'on'
    id: family_home
    trigger: state
  - entity_id:
    - sensor.entrance_door_operator
    - sensor.utility_room_door_operator
    id: door_unlock
    trigger: state
  actions:
  - data:
      name: Huspasser
      message: 'Huspasser slået til via {{ trigger.entity_id }}

        Operator {{ states(trigger.entity_id) }}

        '
      entity_id: input_boolean.house_sitter
    action: logbook.log
  - choose:
    - conditions:
      - condition: trigger
        id: family_home
      sequence:
      - target:
          entity_id: input_boolean.house_sitter
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: door_unlock
      - condition: state
        entity_id: binary_sensor.family_home
        state: 'off'
      - condition: template
        value_template: '{{ state_attr(trigger.entity_id, ''method'') == ''keypad''
          }}

          '
      - condition: template
        value_template: '{{ ''Busted-Janum'' not in states(trigger.entity_id) }}

          '
      sequence:
      - target:
          entity_id: input_boolean.house_sitter
        action: input_boolean.turn_on
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1737916297775'
  alias: Indkørsel lys
  description: Automatik til at styre lys i indkørsel
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_detected
    from: 'off'
    to: 'on'
    id: detected_street
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_detected
    from: 'on'
    to: 'off'
    id: cleared_street
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_detected
    from: 'off'
    to: 'on'
    id: detected_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_detected
    from: 'on'
    to: 'off'
    id: cleared_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'on'
    to: 'off'
    id: cleared_entrance
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_detected
    from: 'off'
    to: 'on'
    id: detected_east
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_detected
    from: 'on'
    to: 'off'
    id: cleared_east
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'on'
    to: 'off'
    id: twilight
  - trigger: time
    at: '22:00:00'
    id: night
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_south
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_right_1
          - light.driveway_light_right_2
          - light.driveway_light_right_3
          - light.driveway_light_left_1
          - light.driveway_light_left_2
          - light.driveway_light_left_3
          - light.driveway_light_left_4
          - light.driveway_light_left_5
          - light.driveway_light_left_6
          - light.driveway_light_left_7
          - light.driveway_light_left_8
          - light.driveway_light_left_9
          sequence:
          - action: light.turn_on
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
            data:
              brightness_pct: 100
              color_temp_kelvin: 3000
              transition: 1
          - delay: '00:00:00.1'
    - conditions:
      - condition: trigger
        id:
        - detected_street
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_right_3
          - light.driveway_light_right_2
          - light.driveway_light_right_1
          - light.driveway_light_left_9
          - light.driveway_light_left_8
          - light.driveway_light_left_7
          - light.driveway_light_left_6
          - light.driveway_light_left_5
          - light.driveway_light_left_4
          - light.driveway_light_left_3
          - light.driveway_light_left_2
          - light.driveway_light_left_1
          sequence:
          - action: light.turn_on
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
            data:
              brightness_pct: 100
              color_temp_kelvin: 3000
              transition: 1
          - delay: '00:00:00.1'
    - conditions:
      - condition: trigger
        id:
        - detected_entrance
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_right_2
          - light.driveway_light_right_3
          - light.driveway_light_left_2
          - light.driveway_light_left_3
          - light.driveway_light_left_4
          - light.driveway_light_left_5
          - light.driveway_light_left_6
          - light.driveway_light_left_7
          - light.driveway_light_left_8
          - light.driveway_light_left_9
          sequence:
          - action: light.turn_on
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
            data:
              brightness_pct: 100
              color_temp_kelvin: 3000
              transition: 1
          - delay: '00:00:00.1'
    - conditions:
      - condition: trigger
        id:
        - detected_east
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          transition: 1
          color_temp_kelvin: 3000
        target:
          entity_id:
          - light.driveway_light_left_1
    - conditions:
      - condition: trigger
        id:
        - cleared_street
        - cleared_south
        - cleared_entrance
        - cleared_east
        - twilight
      - condition: state
        entity_id: binary_sensor.driveway_motion_sensor_street_detected
        state: 'off'
      - condition: state
        entity_id: binary_sensor.driveway_motion_sensor_house_south_detected
        state: 'off'
      - condition: state
        entity_id: binary_sensor.driveway_motion_sensor_entrance_detected
        state: 'off'
      - condition: state
        entity_id: binary_sensor.garden_motion_sensor_house_east_detected
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      - condition: template
        value_template: '{% set wd = now().weekday() %} {% set h = now().hour %} {%
          set d = now().day %} {% set m = now().month %} {{ (wd in [4,5] and h < 23)
          or (m == 12 and d == 31 and h < 24) or (h < 22) }}'
      - condition: time
        after: '12:00:00'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ now().month == 12 and now().day >= 1 and now().day
              <= 26 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_christmas
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ (now().month == 12 and now().day >= 30) or (now().month
              == 1 and now().day == 1) }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_new_years
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ now().month == 10 and now().day >= 15 and now().day
              <= 31 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_halloween
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ now().month == 3 and now().day == 17 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_sankt_patrick
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ now().month == 2 and now().day == 14 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_valentines
            data:
              transition: 1
        default:
        - action: scene.turn_on
          target:
            entity_id: scene.driveway_light_twlight
          data:
            transition: 1
    - conditions:
      - condition: trigger
        id:
        - cleared_street
        - cleared_south
        - cleared_entrance
        - cleared_east
        - night
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.home_outside_light
          state: 'on'
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.driveway_motion_sensor_street_detected
            state: 'off'
          - condition: state
            entity_id: binary_sensor.driveway_motion_sensor_house_south_detected
            state: 'off'
          - condition: state
            entity_id: binary_sensor.driveway_motion_sensor_entrance_detected
            state: 'off'
          - condition: state
            entity_id: binary_sensor.garden_motion_sensor_house_east_detected
            state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_left_1
          - light.driveway_light_left_2
          - light.driveway_light_left_3
          - light.driveway_light_left_4
          - light.driveway_light_left_5
          - light.driveway_light_left_6
          - light.driveway_light_left_7
          - light.driveway_light_left_8
          - light.driveway_light_left_9
          - light.driveway_light_right_1
          - light.driveway_light_right_2
          - light.driveway_light_right_3
          sequence:
          - action: light.turn_off
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
          - delay: '00:00:00.1'
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1738962148356'
  alias: Garage 3D Printer
  description: Automatik til at slukke for 3D printer
  triggers:
  - trigger: state
    entity_id:
    - sensor.garage_3d_printer
    to:
    - finished
    - idle
    - ready
    id: finished
  - trigger: state
    entity_id:
    - sensor.garage_3d_printer
    to:
    - busy
    - printing
    id: started
  - trigger: state
    entity_id:
    - sensor.garage_3d_printer
    to:
    - stopped
    - error
    - attention
    - pause
    id: failed
  - trigger: state
    entity_id: timer.garage_3d_printer_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: light.garage_3d_printer_power
    from: 'on'
    to: 'off'
    id: 'off'
  - trigger: state
    entity_id: light.garage_3d_printer_power
    from: 'off'
    to: 'on'
    id: 'on'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: finished
      sequence:
      - action: timer.start
        metadata: {}
        target:
          entity_id: timer.garage_3d_printer_timer
        data:
          duration: 00:10:00
      - action: script.create_todo_task
        metadata: {}
        data:
          is_active: true
    - conditions:
      - condition: trigger
        id: started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garage_3d_printer_timer
      - action: script.create_todo_task
        metadata: {}
        data:
          is_active: false
    - conditions:
      - condition: trigger
        id: failed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garage_3d_printer_timer
      - action: script.create_todo_task
        metadata: {}
        data:
          is_active: false
    - conditions:
      - condition: trigger
        id: timeout
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_3d_printer_power
    - conditions:
      - condition: trigger
        id: 'off'
      sequence: []
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garage_3d_printer_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1739016002574'
  alias: Emils værelse blæser
  description: Tænder for Dyson Hot+Cool i Emils værelse, for at varme hurtigere op
    hvis den ønskede temperatur er væsentligt koldere end den aktuelle.
  triggers:
  - trigger: state
    entity_id:
    - sensor.emils_room_target_temperature
  - trigger: state
    entity_id: sensor.emils_room_current_temperature
    for:
      minutes: 1
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
  - trigger: numeric_state
    entity_id: sensor.emils_room_air_quality_score
    above: 50
  - trigger: numeric_state
    entity_id: sensor.emils_room_air_quality_score
    below: 50
  - trigger: state
    entity_id: binary_sensor.emils_room_light
  - trigger: state
    entity_id: binary_sensor.emils_room_window_sensor_door
    from: 'off'
    to: 'on'
    id: window_opened
  - trigger: state
    entity_id: binary_sensor.emils_room_window_sensor_door
    from: 'on'
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id: timer.emils_room_air_purifier_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - variables:
      mode: 'off'
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      sequence: []
    - conditions:
      - condition: trigger
        id: timeout
      sequence: []
    - conditions:
      - condition: trigger
        id: window_opened
      sequence:
      - variables:
          mode: fan
      - action: timer.start
        metadata: {}
        data:
          duration: 00:10:00
        target:
          entity_id: timer.emils_room_air_purifier_timer
    - conditions:
      - condition: trigger
        id: window_closed
      - condition: state
        entity_id: timer.emils_room_air_purifier_timer
        state: active
      sequence:
      - variables:
          mode: 'off'
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.emils_room_air_purifier_timer
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.emils_room_current_temperature")|float(21)
          < states("sensor.emils_room_target_temperature")|float(21) - 1 }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: binary_sensor.emils_room_window_sensor_door
          state: 'on'
      sequence:
      - variables:
          mode: heat
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.emils_room_current_temperature")|float(21)
          > max(25, states("sensor.emils_room_target_temperature")|float(21) + 3)
          }}'
      sequence:
      - variables:
          mode: cool
    - conditions:
      - condition: numeric_state
        entity_id: sensor.emils_room_air_quality_score
        below: 50
      - condition: not
        conditions:
        - condition: state
          entity_id: binary_sensor.emils_room_window_sensor_door
          state: 'on'
      sequence:
      - variables:
          mode: filter
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      sequence: []
    - conditions:
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'on'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.emils_room_air_purifier_night_mode
    default:
    - action: switch.turn_on
      target:
        entity_id: switch.emils_room_air_purifier_night_mode
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.emils_room_air_purifier
          state: 'off'
      sequence:
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
    - conditions:
      - condition: template
        value_template: '{{ mode == ''heat'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ min(states(''sensor.emils_room_target_temperature'')|float(0)
            + 3, 37) }}'
          hvac_mode: heat
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
    - conditions:
      - condition: template
        value_template: '{{ mode == ''cool'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ max(1, states(''sensor.emils_room_target_temperature'')|float(0)
            - 3) }}'
          hvac_mode: cool
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
    - conditions:
      - condition: template
        value_template: '{{ mode == ''fan'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ states(''sensor.emils_room_current_temperature'')|float(21)
            }}'
          hvac_mode: cool
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_percentage
        metadata: {}
        data:
          percentage: 100
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Normal
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
    - conditions:
      - condition: template
        value_template: '{{ mode == ''filter'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: cool
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1739480121158'
  alias: Push configuration filer til GitHub
  description: Automatik til at sende configuration filer etc til GitHub repository
  triggers:
  - trigger: time
    at: '23:00:00'
  - trigger: event
    event_type: event_homeassistant_restarted
  - trigger: event
    event_type: homeassistant_close
  - trigger: event
    event_type: homeassistant_stop
  conditions: []
  actions:
  - action: shell_command.pushupdates_to_github
    data: {}
  mode: single
  trace:
    stored_traces: 20
- id: '1739615474729'
  alias: Stue medieafspiller sæt status
  description: Automatik til at sætte status helper for medie i stuen
  triggers:
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    to: playing
    id: playing_started
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    from: playing
    id: playing_ended
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    to: 'off'
    id: 'off'
  - trigger: state
    entity_id: timer.living_room_media_timer
    to: idle
    id: timer_ended
  - trigger: state
    entity_id: binary_sensor.someone_home
    to: 'off'
    id: no_one_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - playing_started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.living_room_media_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_status
        data: {}
    - conditions:
      - condition: trigger
        id:
        - playing_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.living_room_media_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_status
        data: {}
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - timer_ended
        - 'off'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_status
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1739647490572'
  alias: Soveværelse blæser
  description: Tænder for Dyson Hot+Cool i soveværelset, for at varme hurtigere op
    hvis den ønskede temperatur er væsentligt koldere end den aktuelle.
  triggers:
  - trigger: state
    entity_id:
    - sensor.bedroom_target_temperature
  - trigger: state
    entity_id: sensor.bedroom_current_temperature
    for:
      minutes: 1
  - trigger: state
    entity_id: binary_sensor.parent_home
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
  - trigger: state
    entity_id: input_boolean.house_sitter
  - trigger: numeric_state
    entity_id: sensor.bedroom_air_quality_score
    above: 50
  - trigger: numeric_state
    entity_id: sensor.bedroom_air_quality_score
    below: 50
  - trigger: state
    entity_id: binary_sensor.bedroom_window_sensor_door
    from: 'off'
    to: 'on'
    id: window_opened
  - trigger: state
    entity_id: binary_sensor.bedroom_window_sensor_door
    from: 'on'
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id: timer.bedroom_air_purifier_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - variables:
      mode: 'off'
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence: []
    - conditions:
      - condition: trigger
        id: timeout
      sequence: []
    - conditions:
      - condition: trigger
        id: window_opened
      sequence:
      - variables:
          mode: fan
      - action: timer.start
        metadata: {}
        data:
          duration: 00:10:00
        target:
          entity_id: timer.bedroom_air_purifier_timer
    - conditions:
      - condition: trigger
        id: window_closed
      - condition: state
        entity_id: timer.bedroom_air_purifier_timer
        state: active
      sequence:
      - variables:
          mode: 'off'
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_air_purifier_timer
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.bedroom_current_temperature")|float(21)
          < states("sensor.bedroom_target_temperature")|float(21) - 1 }}'
      - condition: state
        entity_id: binary_sensor.bedroom_window_sensor_door
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      sequence:
      - variables:
          mode: heat
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.bedroom_current_temperature")|float(21)
          > max(25, states("sensor.bedroom_target_temperature")|float(21) + 3) }}'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      sequence:
      - variables:
          mode: cool
    - conditions:
      - condition: numeric_state
        entity_id: sensor.bedroom_air_quality_score
        below: 50
      - condition: state
        entity_id: binary_sensor.bedroom_window_sensor_door
        state: 'off'
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        above: 59
      sequence:
      - variables:
          mode: filter
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      sequence: []
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_light
        state: 'on'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.bedroom_air_purifier_night_mode
    default:
    - action: switch.turn_on
      target:
        entity_id: switch.bedroom_air_purifier_night_mode
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.bedroom_air_purifier
          state:
          - 'off'
      sequence:
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 225
          angle_high: 225
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
    - conditions:
      - condition: template
        value_template: '{{ mode == ''heat'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ min(states(''sensor.bedroom_target_temperature'')|float(0)
            + 3, 37) }}'
          hvac_mode: heat
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
    - conditions:
      - condition: template
        value_template: '{{ mode == ''cool'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ max(1, states(''sensor.bedroom_target_temperature'')|float(0)
            - 3) }}'
          hvac_mode: cool
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
    - conditions:
      - condition: template
        value_template: '{{ mode == ''fan'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ states(''sensor.bedroom_current_temperature'')|float(21)
            }}'
          hvac_mode: cool
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_percentage
        metadata: {}
        data:
          percentage: 100
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Normal
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
    - conditions:
      - condition: template
        value_template: '{{ mode == ''filter'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: cool
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: reverse
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1739712804347'
  alias: Todo postkasse
  description: Opret todo opgaver vedrørende postkasse
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_vibration_sensor_mailbox_vibration
    from: 'off'
    to: 'on'
    id: new_post
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - new_post
    then:
    - action: script.create_todo_task
      data:
        subject: Tøm postkasse
        description: Der er nye breve i postkassen ved vejen
        related_entity_id: binary_sensor.driveway_vibration_sensor_mailbox_vibration
        entity_id: todo.todo_smart_todo
  mode: restart
  trace:
    stored_traces: 30
- id: '1739714838791'
  alias: Todo smart todo oprydning
  description: Automatik der sletter afsluttede opgaver fra smart todo listen
  triggers:
  - trigger: time
    at: 03:05:00
  conditions: []
  actions:
  - action: script.cleanup_todo_tasks
    data:
      entity_id: todo.todo_smart_todo
      date: '{{ (now() - timedelta(days=2)).date() }}'
    response_variable: response
  - action: system_log.write
    data:
      level: info
      message: 'Deleted: {{ response.deleted }} '
  mode: restart
  trace:
    stored_traces: 30
- id: '1739742119703'
  alias: Hjem smart todo Tabo
  description: Kontroller batteri status på Tado enheder
  triggers:
  - trigger: time
    at: 03:20:00
  conditions: []
  actions:
  - action: rest_command.tado_get_auth_token
    data:
      secrets:
        tado_username: '{{ states(''sensor.tado_username'') }}'
        tado_password: '{{ states(''sensor.tado_password'') }}'
        tado_client_secret: '{{ states(''sensor.tado_client_secret'') }}'
    response_variable: response
  - variables:
      token: '{{ response.content.access_token }}'
  - action: rest_command.tado_get_profile
    data:
      bearer_token: '{{ token }}'
    response_variable: response
  - variables:
      home_id: '{{ response.content.homes[0].id }}'
  - action: rest_command.tado_get_rooms_and_devices
    data:
      home_id: '{{ home_id }}'
      bearer_token: '{{ token }}'
    response_variable: response
  - variables:
      devices: "[\n  {% for room in response.content.rooms %}\n    {% for device in
        room.devices %}\n      {\n        \"roomName\": \"{{ room.roomName }}\",\n
        \       \"deviceSerialNo\": \"{{ device.serialNumber }}\",\n        \"batteryState\":
        \"{{ device.batteryState }}\",\n        \"type\": \"{{ state_attr('sensor.tado_device_types',
        'types').get(device.type, device.type) }}\",\n        \"location\": \"{{ state_attr('sensor.tado_device_locations',
        'locations').get(device.serialNumber, device.serialNumber) }}\",\n        \"entity_id\":
        \"{{ state_attr('sensor.tado_device_ids', 'ids').get(device.serialNumber,
        device.serialNumber) }}\",\n        \"battery\": \"{{ state_attr('sensor.tado_device_batterys',
        'batterys').get(device.type, device.type) }}\",\n      }{% if not loop.last
        %}, {% endif %}\n    {% endfor %}\n  {% if not loop.last %}, {% endif %}\n
        \ {% endfor %}\n]"
  - repeat:
      count: '{{ devices | length }}'
      sequence:
      - action: system_log.write
        metadata: {}
        data:
          level: debug
          message: '{{ devices[repeat.index - 1] }}'
      - action: script.home_create_todo_task
        data:
          subject: Skift batteri på {{ devices[repeat.index - 1].type }} i {{ devices[repeat.index
            - 1].roomName }}{{ '' if not devices[repeat.index - 1].location else '
            (' ~ devices[repeat.index - 1].location ~ ')'}}
          description: 'Skift batteri på Tado {{ devices[repeat.index - 1].type }}
            med serie no {{ devices[repeat.index - 1].deviceSerialNo }}, der er pladseret
            {{ devices[repeat.index - 1].roomName }}{{ '''' if not devices[repeat.index
            - 1].location else '' ('' ~ devices[repeat.index - 1].location ~ '')''}},
            batteri status er {{ devices[repeat.index - 1].batteryState }}. Batteri:
            {{ devices[repeat.index - 1].battery }}'
          related_entity_id: '{{ devices[repeat.index - 1].entity_id }}'
          entity_id: todo.home_smart_todo
          is_active: '{{ devices[repeat.index - 1].batteryState != ''NORMAL'' }}'
  mode: restart
- id: '1739744093398'
  alias: Todo IKEA rullegardiner
  description: Kontroller batteri status på IKEA rullegardiner
  triggers:
  - trigger: state
    entity_id:
    - sensor.bedroom_blind_battery
    - sensor.emils_room_blind_battery
    - sensor.charlies_room_blind_battery
    - sensor.bedroom_blind_open_close_remote_battery
    - sensor.emils_room_blind_open_close_remote_battery
    - sensor.charlies_room_blind_open_close_remote_battery
  - trigger: time
    at: 03:12:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.bedroom_blind_battery
        battery_type: Genopladelig batteripakke
      - entity_id: sensor.emils_room_blind_battery
        battery_type: Genopladelig batteripakke
      - entity_id: sensor.charlies_room_blind_battery
        battery_type: Genopladelig batteripakke
      - entity_id: sensor.bedroom_blind_open_close_remote_battery
      - entity_id: sensor.emils_room_blind_open_close_remote_battery
      - entity_id: sensor.charlies_room_blind_open_close_remote_battery
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          d: '{{ device_attr(device_id(repeat.item.entity_id), ''name_by_user'') }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: "{% if repeat.item.battery_type is defined %}\n  {{ repeat.item.battery_type
            }}\n{% else %}\n  {{ state_attr(repeat.item.entity_id, 'battery_quantity')
            ~ ' * ' ~ state_attr(repeat.item.entity_id, 'battery_size') }}\n{% endif
            %}"
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på {{ d }}
            description: 'Batteri niveau er {{ l }}% på {{ d }}, placeret i {{ a }}.
              Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 5 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1739816800938'
  alias: Todo Roborock
  description: Kontroller status på robostøvsuger
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_robot_vacuum_dock_error
    - sensor.living_room_robot_vacuum_error
  - trigger: time
    at: 04:01:00
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Løs problem med Dobbys hus ({{ states('sensor.living_room_robot_vacuum_dock_error')
        }})
      description: Advarsel på Roborock docking station. Kode {{ states('sensor.living_room_robot_vacuum_dock_error')
        }}
      related_entity_id: sensor.living_room_robot_vacuum_dock_error
      entity_id: todo.todo_smart_todo
      is_active: '{{ states(''sensor.living_room_robot_vacuum_dock_error'') != ''ok''
        }}'
  - action: script.create_todo_task
    data:
      subject: Løs problem med Dobby ({{ states('sensor.living_room_robot_vacuum_error')
        }})
      description: Advarsel på Roborock robot støvsuger. Kode {{ states('sensor.living_room_robot_vacuum_error')
        }}
      related_entity_id: sensor.living_room_robot_vacuum_error
      entity_id: todo.todo_smart_todo
      is_active: '{{ states(''sensor.living_room_robot_vacuum_error'') != ''none''
        }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1739904709484'
  alias: Hjem smart todo Netatmo
  description: Kontroller batteri status på Netatmo enheder
  triggers:
  - trigger: state
    entity_id:
    - sensor.garage_weather_station_battery_netatmo
    - sensor.garden_anemometer_battery_netatmo
    - sensor.garden_rain_gauge_battery_netatmo
    - sensor.garden_weather_station_battery_netatmo
    - sensor.greenhouse_weather_station_battery_netatmo
    - sensor.technic_weather_station_battery_netatmo
  - trigger: time
    at: 03:13:00
  conditions: []
  actions:
  - action: script.home_create_todo_task
    data:
      subject: Skift batteri på vejrstation inde i garagen
      description: 'Batteri niveau er {{ states(''sensor.garage_weather_station_battery_netatmo'')
        }}% på Netatmo vejrstationen der står inde i garagen. Batteri: 4 * AAA'
      related_entity_id: sensor.garage_weather_station_battery_netatmo
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.garage_weather_station_battery_netatmo'')|int
        < 5 }}'
  - action: script.home_create_todo_task
    data:
      subject: Problem med strøm til vindmåler
      description: Vindmåleren er tilsluttet strømforsyning, kontroller strømforsyning
        der sidder i teknikrummet og vindmåleren der sidder på gavlen på nord siden
        ved tagryggen
      related_entity_id: sensor.garden_anemometer_battery_netatmo
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.garden_anemometer_battery_netatmo'')|int < 5
        }}'
  - action: script.home_create_todo_task
    data:
      subject: Skift batteri på regnmåler
      description: 'Batteri niveau er {{ states(''sensor.garden_rain_gauge_battery_netatmo'')
        }}% på Netatmo regnmålet, der er pladseret på galven på nord siden, ned den
        overdækkede terrasse. Batteri: 2 * AAA'
      related_entity_id: sensor.garden_rain_gauge_battery_netatmo
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.garden_rain_gauge_battery_netatmo'')|int < 5
        }}'
  - action: script.home_create_todo_task
    data:
      subject: Skift batteri på udendørs vejrstation på garagen
      description: 'Batteri niveau er {{ states(''sensor.garden_weather_station_battery_netatmo'')
        }}% på Netatmo vejrstationen der sidder udvendigt på garagen. Batteri: 2 *
        AAA'
      related_entity_id: sensor.garden_weather_station_battery_netatmo
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.garden_weather_station_battery_netatmo'')|int
        < 5 }}'
  - action: script.home_create_todo_task
    data:
      subject: Skift batteri på vejrstation i drivhuset
      description: 'Batteri niveau er {{ states(''sensor.greenhouse_weather_station_battery_netatmo'')
        }}% på Netatmo vejrstationen i drivhuset. Batteri: 4 * AAA'
      related_entity_id: sensor.greenhouse_weather_station_battery_netatmo
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.greenhouse_weather_station_battery_netatmo'')|int
        < 5 }}'
  - action: script.home_create_todo_task
    data:
      subject: Skift batteri på vejrstation i teknikrummet
      description: 'Batteri niveau er {{ states(''sensor.technic_weather_station_battery_netatmo'')
        }}% på Netatmo vejrstationen i teknikrummet. Batteri: 4 * AAA'
      related_entity_id: sensor.technic_weather_station_battery_netatmo
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.technic_weather_station_battery_netatmo'')|int
        < 5 }}'
  mode: restart
- id: '1739906369450'
  alias: Todo Philips Hue kontakter
  description: Kontroller batteri status på Philips Hue kontakter
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_switch_battery
    - sensor.kitchen_switch_battery
    - sensor.bedroom_switch_battery
    - sensor.hallway_switch_battery
    - sensor.patio_switch_battery
    - sensor.emils_room_switch_battery
    - sensor.charlies_room_switch_battery
  - trigger: time
    at: 03:15:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.living_room_switch_battery
        battery_type: 1 * CR2032
      - entity_id: sensor.kitchen_switch_battery
        battery_type: 1 * CR2032
      - entity_id: sensor.bedroom_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.hallway_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.kitchen_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.patio_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.emils_room_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.charlies_room_switch_battery
        battery_type: 1 * CR2450
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: '{{ repeat.item.battery_type }}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på lyskontakt i {{ a }}
            description: 'Batteri niveau er {{ l }}% på Philips Hue lyskontakt, placeret
              i {{ a }}. Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 5 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1739907378753'
  alias: Todo Philips Hue bevægelsessensor
  description: Kontroller batteri status på Philips Hue bevægelsessensorer
  triggers:
  - trigger: state
    entity_id:
    - sensor.driveway_motion_sensor_entrance_battery
    - sensor.driveway_motion_sensor_house_east_battery
    - sensor.driveway_motion_sensor_house_south_battery
    - sensor.driveway_motion_sensor_street_battery
    - sensor.garden_motion_sensor_house_east_battery
    - sensor.garden_motion_sensor_house_west_battery
    - sensor.garden_motion_sensor_house_north_battery
    - sensor.entrance_motion_sensor_battery
    - sensor.utility_room_motion_sensor_battery
    - sensor.toilet_motion_sensor_battery
  - trigger: time
    at: 03:20:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.driveway_motion_sensor_entrance_battery
        battery_type: 2 * AA
        location: ved hoveddøren
      - entity_id: sensor.driveway_motion_sensor_house_south_battery
        battery_type: 2 * AA
        location: på syd gavlen
      - entity_id: sensor.driveway_motion_sensor_street_battery
        battery_type: 2 * AA
        location: ved vejen
      - entity_id: sensor.garden_motion_sensor_house_north_battery
        battery_type: 2 * AA
        location: på nord gavlen
      - entity_id: sensor.garden_motion_sensor_house_west_battery
        battery_type: 2 * AA
        location: ved soveværelset
      - entity_id: sensor.garden_motion_sensor_house_east_battery
        battery_type: 2 * AA
        location: ved bryggersdøren
      - entity_id: sensor.entrance_motion_sensor_battery
        battery_type: 2 * AAA
      - entity_id: sensor.utility_room_motion_sensor_battery
        battery_type: 2 * AAA
      - entity_id: sensor.toilet_motion_sensor_battery
        battery_type: 2 * AAA
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt område'' }}'
          b: '{{ repeat.item.battery_type }}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
          p: '{{ repeat.item.location or '''' }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}

            Location: {{ p }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på bevægelsessensor i {{ a }}{{ ', ' ~ p if p else
              '' }}
            description: 'Batteri niveau er {{ l }}% på Philips Hue bevægelsessensor,
              placeret i {{ a }}{{ '', '' ~ p if p else '''' }}. Batteritype: {{ b
              }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 20 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1739915975801'
  alias: Todo Philips Hue dørsensor
  description: Kontroller batteri status på Philips Hue dør og vindue sensorer
  triggers:
  - trigger: state
    entity_id:
    - sensor.bedroom_door_sensor_battery
    - sensor.garage_door_sensor_battery
  - trigger: time
    at: 03:14:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.bedroom_door_sensor_battery
        battery_type: 1 * CR2
      - entity_id: sensor.garage_door_sensor_battery
        battery_type: 1 * CR2
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: '{{ repeat.item.battery_type }}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
          t: '{{ ''vindue'' if ''window'' in i else ''dør'' }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}

            Type: {{ t }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på {{ t }} sensor i {{ a }}
            description: 'Batteri niveau er {{ l }}% på Philips Hue {{ t }} sensor,
              placeret i {{ a }}. Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 10 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1740165836750'
  alias: Oprydning todo indkøbsseddel
  description: Automatik der sletter afsluttede opgaver på indkøbsseddel
  triggers:
  - trigger: time
    at: 03:00:00
  conditions: []
  actions:
  - action: script.cleanup_todo_tasks
    data:
      entity_id: todo.todo_shopping_list
      date: '{{ (now() - timedelta(days=2)).date() }}'
    response_variable: response
  - action: system_log.write
    data:
      level: info
      message: 'Deleted: {{ response.deleted }} '
  mode: restart
  trace:
    stored_traces: 30
- id: '1740170480608'
  alias: Todo Aqara dørsensor
  description: Kontroller batteri status på Aqara dør/vindues sensorer
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_door_sensor_battery
    - sensor.living_room_window_sensor_sofa_battery
    - sensor.kitchen_window_sensor_battery
    - sensor.bedroom_window_sensor_battery
    - sensor.emils_room_window_sensor_battery
    - sensor.charlies_room_window_sensor_battery
    - sensor.patio_door_sensor_battery
  - trigger: time
    at: 03:10:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.living_room_door_sensor_battery
        battery_type: sensor.living_room_door_sensor_battery_type
        location: mellem gang og stue
      - entity_id: sensor.living_room_window_sensor_sofa_battery
        battery_type: sensor.living_room_window_sensor_sofa_battery_type
        location: bag sofa
      - entity_id: sensor.kitchen_window_sensor_battery
        battery_type: sensor.kitchen_window_sensor_battery_type
      - entity_id: sensor.bedroom_window_sensor_battery
        battery_type: sensor.bedroom_window_sensor_battery_type
      - entity_id: sensor.emils_room_window_sensor_battery
        battery_type: sensor.emils_room_window_sensor_battery_type
      - entity_id: sensor.charlies_room_window_sensor_battery
        battery_type: sensor.charlies_room_window_sensor_battery_type
      - entity_id: sensor.patio_door_sensor_battery
        battery_type: sensor.patio_door_sensor_battery_type
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: '{{ states(repeat.item.battery_type) }}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
          t: '{{ ''vindue'' if ''window'' in i else ''dør'' }}'
          p: '{{ repeat.item.location or '''' }}'
      - action: system_log.write
        metadata: {}
        data:
          level: debug
          message: "Entity Id: {{ i }}      \nArea: {{ a }}      \nBattery type: {{
            b }}      \nLevel: {{ l }}      \nType: {{ t }}      \nLocation: {{ p
            }}"
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på {{ t }} sensor i {{ a }}
            description: 'Batteri niveau er {{ l }}% på Aqara {{ t }} sensor, placeret
              i {{ a }}{{ '' '' ~ p if p else '''' }}. Batteritype: 1 * {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 10 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1740337167224'
  alias: Todo Aqara vibrationsensor
  description: Kontroller batteri status på Aqara vibrationsensorer
  triggers:
  - trigger: state
    entity_id:
    - sensor.driveway_vibration_sensor_mailbox_vibration_battery
  - trigger: time
    at: 03:11:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.driveway_vibration_sensor_mailbox_vibration_battery
        location: postkassen
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt område'' }}'
          b: '{{ state_attr(repeat.item.entity_id, ''battery_quantity'') ~ '' * ''
            ~ state_attr(repeat.item.entity_id, ''battery_size'')}}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
          p: '{{ repeat.item.location or '''' }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}

            Location: {{ p }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på vibrationssensor i {{ a }}
            description: 'Batteri niveau er {{ l }}% på Aqara vibrationssensor, placeret
              i {{ a }}{{ '', i '' ~ p if p else '''' }}. Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 20 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1740422421448'
  alias: Monique sæt sengetid
  description: Sæt sengetid input hjælper for Monique, når webhook er kaldt
  triggers:
  - trigger: webhook
    allowed_methods:
    - POST
    local_only: false
    webhook_id: monique-set-bedtime-CNwYS0I0HIbgeRZ1GmGOxxvS
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: '{{ now() + timedelta(seconds=10) }}'
    target:
      entity_id: input_datetime.monique_bedtime_alarm
  mode: restart
  trace:
    stored_traces: 10
- id: '1740423743719'
  alias: Emil sæt sengetid
  description: Sæt sengetid input hjælper for Emil, når webhook er kaldt
  triggers:
  - trigger: webhook
    allowed_methods:
    - POST
    local_only: false
    webhook_id: emil-set-bedtime-06NToCv45RaHexKeI8Smp4d-
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: '{{ now() + timedelta(seconds=10) }}'
    target:
      entity_id: input_datetime.emil_bedtime_alarm
  mode: restart
  trace:
    stored_traces: 10
- id: '1740423776035'
  alias: Charlie sæt sengetid
  description: Sæt sengetid input hjælper for Charlie, når webhook er kaldt
  triggers:
  - trigger: webhook
    allowed_methods:
    - POST
    local_only: false
    webhook_id: charlie-set-bedtime-o80tZ1S3giYimCOs0ZQ4Xloc
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: '{{ now() + timedelta(seconds=10) }}'
    target:
      entity_id: input_datetime.charlie_bedtime_alarm
  mode: restart
  trace:
    stored_traces: 10
- id: '1740595186366'
  alias: Entre dørklokke
  description: Trigger når dørklokke er aktiveret
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.entrance_doorbell_ringing_eufy
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - parallel:
    - action: light.turn_on
      metadata: {}
      data:
        flash: short
      target:
        label_id: dorklokke_lamper
    - if:
      - condition: state
        entity_id: light.garage_light_main_philips_hue
        state: 'on'
      then:
      - repeat:
          count: 2
          sequence:
          - action: light.turn_off
            metadata: {}
            data: {}
            target:
              entity_id: light.garage_light_main_philips_hue
          - delay:
              hours: 0
              minutes: 0
              seconds: 0
              milliseconds: 200
          - action: light.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: light.garage_light_main_philips_hue
          - delay:
              hours: 0
              minutes: 0
              seconds: 0
              milliseconds: 200
  mode: queued
- id: '1740779558756'
  alias: Hjem smart todo affald
  description: Automation til at oprette todo for at tømme affald og tage affaldscontainer
    på til vejen
  triggers:
  - trigger: time
    at: '10:00:00'
  conditions: []
  actions:
  - action: rest_command.perfect_waste_get_next_address_collection
    metadata: {}
    data:
      addressID: '17545'
      municipality: 253
    response_variable: response
  - variables:
      pickup_date: '{{ as_datetime(response.content.result.date).date() }}'
      tomorrow: '{{ now().date() + timedelta(days=1) }}'
      today: '{{ now().date() }}'
      status: '{{ response.status }}'
      containers: "{% set ns = namespace(fractions=[]) %}\n{% for fraction in response.content.result.fractions
        %}\n  {% set ns.fractions = ns.fractions + [fraction.fractionName] %}\n{%
        endfor %}\n{{ ns.fractions }}"
      description_text: "Følgende affaldscontainere skal køres op til vejen i dag:
        <ul> {% for c in containers %}\n  <li>{{ c }}</li>\n{% endfor %} </ul>"
  - action: system_log.write
    metadata: {}
    data:
      level: debug
      message: '"Pickup date: {{ pickup_date }}"

        "Tomorrow: {{ tomorrow }}"'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ status != 200 }}'
      sequence:
      - action: persistent_notification.create
        metadata: {}
        data:
          message: 'Status: {{ status }}

            Response: {{ response }}              '
          title: Unable to find next garbage pickup
    - conditions:
      - condition: template
        value_template: '{{ pickup_date == tomorrow }}'
      sequence:
      - action: input_datetime.set_datetime
        metadata: {}
        data:
          date: '{{ pickup_date }}'
        target:
          entity_id: input_datetime.home_garbage_pickup_date
      - action: script.home_create_todo_task
        data:
          subject: Kør affaldscontainer op til vejen
          description: '{{ description_text }}'
          related_entity_id: rest_command.perfect_waste_get_next_address_collection
          entity_id: todo.home_smart_todo
          is_active: 'true'
  - if:
    - condition: template
      value_template: '{{ states(''input_datetime.home_garbage_pickup_date'') == today
        }}'
    then:
    - action: input_datetime.set_datetime
      metadata: {}
      data:
        date: '{{ pickup_date }}'
      target:
        entity_id: input_datetime.home_garbage_pickup_date
    - action: script.home_create_todo_task
      data:
        subject: Hent affaldscontainer ved vejen
        description: Hent affaldscontainere ved vejen og sæt tilbage bag garagen.
        related_entity_id: rest_command.perfect_waste_get_next_address_collection
        entity_id: todo.home_smart_todo
        is_active: 'true'
  - if:
    - condition: template
      value_template: '{{ now().weekday() == 1 }}'
    then:
    - action: script.home_create_todo_task
      data:
        subject: Tøm affald
        description: Tøm alle affaldsspande i huset, inklusiv toiletter, værelser,
          og bryggers
        related_entity_id: rest_command.perfect_waste_get_next_address_collection
        entity_id: todo.home_smart_todo
        is_active: 'true'
  mode: queued
- id: '1740941401019'
  alias: Hjem smart todo iPhone
  description: Automatik til at kontroller iPhone status
  triggers:
  - trigger: state
    entity_id:
    - sensor.anders_iphone_location_permission
    - sensor.monique_iphone_location_permission
    - sensor.emil_iphone_location_permission
    - sensor.charlie_iphone_location_permission
  - trigger: state
    entity_id:
    - sensor.anders_iphone_connection_type
    - sensor.monique_iphone_connection_type
    - sensor.emil_iphone_connection_type
    - sensor.charlie_iphone_connection_type
    to: Wi-Fi
  - trigger: time
    at: 05:00:00
  conditions: []
  actions:
  - action: script.home_create_todo_task
    metadata: {}
    data:
      subject: Skift lokations tilladelse for Anders iPhone til altid
      description: I indstilinger under Anonymitet & sikkerhed og Lokalitetstjenester,
        sæt tilladelse for appen Home Assistant til altid og præcis lokation
      related_entity_id: sensor.anders_iphone_location_permission
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.anders_iphone_location_permission'') != ''Authorized
        Always''  }}'
  - action: script.home_create_todo_task
    metadata: {}
    data:
      subject: Skift lokations tilladelse for Monqiue iPhone til altid
      description: I indstilinger under Anonymitet & sikkerhed og Lokalitetstjenester,
        sæt tilladelse for appen Home Assistant til altid og præcis lokation
      related_entity_id: sensor.monique_iphone_location_permission
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.monique_iphone_location_permission'') != ''Authorized
        Always''  }}'
  - action: script.home_create_todo_task
    metadata: {}
    data:
      subject: Skift lokations tilladelse for Emil iPhone til altid
      description: I indstilinger under Anonymitet & sikkerhed og Lokalitetstjenester,
        sæt tilladelse for appen Home Assistant til altid og præcis lokation
      related_entity_id: sensor.emil_iphone_location_permission
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.emil_iphone_location_permission'') != ''Authorized
        Always''  }}'
  - action: script.home_create_todo_task
    metadata: {}
    data:
      subject: Skift lokations tilladelse for Charlie iPhone til altid
      description: I indstilinger under Anonymitet & sikkerhed og Lokalitetstjenester,
        sæt tilladelse for appen Home Assistant til altid og præcis lokation
      related_entity_id: sensor.charlie_iphone_location_permission
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.charlie_iphone_location_permission'') != ''Authorized
        Always''  }}'
  - if:
    - condition: state
      entity_id: sensor.anders_iphone_connection_type
      state: Wi-Fi
    then:
    - data:
        entity_id:
        - device_tracker.anders_iphone
      action: homeassistant.update_entity
    - action: notify.mobile_app_anders_iphone
      data:
        message: request_location_update
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: script.home_create_todo_task
      metadata: {}
      data:
        subject: Problem med lokation opdating fra Anders iPhone
        description: Lokationen fra Anders iPhone er ikke bleve opdateret som forventet,
          kontroller indstillinger for Home Assistant app'en
        related_entity_id: device_tracker.anders_iphone
        entity_id: todo.home_smart_todo
        is_active: '{{ (as_timestamp(now()) - as_timestamp(states.device_tracker.anders_iphone.last_updated))
          > 60 }}'
  - if:
    - condition: state
      entity_id: sensor.monique_iphone_connection_type
      state: Wi-Fi
    then:
    - data:
        entity_id:
        - device_tracker.monique_iphone
      action: homeassistant.update_entity
    - action: notify.mobile_app_monique_iphone
      data:
        message: request_location_update
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: script.home_create_todo_task
      metadata: {}
      data:
        subject: Problem med lokation opdating fra Monique iPhone
        description: Lokationen fra Monique iPhone er ikke bleve opdateret som forventet,
          kontroller indstillinger for Home Assistant app'en
        related_entity_id: device_tracker.monique_iphone
        entity_id: todo.home_smart_todo
        is_active: '{{ (as_timestamp(now()) - as_timestamp(states.device_tracker.monique_iphone.last_updated))
          > 60 }}'
  - if:
    - condition: state
      entity_id: sensor.emil_iphone_connection_type
      state: Wi-Fi
    then:
    - data:
        entity_id:
        - device_tracker.emil_iphone
      action: homeassistant.update_entity
    - action: notify.mobile_app_emil_iphone
      data:
        message: request_location_update
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: script.home_create_todo_task
      metadata: {}
      data:
        subject: Problem med lokation opdating fra Emil iPhone
        description: Lokationen fra Emil iPhone er ikke bleve opdateret som forventet,
          kontroller indstillinger for Home Assistant app'en
        related_entity_id: device_tracker.emil_iphone
        entity_id: todo.home_smart_todo
        is_active: '{{ (as_timestamp(now()) - as_timestamp(states.device_tracker.emil_iphone.last_updated))
          > 60 }}'
  - if:
    - condition: state
      entity_id: sensor.charlie_iphone_connection_type
      state: Wi-Fi
    then:
    - data:
        entity_id:
        - device_tracker.charlie_iphone
      action: homeassistant.update_entity
    - action: notify.mobile_app_charlie_iphone
      data:
        message: request_location_update
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: script.home_create_todo_task
      metadata: {}
      data:
        subject: Problem med lokation opdating fra Charlie iPhone
        description: Lokationen fra Charlie iPhone er ikke bleve opdateret som forventet,
          kontroller indstillinger for Home Assistant app'en
        related_entity_id: device_tracker.charlie_iphone
        entity_id: todo.home_smart_todo
        is_active: '{{ (as_timestamp(now()) - as_timestamp(states.device_tracker.charlie_iphone.last_updated))
          > 60 }}'
  mode: single
- id: '1740945196728'
  alias: Hjem kontrol af døre
  description: Kontroller vigtige state når forældre ligger sig til at sove
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.parent_sleeping
    from: 'off'
    to: 'on'
    id: parent_in_bed
  - trigger: state
    entity_id:
    - binary_sensor.emil_sleeping
    from: 'off'
    to: 'on'
    id: emil_in_bed
  - trigger: state
    entity_id:
    - binary_sensor.charlie_sleeping
    from: 'off'
    to: 'on'
    id: charlie_in_bed
  - trigger: state
    entity_id:
    - binary_sensor.anders_home
    from: 'off'
    to: 'on'
    id: anders_leaving
  - trigger: state
    entity_id:
    - binary_sensor.monique_home
    from: 'off'
    to: 'on'
    id: monique_leaving
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_leaving
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'off'
    to: 'on'
    id: charlie_leaving
  - trigger: state
    entity_id:
    - timer.bedroom_light_sunset_timer
    to: active
    id: sunset
  conditions: []
  actions:
  - if:
    - condition: or
      conditions:
      - condition: trigger
        id:
        - parent_in_bed
      - condition: trigger
        id:
        - sunset
    then:
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.entrance_door_lock_yale
          state: locked
      then:
      - if:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'on'
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'on'
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.utility_room_door_lock_yale
          state: locked
      then:
      - if:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'on'
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'on'
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.garage_door_lock_yale
          state: locked
      then:
      - if:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'on'
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'on'
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
    - action: lock.lock
      metadata: {}
      data: {}
      target:
        entity_id: lock.volvo_xc40_lock
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.volvo_xc40_lock
          state: locked
      - condition: state
        entity_id: device_tracker.volvo_xc40_location
        state: home
      then:
      - if:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'on'
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'on'
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  - if:
    - condition: trigger
      id:
      - emil_in_bed
    then:
    - action: lock.lock
      metadata: {}
      data: {}
      target:
        entity_id: lock.volvo_ex30_lock
    - if:
      - condition: state
        entity_id: device_tracker.volvo_ex30_location
        state: home
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.volvo_ex30_lock
          state: locked
      then:
      - action: notify.mobile_app_emil_iphone
        data:
          message: Bilen (Volvo EX30) er ikke låst
          data:
            push:
              sound:
                name: default
                critical: 1
                volume: 1
    - if:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.parent_sleeping
          state: 'on'
        - condition: state
          entity_id: binary_sensor.parent_home
          state: 'off'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.entrance_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.utility_room_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.garage_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.volvo_xc40_lock
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.volvo_xc40_lock
            state: locked
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  - if:
    - condition: trigger
      id:
      - charlie_in_bed
    then:
    - if:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.parent_sleeping
          state: 'on'
        - condition: state
          entity_id: binary_sensor.parent_home
          state: 'off'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.entrance_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.utility_room_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.garage_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.volvo_xc40_lock
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.volvo_xc40_lock
            state: locked
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  - if:
    - condition: trigger
      id:
      - anders_leaving
    then:
    - if:
      - condition: and
        conditions:
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.monique_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.monique_home
            state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.emil_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.emil_home
            state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.charlie_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.charlie_home
            state: 'off'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.entrance_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.utility_room_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.garage_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.volvo_xc40_lock
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.volvo_xc40_lock
            state: locked
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        then:
        - action: notify.mobile_app_anders_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  - if:
    - condition: trigger
      id:
      - monique_leaving
    then:
    - if:
      - condition: and
        conditions:
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.anders_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.anders_home
            state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.emil_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.emil_home
            state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.charlie_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.charlie_home
            state: 'off'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.entrance_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.utility_room_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.garage_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.volvo_xc40_lock
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.volvo_xc40_lock
            state: locked
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        then:
        - action: notify.mobile_app_monique_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  - if:
    - condition: trigger
      id:
      - emil_leaving
    then:
    - if:
      - condition: state
        entity_id: device_tracker.volvo_ex30_location
        state: home
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.volvo_ex30_lock
          state: locked
      then:
      - action: notify.mobile_app_emil_iphone
        data:
          message: Bilen (Volvo EX30) er ikke låst
          data:
            push:
              sound:
                name: default
                critical: 1
                volume: 1
    - if:
      - condition: and
        conditions:
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.charlie_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.charlie_home
            state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.parent_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.parent_home
            state: 'off'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.entrance_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.utility_room_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.garage_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.volvo_xc40_lock
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.volvo_xc40_lock
            state: locked
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        then:
        - action: notify.mobile_app_emil_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  - if:
    - condition: trigger
      id:
      - charlie_leaving
    then:
    - if:
      - condition: and
        conditions:
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.emil_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.emil_home
            state: 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.parent_sleeping
            state: 'on'
          - condition: state
            entity_id: binary_sensor.parent_home
            state: 'off'
      then:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.entrance_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Hoveddøren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.utility_room_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Bryggers døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.garage_door_lock_yale
            state: locked
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Garage døren er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.volvo_xc40_lock
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.volvo_xc40_lock
            state: locked
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        then:
        - action: notify.mobile_app_charlie_iphone
          data:
            message: Bilen (Volvo XC40) er ikke låst
            data:
              push:
                sound:
                  name: default
                  critical: 1
                  volume: 1
  mode: restart
- id: '1741115279443'
  alias: Hjem smart todo Canon printer
  description: Kontroller blæk status på Canon printer
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_printer_black_bk
    - sensor.living_room_printer_black_pgbk
    - sensor.living_room_printer_cyan
    - sensor.living_room_printer_magenta
    - sensor.living_room_printer_photo_blue
    - sensor.living_room_printer_yellow
    below: 15
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_printer_black_bk
    - sensor.living_room_printer_black_pgbk
    - sensor.living_room_printer_cyan
    - sensor.living_room_printer_magenta
    - sensor.living_room_printer_photo_blue
    - sensor.living_room_printer_yellow
    above: 20
  - trigger: state
    entity_id: sensor.living_room_printer
  - trigger: time
    at: 03:17:00
  conditions: []
  actions:
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_printer_black_pgbk
        state: unknown
    then:
    - action: script.home_create_todo_task
      data:
        subject: Skift sort (PGBK) blæk på printer
        description: 'Blæk niveau for sort (PGBK) er {{ states(''sensor.living_room_printer_black_pgbk'')
          }}% på Canon TS8300 printer.<br> Blæk type: Canon Pixma 580 PGBK (Black)'
        related_entity_id: sensor.living_room_printer_black_pgbk
        entity_id: todo.home_smart_todo
        is_active: '{{ states(''sensor.living_room_printer_black_pgbk'')|int < state_attr(''sensor.living_room_printer_black_pgbk'',
          ''marker_low_level'') }}'
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_printer_black_bk
        state: unknown
    then:
    - action: script.home_create_todo_task
      data:
        subject: Skift sort (BK) blæk på printer
        description: 'Blæk niveau for sort (BK) er {{ states(''sensor.living_room_printer_black_bk'')
          }}% på Canon TS8300 printer.<br> Blæk type: Canon Pixma 581 BK (Black)'
        related_entity_id: sensor.living_room_printer_black_bk
        entity_id: todo.home_smart_todo
        is_active: '{{ states(''sensor.living_room_printer_black_bk'')|int < state_attr(''sensor.living_room_printer_black_bk'',
          ''marker_low_level'') }}'
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_printer_cyan
        state: unknown
    then:
    - action: script.home_create_todo_task
      data:
        subject: Skift cyan blæk på printer
        description: 'Blæk niveau for cyan er {{ states(''sensor.living_room_printer_cyan'')
          }}% på Canon TS8300 printer.<br> Blæk type: Canon Pixma 581 C (Cyan)'
        related_entity_id: sensor.living_room_printer_cyan
        entity_id: todo.home_smart_todo
        is_active: '{{ states(''sensor.living_room_printer_cyan'')|int < state_attr(''sensor.living_room_printer_cyan'',
          ''marker_low_level'') }}'
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_printer_magenta
        state: unknown
    then:
    - action: script.home_create_todo_task
      data:
        subject: Skift magenta blæk på printer
        description: 'Blæk niveau for magenta er {{ states(''sensor.living_room_printer_magenta'')
          }}% på Canon TS8300 printer.<br> Blæk type: Canon Pixma 581 M (Magenta)'
        related_entity_id: sensor.living_room_printer_magenta
        entity_id: todo.home_smart_todo
        is_active: '{{ states(''sensor.living_room_printer_magenta'')|int < state_attr(''sensor.living_room_printer_magenta'',
          ''marker_low_level'') }}'
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_printer_photo_blue
        state: unknown
    then:
    - action: script.home_create_todo_task
      data:
        subject: Skift foto blå blæk på printer
        description: 'Blæk niveau for foto blå er {{ states(''sensor.living_room_printer_photo_blue'')
          }}% på Canon TS8300 printer.<br> Blæk type: Canon Pixma 581 PB (Photo blå)'
        related_entity_id: sensor.living_room_printer_photo_blue
        entity_id: todo.home_smart_todo
        is_active: '{{ states(''sensor.living_room_printer_photo_blue'')|int < state_attr(''sensor.living_room_printer_photo_blue'',
          ''marker_low_level'') }}'
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_printer_yellow
        state: unknown
    then:
    - action: script.home_create_todo_task
      data:
        subject: Skift gul blæk på printer
        description: 'Blæk niveau for gul er {{ states(''sensor.living_room_printer_yellow'')
          }}% på Canon TS8300 printer.<br> Blæk type: Canon Pixma 581 Y (Yellow)'
        related_entity_id: sensor.living_room_printer_yellow
        entity_id: todo.home_smart_todo
        is_active: '{{ states(''sensor.living_room_printer_yellow'')|int < state_attr(''sensor.living_room_printer_yellow'',
          ''marker_low_level'') }}'
  - action: script.home_create_todo_task
    data:
      subject: Løs problem med printer
      description: 'Der er registreret et problem med Canon TS8300 printer. <br>Message:
        {{ state_attr(''sensor.living_room_printer'', ''state_message'') }}  <br>Reason:
        {{ state_attr(''sensor.living_room_printer'', ''state_reason'') }} '
      related_entity_id: sensor.living_room_printer
      entity_id: todo.home_smart_todo
      is_active: '{{ states(''sensor.living_room_printer'') not in [''printing'',
        ''idle''] }}'
  mode: restart
- id: '1741631411396'
  alias: Volvo EX30 lås
  description: Automatik til at låse bilen
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: volvo_ex30_lock
  conditions: []
  actions:
  - action: lock.lock
    metadata: {}
    data: {}
    target:
      entity_id: lock.volvo_ex30_lock
  mode: queued
- id: '1741632116231'
  alias: Volvo XC40 lås
  description: Automatik til at låse bilen
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: volvo_xc40_lock
  conditions: []
  actions:
  - action: lock.lock
    metadata: {}
    data: {}
    target:
      entity_id: lock.volvo_xc40_lock
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.volvo_xc40_update_data
  mode: queued
- id: '1741633531272'
  alias: Volvo XC40 kontrol
  description: Automatik til at kontroller status på bilen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.volvo_xc40_engine_status
    from: 'on'
    to: 'off'
    id: stop
  - trigger: state
    entity_id:
    - binary_sensor.volvo_xc40_engine_status
  - trigger: state
    entity_id:
    - timer.volvo_xc40_engine_status_timer
    to: idle
  - trigger: state
    entity_id:
    - lock.volvo_xc40_lock
    to: locked
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.volvo_xc40_engine_status
        state: 'on'
      - condition: state
        entity_id: timer.volvo_xc40_engine_status_timer
        state: active
      sequence:
      - action: timer.finish
        metadata: {}
        data: {}
        target:
          entity_id: timer.volvo_xc40_engine_status_timer
    - conditions:
      - condition: trigger
        id:
        - stop
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:10:00
        target:
          entity_id: timer.volvo_xc40_engine_status_timer
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: lock.volvo_xc40_lock
          state: locked
      - condition: state
        entity_id: timer.volvo_xc40_engine_status_timer
        state: idle
      - condition: state
        entity_id: binary_sensor.volvo_xc40_engine_status
        state: 'off'
      sequence:
      - action: notify.mobile_app_anders_iphone
        data:
          title: Bilen er ulåst!
          message: Volvo XC40 er ikke låst
          data:
            actions:
            - action: volvo_xc40_lock
              title: Lås
            push:
              sound:
                name: default
                critical: 1
                volume: 1
    - conditions:
      - condition: state
        entity_id: lock.volvo_xc40_lock
        state: locked
      - condition: state
        entity_id: timer.volvo_xc40_engine_status_timer
        state: idle
      - condition: state
        entity_id: binary_sensor.volvo_xc40_engine_status
        state: 'off'
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.volvo_xc40_door_front_left
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_door_front_right
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_door_rear_left
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_door_rear_right
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_engine_hood
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_sunroof
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_tailgate
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_window_front_left
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_window_front_right
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_window_rear_left
          state: 'on'
        - condition: state
          entity_id: binary_sensor.volvo_xc40_window_rear_right
          state: 'on'
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.volvo_xc40_tank_lid
            state: 'on'
          - condition: state
            entity_id: sensor.volvo_xc40_charging_connection_status
            state: Disconnected
      sequence:
      - action: notify.mobile_app_anders_iphone
        data:
          title: Bilen er åben!
          message: En af dørene eller vinduerne på Volvo XC40 er ikke lukket
          data:
            push:
              sound:
                name: default
                critical: 1
                volume: 1
  mode: queued
- id: '1742022528405'
  alias: Hjem overvåg utilgængelige enheder
  description: Automatik der kontrollere om nogen sensorer eller enheder er unavailable
    og opretter en To Do-opgave.
  triggers:
  - minutes: /30
    trigger: time_pattern
  conditions: []
  actions:
  - variables:
      monitored_entities:
      - binary_sensor.bedroom_door_sensor_opening_philips_hue
      - binary_sensor.garage_door_sensor_opening_philips_hue
      - binary_sensor.living_room_door_sensor_open_aqara
      - binary_sensor.emils_room_window_sensor_open_aqara
      - binary_sensor.driveway_motion_sensor_street_opening_signify
      - binary_sensor.driveway_motion_sensor_house_east_opening_signify
      - binary_sensor.driveway_motion_sensor_house_south_opening_signify
      - binary_sensor.driveway_motion_sensor_entrance_opening_signify
      - binary_sensor.driveway_vibration_sensor_mailbox_vibration_aqara
      - climate.living_room_heat_pump_panasonic
      - climate.home_heat_pump_panasonic
      - climate.bathroom_radiator_thermostat_floor_tado
      - climate.bathroom_radiator_thermostat_wall_tado
      - climate.utility_room_radiator_thermostat_floor_tado
      - climate.utility_room_radiator_thermostat_wall_tado
      - climate.charlies_room_radiator_thermostat_tado
      - climate.emils_room_radiator_thermostat_tado
      - climate.hallway_radiator_thermostat_tado
      - climate.kitchen_radiator_thermostat_tado
      - climate.bedroom_radiator_thermostat_tado
      - climate.living_room_radiator_thermostat_bookcase_tado
      - climate.living_room_radiator_thermostat_sofa_tado
      - climate.living_room_radiator_thermostat_dining_table_tado
      - climate.toilet_radiator_thermostat_tado
      - climate.utility_room_temperature_sensor_tado
      - cover.bedroom_blind
      - cover.emils_room_blind
      - cover.charlies_room_blind
      - device_tracker.anders_iphone
      - device_tracker.monique_iphone
      - device_tracker.emil_iphone
      - device_tracker.charlie_iphone
      - device_tracker.volvo_ex30_location
      - device_tracker.volvo_xc40_location
      - light.bedroom_light_philips_hue
      - light.charlies_room_light_philips_hue
      - light.emils_room_light_philips_hue
      - light.garage_light_main_philips_hue
      - light.garage_light_spots_philips_hue
      - light.garage_light_projector_philips_hue
      - light.hallway_light_philips_hue
      - light.living_room_light_china_cabinet_philips_hue
      - light.living_room_light_dining_table_philips_hue
      - light.living_room_light_escher_philips_hue
      - light.living_room_light_glass_cabinet_philips_hue
      - light.living_room_light_joakim_philips_hue
      - light.living_room_light_lamp_philips_hue
      - light.living_room_light_sofa_receiver_philips_hue
      - light.living_room_light_sofa_spot_philips_hue
      - light.living_room_light_sofa_window_philips_hue
      - light.living_room_tv_light_strip_philips_hue
      - light.patio_light_philips_hue
      - light.driveway_light_entrance_spot_1_signify
      - light.driveway_light_entrance_spot_2_signify
      - light.driveway_light_entrance_spot_3_signify
      - light.driveway_light_house_east_gledopto
      - light.driveway_light_house_south_gledopto
      - light.driveway_light_left_1_signify
      - light.driveway_light_left_2_signify
      - light.driveway_light_left_3_signify
      - light.driveway_light_left_4_signify
      - light.driveway_light_left_5_signify
      - light.driveway_light_left_6_signify
      - light.driveway_light_left_7_signify
      - light.driveway_light_left_8_signify
      - light.driveway_light_left_9_signify
      - lock.volvo_xc40_lock
      - lock.volvo_ex30_lock
      - lock.entrance_door_lock_yale
      - lock.utility_room_door_lock_yale
      - lock.garage_door_lock_yale
      - lock.driveway_ev_charger_lock_wallbox
      - media_player.living_room_receiver_denon
      - media_player.living_room_tv_media_player_sony_bravia
      - media_player.living_room_apple_tv_media_player
      - sensor.anders_iphone_battery_state
      - sensor.monique_iphone_battery_state
      - sensor.emil_iphone_battery_state
      - sensor.charlie_iphone_battery_state
      - sensor.volvo_ex30_charging_connection_status
      - sensor.volvo_xc40_charging_connection_status
      - sensor.driveway_ev_charger_status_description_wallbox
      - sensor.emils_room_temperature_sensor_temperature_tado
      - sensor.hallway_temperature_sensor_temperature_tado
      - sensor.living_room_temperature_sensor_temperature_tado
      - sensor.charlies_room_temperature_sensor_temperature_tado
      - sensor.utility_room_smart_plug_washer_power_aqara
      - sensor.utility_room_smart_plug_dryer_power_aqara
      unavailable_entities: "{% set ns = namespace(unavailable=[]) %} \n{% for entity
        in monitored_entities if states(entity) == 'unavailable' %}\n  {% set ns.unavailable
        = ns.unavailable + [entity] %}\n{% endfor %}\n{{ ns.unavailable }}"
      description_text: "{{ unavailable_entities | length }} utilgængelige enheder
        ud af {{ monitored_entities | length }} overvågede.<br>\nFølgende enheder
        er utilgængelige (unavailable): <ul>  \n{% for entity in unavailable_entities
        %}\n  <li>{{ state_attr(entity, 'friendly_name') | default(entity) }}</li>\n{%
        endfor %} </ul>"
  - action: system_log.write
    metadata: {}
    data:
      level: debug
      message: '"monitored_entities: {{ monitored_entities | length }}"

        "unavailable_entities: {{ unavailable_entities | length }}"'
  - action: script.home_create_todo_task
    data:
      subject: Tjek utilgængelige enheder
      description: '{{ description_text }}'
      related_entity_id: automation.home_check_unavailable_devices
      entity_id: todo.home_smart_todo
      is_active: '{{ unavailable_entities | length > 0 }}'
      must_replace: true
  mode: restart
- id: '1742241186159'
  alias: Todo vaskemaskine
  description: Opret todo opgaver vedrørende vaskemaskine
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    for:
      hours: 0
      minutes: 5
      seconds: 0
    below: '20'
    id: washer_done
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    above: '3'
    for:
      seconds: 5
    id: washer_planed
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    above: '100'
    id: washer_started
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Tøm vaskemaskinen
      description: Vaskemaskinen er færdig, tøm og tør tøjet
      related_entity_id: sensor.utility_room_smart_plug_washer_power
      entity_id: todo.todo_smart_todo
      is_active: '{{ trigger.id == ''washer_done'' }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1747337340117'
  alias: Entre lys
  description: Automatik til at styre lys i entreen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.entrance_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.entrance_motion_sensor_motion
    from: 'on'
    to: 'off'
    id: motion_ended
  - trigger: state
    entity_id:
    - timer.entrance_light_timer
    to: idle
    id: timer_ended
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_occupancy
    from: 'off'
    to: 'on'
    id: person_outside_detected
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_occupancy
    from: 'on'
    to: 'off'
    id: person_outside_cleared
  conditions: []
  actions:
  - variables:
      light: ''
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      - condition: numeric_state
        entity_id: sensor.entrance_motion_sensor_illuminance
        below: 200
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.entrance_light_timer
      - variables:
          light: 'on'
    - conditions:
      - condition: trigger
        id:
        - person_outside_detected
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.entrance_light_timer
      - variables:
          light: 'on'
    - conditions:
      - condition: trigger
        id:
        - motion_ended
        - person_outside_cleard
      - condition: state
        entity_id: binary_sensor.entrance_motion_sensor_motion
        state: 'off'
      - condition: state
        entity_id: binary_sensor.driveway_motion_sensor_entrance_occupancy
        state: 'off'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:01:00
        target:
          entity_id: timer.entrance_light_timer
    - conditions:
      - condition: trigger
        id:
        - timer_ended
        - no_one_home
      sequence:
      - variables:
          light: 'off'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ light == "on" }}

          '
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 30
          transition: 1
        target:
          entity_id:
          - light.entrance_lights
    - conditions:
      - condition: template
        value_template: '{{ light == "on" }}

          '
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 80
          transition: 1
        target:
          entity_id:
          - light.entrance_lights
    - conditions:
      - condition: template
        value_template: '{{ light == "off" }}

          '
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.entrance_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1747340588102'
  alias: Toilet lys
  description: Automatik til at styre lys på toilettet
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.toilet_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.toilet_motion_sensor_motion
    from: 'on'
    to: 'off'
    id: motion_ended
  - trigger: state
    entity_id:
    - timer.toilet_light_timer
    to: idle
    id: timer_ended
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.toilet_light_timer
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 10
          transition: 1
        target:
          entity_id:
          - light.toilet_light
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.toilet_light_timer
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          transition: 1
        target:
          entity_id:
          - light.toilet_light
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.toilet_light_timer
    - conditions:
      - condition: trigger
        id:
        - timer_ended
        - no_one_home
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.toilet_light
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1748709891445'
  alias: Bryggers lys
  description: Automatik til at styre lys i bryggerset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_motion_sensor_motion
    from: 'on'
    to: 'off'
    id: motion_ended
  - trigger: state
    entity_id:
    - timer.utility_room_light_timer
    to: idle
    id: timer_ended
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      - condition: numeric_state
        entity_id: sensor.utility_room_motion_sensor_illuminance
        below: 400
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.utility_room_light_timer
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 30
          transition: 1
        target:
          entity_id:
          - light.utility_room_lights
    - conditions:
      - condition: trigger
        id:
        - motion_started
      - condition: numeric_state
        entity_id: sensor.utility_room_motion_sensor_illuminance
        below: 400
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.utility_room_light_timer
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 80
          transition: 1
        target:
          entity_id:
          - light.utility_room_lights
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.utility_room_light_timer
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - timer_ended
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.utility_room_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760275142990'
  alias: Køkken lys
  description: Automatik til at styre lys i køkkenet
  triggers:
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_1
    attribute: event_type
    to: short_release
    id: button_1_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_1
    attribute: event_type
    to: long_release
    id: button_1_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_2
    attribute: event_type
    to: short_release
    id: button_2_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_2
    attribute: event_type
    to: long_release
    id: button_2_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_3
    attribute: event_type
    to: short_release
    id: button_3_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_3
    attribute: event_type
    to: long_release
    id: button_3_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_4
    attribute: event_type
    to: short_release
    id: button_4_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_4
    attribute: event_type
    to: long_release
    id: button_4_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    - event.living_room_switch_button_2
    - event.living_room_switch_button_3
    - event.living_room_switch_button_4
    attribute: event_type
    to: long_release
    id: living_room_button_long_press
  - trigger: state
    entity_id:
    - event.kitchen_switch_rotary
    id: rotary
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_occupancy
    to:
    - 'off'
    id: person_cleared
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_occupancy
    to:
    - 'on'
    id: person_detected
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - button_2_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 15
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - button_3_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - button_4_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
        - button_2_long
        - button_3_long
        - button_4_long
        - no_one_home
        - living_room_button_long_press
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.kitchen_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 10
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
    - conditions:
      - condition: trigger
        id:
        - person_cleared
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.living_room_light
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - person_detected
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - person_cleared
      - condition: state
        entity_id: binary_sensor.kitchen_light
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 15
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - light_on
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - rotary
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: event.kitchen_switch_rotary
            attribute: event_type
            state: clock_wise
          - condition: state
            entity_id: binary_sensor.kitchen_light
            state: 'off'
          sequence:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_pct: '{{ (state_attr(''event.kitchen_switch_rotary'', ''steps'')|float
                / 3.60)|round(0) }}'
            target:
              entity_id: light.kitchen_lights
        - conditions:
          - condition: state
            entity_id: event.kitchen_switch_rotary
            attribute: event_type
            state: clock_wise
          sequence:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_step_pct: '{{ (state_attr(''event.kitchen_switch_rotary'',
                ''steps'')|float / 3.60)|round(0) }}'
            target:
              entity_id: '{{ state_attr(''light.kitchen_lights'', ''entity_id'') |  expand()
                | selectattr(''state'', ''eq'', ''on'') |  map(attribute=''entity_id'')
                | list }}'
        default:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_step_pct: '{{ (state_attr(''event.kitchen_switch_rotary'',
              ''steps'')|float / -3.60)|round(0) }}'
          target:
            entity_id: '{{ state_attr(''light.kitchen_lights'', ''entity_id'') | expand()
              | selectattr(''state'', ''eq'', ''on'') | map(attribute=''entity_id'')
              | list }}      '
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1760825733513'
  alias: Have lys hus nord
  description: Automatik til at styre lys i haven på nord siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_north_detected
    from: 'off'
    to: 'on'
    id: detected_north
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_north_detected
    from: 'on'
    to: 'off'
    id: cleared_north
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_detected
    from: 'off'
    to: 'on'
    id: detected_east
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_detected
    from: 'on'
    to: 'off'
    id: cleared_east
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_north
        - detected_east
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_north
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_north
          - cleared_east
        - condition: state
          entity_id: binary_sensor.garden_motion_sensor_house_north_detected
          state: 'off'
        - condition: state
          entity_id: binary_sensor.garden_motion_sensor_house_east_detected
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_north
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760825948230'
  alias: Have lys hus vest
  description: Automatik til at styre lys i haven på vest siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_detected
    from: 'off'
    to: 'on'
    id: detected_west
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_detected
    from: 'on'
    to: 'off'
    id: cleared_west
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_detected
    from: 'off'
    to: 'on'
    id: detected_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_detected
    from: 'on'
    to: 'off'
    id: cleared_south
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_west
        - detected_south
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_west
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_west
          - cleared_south
        - condition: state
          entity_id: binary_sensor.garden_motion_sensor_house_west_detected
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_motion_sensor_house_south_detected
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_west
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760878547397'
  alias: Indkørsel bevægelsessensor vej
  description: Håndtering af bevægelsessensoren i indkørslen ved vejen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_occupancy
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_occupancy
    from: 'on'
    to: 'off'
    id: motion_ended
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.driveway_motion_sensor_street_timer
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.driveway_motion_sensor_street_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878795560'
  alias: Indkørsel bevægelsessensor hus syd
  description: Håndtering af bevægelsessensoren i indkørslen på syd siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_occupancy
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_occupancy
    from: 'on'
    to: 'off'
    id: motion_ended
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.driveway_motion_sensor_house_south_timer
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.driveway_motion_sensor_house_south_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878828758'
  alias: Indkørsel bevægelsessensor entre
  description: Håndtering af bevægelsessensoren i indkørslen ved hoveddøren
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_occupancy
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_occupancy
    from: 'on'
    to: 'off'
    id: motion_ended
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.driveway_motion_sensor_entrance_timer
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.driveway_motion_sensor_entrance_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878858273'
  alias: Have bevægelsessensor hus øst
  description: Håndtering af bevægelsessensoren i haven på øst siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_occupancy
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_occupancy
    from: 'on'
    to: 'off'
    id: motion_ended
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.garden_motion_sensor_house_east_timer
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.garden_motion_sensor_house_east_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878885972'
  alias: Have bevægelsessensor hus nord
  description: Håndtering af bevægelsessensoren i haven på nord siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_north_occupancy
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_north_occupancy
    from: 'on'
    to: 'off'
    id: motion_ended
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.garden_motion_sensor_house_north_timer
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.garden_motion_sensor_house_north_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878906998'
  alias: Have bevægelsessensor hus vest
  description: Håndtering af bevægelsessensoren i haven på vest siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_occupancy
    from: 'off'
    to: 'on'
    id: motion_started
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_occupancy
    from: 'on'
    to: 'off'
    id: motion_ended
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - motion_started
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.garden_motion_sensor_house_west_timer
    - conditions:
      - condition: trigger
        id:
        - motion_ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.garden_motion_sensor_house_west_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760882456215'
  alias: Have lys hus øst
  description: Automatik til at styre lys i haven på øst siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_detected
    from: 'off'
    to: 'on'
    id: detected_east
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_detected
    from: 'on'
    to: 'off'
    id: cleared_east
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'on'
    to: 'off'
    id: cleared_entrance
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_east
        - detected_entrance
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_east
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_east
          - cleared_entrance
        - condition: state
          entity_id: binary_sensor.garden_motion_sensor_house_east_detected
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_motion_sensor_entrance_detected
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_east
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760882975403'
  alias: Indkørsel lys hus syd
  description: Automatik til at styre lys i indkørslen på syd siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_detected
    from: 'off'
    to: 'on'
    id: detected_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_detected
    from: 'on'
    to: 'off'
    id: cleared_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'on'
    to: 'off'
    id: cleared_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_detected
    from: 'off'
    to: 'on'
    id: detected_street
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_detected
    from: 'on'
    to: 'off'
    id: cleared_street
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_detected
    from: 'off'
    to: 'on'
    id: detected_west
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_detected
    from: 'on'
    to: 'off'
    id: cleared_west
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_south
        - detected_entrance
        - detected_street
        - detected_west
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.driveway_light_house_south
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_south
          - cleared_entrance
          - cleared_street
          - cleared_west
        - condition: state
          entity_id: binary_sensor.driveway_motion_sensor_house_south_detected
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_motion_sensor_entrance_detected
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_motion_sensor_street_detected
          state: 'off'
        - condition: state
          entity_id: binary_sensor.garden_motion_sensor_house_west_detected
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.driveway_light_house_south
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760883022741'
  alias: Indkørsel lys entre
  description: Automatik til at styre lys i indkørslen ved hoveddøren
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_detected
    from: 'on'
    to: 'off'
    id: cleared_entrance
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_entrance
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 70
          transition: 1
          color_temp_kelvin: 2700
        target:
          entity_id:
          - light.driveway_light_entrance_spot_1
          - light.driveway_light_entrance_spot_2
          - light.driveway_light_entrance_spot_3
    - conditions:
      - condition: trigger
        id:
        - cleared_entrance
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.driveway_light_entrance_spot_1
          - light.driveway_light_entrance_spot_2
          - light.driveway_light_entrance_spot_3
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760968576162'
  alias: Soveværelse tilstedeværelse
  description: Automatik til at styre soveværelse tilstedeværelsessensor
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence_sensor_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence_sensor_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.bedroom_presence_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:05:00
        target:
          entity_id: timer.bedroom_presence_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1761149575145'
  alias: Hjem røgalarm
  description: Automatik til at styre og koordinere røgalarmer
  triggers:
  - trigger: state
    entity_id: binary_sensor.home_smoke_alarm
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - variables:
      active: "{{ states.binary_sensor\n   | selectattr('attributes.device_class',
        'equalto', 'smoke')\n   | selectattr('state', 'equalto', 'on')\n   | map(attribute='name')\n
        \  | list }}\n"
      message: "{% if active | length == 0 %}\n  Ingen røg registreret!\n{% elif active
        | length == 1 %}\n  Der er registreret røg ved {{ active[0] }}!\n{% else %}\n
        \ Der er registreret røg ved {{ active[:-1] | join(', ') }} og {{ active[-1]
        }}!\n{% endif %}  \n"
      phones:
      - notify.mobile_app_anders_iphone
  - repeat:
      for_each: '{{ phones }}'
      sequence:
      - data:
          title: Røgalarm
          message: '{{ message }}'
          data:
            push:
              sound:
                name: default
                critical: 1
                volume: 1
              interruption-level: critical
            presentation_options:
            - alert
            - sound
            - badge
        action: '{{ repeat.item }}'
  - action: siren.turn_on
    metadata: {}
    data:
      volume_level: 0.2
    target:
      entity_id:
      - siren.emils_room_smoke_alarm_siren
      - siren.charlies_room_smoke_alarm_siren
      - siren.bedroom_smoke_alarm_siren
  mode: restart
- id: '1761840992462'
  alias: Terrasse dør lås
  description: Automatik til at styre terrasse dør låsen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.patio_door_locking_timer
    to:
    - idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.patio_door
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.patio_door
        state: unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.patio_door
      - action: timer.start
        metadata: {}
        data:
          duration: 00:01:00
        target:
          entity_id: timer.patio_door_locking_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.patio_door
        state:
        - unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.patio_door
      - delay: 00:00:01
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.patio_door
            state: locked
        then:
        - variables:
            persons:
            - device: notify.mobile_app_anders_iphone
              sensor: sensor.anders_distance_from_home
            - device: notify.mobile_app_monique_iphone
              sensor: sensor.monique_distance_from_home
            - device: notify.mobile_app_emil_iphone
              sensor: sensor.emil_distance_from_home
            - device: notify.mobile_app_charlie_iphone
              sensor: sensor.charlie_distance_from_home
            notify_persons: "{% set ns = namespace(list=[]) %} {% for person in persons
              %}\n  {% set distance = states(person.sensor) | float %}\n  {% set ns.list
              = ns.list + [{'device': person.device, 'distance': distance}] %}\n{%
              endfor %}  {% set notify_persons = ns.list | selectattr('distance',
              'lt', 0.2) | list %}  {% if notify_persons | count == 0 %}\n  {% set
              first_distance = ((ns.list | sort(attribute='distance'))[0]).distance
              | float %}\n  {% set notify_persons = ns.list | selectattr('distance',
              'lt', first_distance + 2.0) | list %}\n{% endif %} {{ notify_persons
              | map(attribute='device') | list }}"
            title: Advarsel
            message: Terrassedøren kunne ikke låses automatisk!
        - action: persistent_notification.create
          data:
            title: '{{ title }}'
            message: '{{ message }}'
            notification_id: patio_door_auto_lock_warning
        - repeat:
            for_each: '{{ notify_persons }}'
            sequence:
            - action: '{{ repeat.item }} '
              data:
                title: '{{ title }}'
                message: '{{ message }}'
                data:
                  push:
                    sound:
                      name: default
                      critical: 1
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1763801218547'
  alias: Hjem ventilation forvarme
  description: Styring af forvarme til Nilan ventilationsanlæg
  triggers:
  - trigger: state
    entity_id: binary_sensor.everyone_sleeping
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: numeric_state
    entity_id: sensor.home_outside_current_temperature
    below: 1
  - trigger: numeric_state
    entity_id: sensor.home_outside_current_temperature
    above: 3
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.home_outside_current_temperature
        below: 1
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'off'
      sequence:
      - action: switch.turn_on
        target:
          entity_id: switch.storage_smart_plug_ventilation_preheating
    - conditions:
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.home_outside_current_temperature
          above: 3
        - condition: state
          entity_id: binary_sensor.someone_home
          state: 'off'
        - condition: state
          entity_id: binary_sensor.everyone_sleeping
          state: 'on'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.storage_smart_plug_ventilation_preheating
  mode: restart
  trace:
    stored_traces: 30
- id: '1763826566164'
  alias: Hjem dør lås
  description: Kontrol af at dører er låst
  triggers:
  - trigger: state
    entity_id:
    - lock.entrance_door
    - lock.patio_door
    - lock.utility_room_door
    - lock.garage_door
    to: unlocked
    id: door_unlocked
  - trigger: state
    entity_id:
    - lock.entrance_door
    - lock.patio_door
    - lock.utility_room_door
    - lock.garage_door
    to:
    - unlocked
    id: door_unlocked_10m
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: event
    event_type: home_door_lock
    id: lock
  - trigger: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: DOOR_LOCK_ACTION
    id: lock_action
  - trigger: state
    entity_id:
    - timer.home_door_locking_timer
    to:
    - idle
    id: locking_expired
  conditions: []
  actions:
  - variables:
      persons:
      - device: notify.mobile_app_anders_iphone
        sensor: sensor.anders_distance_from_home
      - device: notify.mobile_app_monique_iphone
        sensor: sensor.monique_distance_from_home
      - device: notify.mobile_app_emil_iphone
        sensor: sensor.emil_distance_from_home
      - device: notify.mobile_app_charlie_iphone
        sensor: sensor.charlie_distance_from_home
      notify_persons: "{% set ns = namespace(list=[]) %}\n{% for person in persons
        %}\n  {% set distance = states(person.sensor) | float %}\n  {% set ns.list
        = ns.list + [{\n      'device': person.device,\n      'distance': distance\n
        \ }] %}\n{% endfor %} \n{% set notify_persons = ns.list | selectattr('distance',
        'lt', 0.2) | list %} \n{% if notify_persons | count == 0 %}\n  {% set first_distance
        = ((ns.list | sort(attribute='distance'))[0]).distance | float %}\n  {% set
        notify_persons = ns.list | selectattr('distance', 'lt', first_distance + 2.0)
        | list %}\n{% endif %}\n{{ notify_persons | map(attribute='device') | list
        }}"
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: and
          conditions:
          - condition: trigger
            id:
            - door_unlocked
          - condition: state
            entity_id: binary_sensor.someone_home
            state: 'off'
        - condition: and
          conditions:
          - condition: trigger
            id:
            - door_unlocked_10m
          - condition: state
            entity_id: binary_sensor.everyone_sleeping
            state: 'on'
      sequence:
      - variables:
          title: Information
          message: 'Følgende døre er ulåste:

            {% for door in doors | select(''is_state'', ''unlocked'') | list -%}

            - {{ state_attr(door, ''friendly_name'') }}

            {% endfor -%}'
      - data:
          title: '{{ title }}'
          message: '{{ message }}'
          notification_id: home_door_lock_warning
        action: persistent_notification.create
      - repeat:
          for_each: '{{ notify_persons }}'
          sequence:
          - data:
              title: '{{ title }}'
              message: '{{ message }}'
              data:
                push:
                  category: DOOR_LOCK
                  actions:
                  - action: home_door_lock
                    title: Lås
                  sound:
                    name: default
            action: '{{ repeat.item }} '
    - conditions:
      - condition: trigger
        id:
        - lock
        - lock_action
      sequence:
      - repeat:
          for_each: '{{ doors }}'
          sequence:
          - if:
            - condition: template
              value_template: '{{ is_state(repeat.item, ''unlocked'') }}'
            then:
            - target:
                entity_id: '{{ repeat.item }}'
              action: lock.lock
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.home_door_locking_timer
    - conditions:
      - condition: trigger
        id:
        - locking_expired
      - condition: template
        value_template: '{{ doors | select(''is_state'', ''unlocked'') | list | count
          > 0 }}

          '
      sequence:
      - variables:
          title: Advarsel
          message: "Følgende døre kunne ikke fjern låses: \n{% for door in doors |
            select('is_state', 'unlocked') | list -%}\n- {{ state_attr(door, 'friendly_name')
            }}\n{% endfor -%}"
      - data:
          title: '{{ title }}'
          message: '{{ message }}'
          notification_id: home_door_lock_warning
        action: persistent_notification.create
      - repeat:
          for_each: '{{ notify_persons }}'
          sequence:
          - data:
              title: '{{ title }}'
              message: '{{ message }}'
              data:
                push:
                  sound:
                    name: default
                    critical: 1
            action: '{{ repeat.item }} '
  variables:
    doors:
    - lock.entrance_door
    - lock.patio_door
    - lock.utility_room_door
    - lock.garage_door
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1763846508906'
  alias: Bryggers dør lås
  description: Automatik til at låse bryggersdøren op og i baseret på hvem der er
    hjemme
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.utility_room_door_locking_timer
    to: idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.utility_room_door
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.utility_room_door
        state: unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.utility_room_door
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.utility_room_door_locking_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.utility_room_door
        state:
        - unlocked
      sequence:
      - variables:
          persons:
          - device: notify.mobile_app_anders_iphone
            sensor: sensor.anders_distance_from_home
          - device: notify.mobile_app_monique_iphone
            sensor: sensor.monique_distance_from_home
          - device: notify.mobile_app_emil_iphone
            sensor: sensor.emil_distance_from_home
          - device: notify.mobile_app_charlie_iphone
            sensor: sensor.charlie_distance_from_home
          notify_persons: "{% set ns = namespace(list=[]) %} {% for person in persons
            %}\n  {% set distance = states(person.sensor) | float %}\n  {% set ns.list
            = ns.list + [{'device': person.device, 'distance': distance}] %}\n{% endfor
            %}  {% set notify_persons = ns.list | selectattr('distance', 'lt', 0.2)
            | list %}  {% if notify_persons | count == 0 %}\n  {% set first_distance
            = ((ns.list | sort(attribute='distance'))[0]).distance | float %}\n  {%
            set notify_persons = ns.list | selectattr('distance', 'lt', first_distance
            + 2.0) | list %}\n{% endif %} {{ notify_persons | map(attribute='device')
            | list }}"
          title: Advarsel
          message: Bryggers døren kunne ikke låses automatisk!
      - action: persistent_notification.create
        data:
          title: '{{ title }}'
          message: '{{ message }}'
          notification_id: utility_room_door_auto_lock_warning
      - repeat:
          for_each: '{{ notify_persons }}'
          sequence:
          - action: '{{ repeat.item }} '
            data:
              title: '{{ title }}'
              message: '{{ message }}'
              data:
                push:
                  sound:
                    name: default
                    critical: 1
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1763847410643'
  alias: Garage dør lås
  description: Automatik til at låse garage døren op og i baseret på hvem der er hjemme
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.garage_door_locking_timer
    to: idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.garage_door
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.garage_door
        state: unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.garage_door
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.garage_door_locking_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.garage_door
        state:
        - unlocked
      sequence:
      - variables:
          persons:
          - device: notify.mobile_app_anders_iphone
            sensor: sensor.anders_distance_from_home
          - device: notify.mobile_app_monique_iphone
            sensor: sensor.monique_distance_from_home
          - device: notify.mobile_app_emil_iphone
            sensor: sensor.emil_distance_from_home
          - device: notify.mobile_app_charlie_iphone
            sensor: sensor.charlie_distance_from_home
          notify_persons: "{% set ns = namespace(list=[]) %} {% for person in persons
            %}\n  {% set distance = states(person.sensor) | float %}\n  {% set ns.list
            = ns.list + [{'device': person.device, 'distance': distance}] %}\n{% endfor
            %}  {% set notify_persons = ns.list | selectattr('distance', 'lt', 0.2)
            | list %}  {% if notify_persons | count == 0 %}\n  {% set first_distance
            = ((ns.list | sort(attribute='distance'))[0]).distance | float %}\n  {%
            set notify_persons = ns.list | selectattr('distance', 'lt', first_distance
            + 2.0) | list %}\n{% endif %} {{ notify_persons | map(attribute='device')
            | list }}"
          title: Advarsel
          message: Garage døren kunne ikke låses automatisk!
      - action: persistent_notification.create
        data:
          title: '{{ title }}'
          message: '{{ message }}'
          notification_id: garage_door_auto_lock_warning
      - repeat:
          for_each: '{{ notify_persons }}'
          sequence:
          - action: '{{ repeat.item }} '
            data:
              title: '{{ title }}'
              message: '{{ message }}'
              data:
                push:
                  sound:
                    name: default
                    critical: 1
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1764364029434'
  alias: Aflæs EL måler
  description: Aflæs elektricitets forbrug og gem i CSV fil
  triggers:
  - at: 00:01:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().day == 1 }}'
  actions:
  - action: shell_command.append_to_file
    metadata: {}
    data:
      line: '{{ (state_attr(''sensor.smart_me_kamstrup_omnipower_meter'', ''ValueDate'')
        | as_datetime | as_local).strftime(''%Y-%m-%dT%H:%M:%S'') }},{{ state_attr(''sensor.smart_me_kamstrup_omnipower_meter'',
        ''CounterReadingImport'') }}'
      file: /config/data/meter_reading_electricity.csv
  mode: single
- id: '1764365776080'
  alias: Læs elektricitet måler aflæsninger
  description: Indlæs elektricitet måler aflæsninger og opdater sensor
  triggers:
  - trigger: homeassistant
    event: start
  - trigger: event
    event_type: folder_data_csv
    event_data:
      status: meter_reading_electricity
  - trigger: state
    entity_id: sensor.meter_readings_electricity
    to: '0'
  conditions: []
  actions:
  - action: shell_command.csv_to_json
    metadata: {}
    data:
      csvfile: /config/data/meter_reading_electricity.csv
      jsonfile: /config/data/meter_reading_electricity.json
  - action: file.read_file
    metadata: {}
    data:
      file_name: /config/data/meter_reading_electricity.json
      file_encoding: JSON
    response_variable: readings
  - action: python_script.hass_entities
    data:
      action: set_state_attributes
      entity_id: sensor.meter_readings_electricity
      state: '{{ readings.data[-1].reading }}'
      attributes:
      - raw: '{{ readings.data }}'
  - action: python_script.meter_interpolate
    data:
      entity_id: sensor.meter_readings_electricity
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1764615121152'
  alias: Opdater iPhone location
  description: Opdater iPhone location hvis iPhone-sensorer er mere end 1 time gamle.
  triggers:
  - minutes: /10
    trigger: time_pattern
  conditions:
  - condition: template
    value_template: '{{ stale_locations | count > 0 }}'
  actions:
  - repeat:
      for_each: '{{ stale_locations }}'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.anders_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_anders_iphone
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.monique_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_monique_iphone
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.emil_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_emil_iphone
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.charlie_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_charlie_iphone
  variables:
    iphone_sensors:
    - sensor.anders_iphone_location_last_updated
    - sensor.monique_iphone_location_last_updated
    - sensor.emil_iphone_location_last_updated
    - sensor.charlie_iphone_location_last_updated
    stale_locations: "{% set ns = namespace(stale=[]) %} {% for e in iphone_sensors
      %}\n  {% set s = states(e) %}\n  {% if s not in ['unknown', 'unavailable', '']
      %}\n    {% set age = (now() - (s | as_datetime)).total_seconds() %}\n    {%
      if age > 3600 and age < 4200 %} \n      {% set ns.stale = ns.stale + [e] %}\n
      \   {% endif %}\n  {% endif %}\n{% endfor %} {{ ns.stale }}"
  mode: single
  trace:
    stored_traces: 20
- id: '1764966963610'
  alias: Aflæs vand måler
  description: Aflæs vand forbrug og gem i CSV fil
  triggers:
  - at: 00:02:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().day == 1 }}'
  actions:
  - action: shell_command.append_to_file
    metadata: {}
    data:
      line: '{{ (state_attr(''sensor.water_meter'', ''timestamp'') | as_datetime).strftime(''%Y-%m-%dT%H:%M:%S'')
        }},{{ state_attr(''sensor.water_meter'', ''total_m3'') }}'
      file: /config/data/meter_reading_water.csv
  mode: single
- id: '1764973371100'
  alias: Overvåg data folder
  description: Overvågning af data folder
  triggers:
  - trigger: state
    entity_id:
    - event.folder_watcher_config_data
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: event.folder_watcher_config_data
        state:
        - meter_reading_electricity.csv
        attribute: file
      sequence:
      - event: folder_data_csv
        event_data:
          status: meter_reading_electricity
    - conditions:
      - condition: state
        entity_id: event.folder_watcher_config_data
        state:
        - meter_reading_water.csv
        attribute: file
      sequence:
      - event: folder_data_csv
        event_data:
          status: meter_reading_water
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1764974327446'
  alias: Læs vand måler aflæsninger
  description: Indlæs vand måler aflæsninger og opdater sensor
  triggers:
  - trigger: homeassistant
    event: start
  - trigger: event
    event_type: folder_data_csv
    event_data:
      status: meter_reading_water
  - trigger: state
    entity_id: sensor.meter_readings_water
    to: '0'
  conditions: []
  actions:
  - action: shell_command.csv_to_json
    metadata: {}
    data:
      csvfile: /config/data/meter_reading_water.csv
      jsonfile: /config/data/meter_reading_water.json
  - action: file.read_file
    metadata: {}
    data:
      file_name: /config/data/meter_reading_water.json
      file_encoding: JSON
    response_variable: readings
  - action: python_script.hass_entities
    data:
      action: set_state_attributes
      entity_id: sensor.meter_readings_water
      state: '{{ readings.data[-1].reading }}'
      attributes:
      - raw: '{{ readings.data }}'
  - action: python_script.meter_interpolate
    data:
      entity_id: sensor.meter_readings_water
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1765134832184'
  alias: Køkken robotstøvsuger rengøring
  description: Styring af robotstøvsuger for at gør rent i køkkenet og bryggers
  triggers:
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  - trigger: numeric_state
    entity_id: sensor.living_room_robot_vacuum_battery
    above: 30
  - trigger: state
    entity_id: binary_sensor.living_room_media
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
    for: 00:02:00
  - trigger: state
    entity_id: binary_sensor.monique_sleep_window
    to: 'off'
    for: 00:02:00
  - trigger: state
    entity_id: binary_sensor.kitchen_occupancy
    to: 'off'
    for: 00:02:00
  - trigger: state
    entity_id: binary_sensor.utility_room_light_motion
    to: 'off'
    for: 00:02:00
  - trigger: time
    at: '11:30:00'
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_time_since_empty_dust_bin
    to: '0'
    for: 00:02:00
  conditions:
  - condition: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    state: none
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.kitchen_robot_vacuum_last_cleaning_time'')
          | as_datetime).date() != now().date() }}

          '
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      - condition: state
        entity_id: binary_sensor.living_room_media
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_occupancy
        state: 'off'
      - condition: state
        entity_id: binary_sensor.utility_room_light_motion
        state: 'off'
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          < 20 }}

          '
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: kitchen_cleaning
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.kitchen_robot_vacuum_last_cleaning_time'')
          | as_datetime | as_local).date() < (now().date() - timedelta(days=1)) }}

          '
      - condition: time
        after: '11:00:00'
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: kitchen_cleaning
          started_by: '{{ this.entity_id }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: kitchen_cleaning
      - condition: time
        weekday:
        - mon
        - wed
        - fri
        - sun
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop_low
          timeout: 15
          rooms:
          - Køkken
          - Bryggers
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.kitchen_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: kitchen_cleaning
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop
          timeout: 15
          rooms:
          - Køkken
          - Bryggers
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.kitchen_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768131852214'
  alias: Stue robotstøvsuger docked
  description: Automatic til at kontrollere robotstøvsuger
  triggers:
  - trigger: state
    entity_id: vacuum.living_room_robot_vacuum
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_status
  - trigger: state
    entity_id: timer.living_room_robot_vacuum_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: sensor.living_room_robot_vacuum_status
        state:
        - idle
        - charging
        - charging_complete
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.living_room_robot_vacuum_timer
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: none
          started_by:
            '[object Object]':
    - conditions:
      - condition: trigger
        id: timeout
      sequence:
      - action: script.living_room_robot_vacuum_dock
        metadata: {}
        data: {}
      - delay:
          minutes: 2
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: vacuum.living_room_robot_vacuum
            state: docked
          - condition: state
            entity_id: sensor.living_room_robot_vacuum_status
            state:
            - idle
            - charging
            - charging_complete
        then:
        - action: script.push_notification
          data:
            type: critical
            title: Advarsel
            id: living_room_robot_vacuum_return_to_dock
            persistent: true
            message: Robotstøvsuger kan ikke returnere til docking station
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768136225501'
  alias: Stue robotstøvsuger tøm støvbeholder
  description: Tøm støvbeholder på robotstøvsuger
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_robot_vacuum_total_cleaning_time
  - trigger: state
    entity_id: vacuum.living_room_robot_vacuum
    to: docked
  - trigger: state
    entity_id: timer.living_room_robot_vacuum_timer
    to: idle
  - trigger: state
    entity_id: binary_sensor.someone_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_media
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_door_sensor_door
    to: 'off'
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          > 10 }}

          '
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: timer.living_room_robot_vacuum_timer
        state: idle
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: none
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_media
        state: 'off'
      sequence:
      - action: script.living_room_robot_vacuum_empty_dust_bin
        metadata: {}
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          > 10 }}

          '
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: timer.living_room_robot_vacuum_timer
        state: idle
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: none
      - condition: state
        entity_id: binary_sensor.someone_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.living_room_media
        state: 'off'
      sequence:
      - action: script.living_room_robot_vacuum_empty_dust_bin
        metadata: {}
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          > 30 }}

          '
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: timer.living_room_robot_vacuum_timer
        state: idle
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: none
      sequence:
      - action: script.living_room_robot_vacuum_empty_dust_bin
        metadata: {}
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768143802884'
  alias: Gang robotstøvsuger rengøring
  description: Styring af robotstøvsuger for at gør rent i gangen
  triggers:
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  - trigger: numeric_state
    entity_id: sensor.living_room_robot_vacuum_battery
    above: 30
  - trigger: state
    entity_id: binary_sensor.living_room_media
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.someone_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.monique_sleep_window
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.hallway_occupancy
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_door_sensor_door
    to: 'on'
    for: 00:02:00
  - trigger: time
    at: '12:00:00'
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_time_since_empty_dust_bin
    to: '0'
    for: 00:02:00
  conditions:
  - condition: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    state: none
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.hallway_robot_vacuum_last_cleaning_time'')
          | as_datetime).date() != now().date() }}

          '
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 30
      - condition: state
        entity_id: binary_sensor.living_room_media
        state: 'off'
      - condition: state
        entity_id: binary_sensor.someone_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.hallway_occupancy
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'on'
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          < 20 }}

          '
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: hallway_cleaning
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.hallway_robot_vacuum_last_cleaning_time'')
          | as_datetime | as_local).date() < (now().date() - timedelta(days=1)) }}

          '
      - condition: time
        after: '11:00:00'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 30
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: hallway_cleaning
          started_by: '{{ this.entity_id }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: hallway_cleaning
      - condition: time
        weekday:
        - mon
        - thu
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop
          timeout: 15
          rooms:
          - Gang
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.hallway_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: hallway_cleaning
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop_low
          timeout: 15
          rooms:
          - Gang
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.hallway_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768144156024'
  alias: Stue robotstøvsuger rengøring
  description: Styring af robotstøvsuger for at gør rent i stuen
  triggers:
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  - trigger: numeric_state
    entity_id: sensor.living_room_robot_vacuum_battery
    above: 40
  - trigger: state
    entity_id: binary_sensor.living_room_media
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.monique_sleep_window
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_door_sensor_door
    to: 'off'
  - trigger: time
    at: '12:30:00'
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_time_since_empty_dust_bin
    to: '0'
    for: 00:02:00
  conditions:
  - condition: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    state: none
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.living_room_robot_vacuum_last_cleaning_time'')
          | as_datetime).date() != now().date() }}

          '
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      - condition: state
        entity_id: binary_sensor.living_room_media
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'off'
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          < 10 }}

          '
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: living_room_cleaning
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.living_room_robot_vacuum_last_cleaning_time'')
          | as_datetime | as_local).date() < (now().date() - timedelta(days=1)) }}

          '
      - condition: time
        after: '11:00:00'
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: living_room_cleaning
          started_by: '{{ this.entity_id }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: living_room_cleaning
      - condition: template
        value_template: "{{ now() >=\n   (states('input_datetime.living_room_robot_vacuum_last_washing_time')
          | as_datetime | as_local + timedelta(hours=82)) }}"
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop_low
          timeout: 30
          rooms:
          - Stue
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.living_room_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.living_room_robot_vacuum_last_washing_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: living_room_cleaning
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac
          timeout: 35
          rooms:
          - Stue
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.living_room_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768156511533'
  alias: Loftrum ventilationsanlæg
  description: Styring af varme genveks ventilationsanlæg
  triggers:
  - trigger: state
    entity_id:
    - sensor.home_target_maximum_temperature
  - trigger: state
    entity_id:
    - sensor.home_current_humidity
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: binary_sensor.everyone_sleeping
  - trigger: state
    entity_id: sensor.bathroom_temperature_sensor_humidity
  conditions: []
  actions:
  - action: number.set_value
    metadata: {}
    target:
      entity_id: number.storage_ventilation_system_temperature_target
    data:
      value: '{{ states(''sensor.home_target_maximum_temperature'') }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'off'
      - condition: template
        value_template: '{% set I = states(''sensor.home_current_humidity'') | float(0)
          %} {% set O = states(''sensor.home_outside_current_humidity'') | float(0)
          %} {{ I >= 60 or (I >= 48 and (I - O) >= 10) }}

          '
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: high
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '4'
        target:
          entity_id: select.storage_ventilation_system_fan_level
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'off'
      - condition: template
        value_template: '{% set I = states(''sensor.home_current_humidity'') | float(0)
          %}  {% set O = states(''sensor.home_outside_current_humidity'') | float(0)
          %} {% set B = states(''sensor.bathroom_temperature_sensor_humidity'') |
          float(0) %} {{ I >= 55 or (I >= 42 and (I - O) >= 8) or B >= I + 5 }}

          '
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: medium
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '3'
        target:
          entity_id: select.storage_ventilation_system_fan_level
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'off'
      - condition: template
        value_template: '{% set I = states(''sensor.home_current_humidity'') | float(0)
          %} {% set O = states(''sensor.home_outside_current_humidity'') | float(0)
          %} {{ I >= 50 or (I >= 36 and (I - O) >= 6) }}

          '
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: middle
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '2'
        target:
          entity_id: select.storage_ventilation_system_fan_level
    default:
    - action: climate.set_fan_mode
      data:
        fan_mode: low
      target:
        entity_id: climate.storage_ventilation_system_ventilation
    - action: select.select_option
      data:
        option: '1'
      target:
        entity_id: select.storage_ventilation_system_fan_level
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1769101770558'
  alias: Soveværelse dør
  description: Automatik til at styre timer til soveværelse dør
  triggers:
  - trigger: state
    entity_id: binary_sensor.bedroom_door_sensor_opening
    to: 'off'
    id: closed
  - trigger: state
    entity_id: binary_sensor.bedroom_door_sensor_opening
    to: 'on'
    id: opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: closed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_door_timer
    - conditions:
      - condition: trigger
        id: opened
      sequence:
      - action: timer.start
        target:
          entity_id: timer.bedroom_door_timer
        data:
          duration: 00:02:00
  mode: restart
  trace:
    stored_traces: 50
- id: '1769208997346'
  alias: Gang fotorammer
  description: Automatik for at styre fotorammer i gangen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_door
  actions:
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.bedroom_sleeping
          state: 'on'
        - condition: state
          entity_id: binary_sensor.bedroom_door
          state: 'on'
    then:
    - action: media_player.turn_off
      target:
        entity_id:
        - media_player.hallway_photo_frame_charlie
        - media_player.hallway_photo_frame_emil
        - media_player.hallway_photo_frame_joakim
    else:
    - action: media_player.turn_on
      target:
        entity_id:
        - media_player.hallway_photo_frame_charlie
        - media_player.hallway_photo_frame_emil
        - media_player.hallway_photo_frame_joakim
  mode: restart
  trace:
    stored_traces: 20
- id: '1769243684320'
  alias: Køkken varme
  description: Automatik til at styre varmen i køkkenet
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_central_heating
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
  - trigger: state
    entity_id:
    - sensor.living_room_target_temperature
  conditions: []
  actions:
  - variables:
      target: '{{ states(''sensor.living_room_target_temperature'') | float }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_central_heating
        state: 'off'
      sequence:
      - variables:
          target: 23
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - variables:
          target: 17
    - conditions:
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - variables:
          target: 19
    - conditions:
      - condition: state
        entity_id: binary_sensor.toilet_light
        state: 'on'
      sequence:
      - variables:
          target: 22
  - action: script.set_climate_temperature
    data:
      temperature: '{{ target }}'
      entities:
      - climate.kitchen_radiator_thermostat
  mode: restart
  trace:
    stored_traces: 50
- id: '1769257682123'
  alias: Stue medieafspiller
  description: Styring af tilbehør til medie afspilning i Stuen
  triggers:
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    to: 'off'
    id: 'off'
    for:
      seconds: 3
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    to: idle
    id: waiting
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    to:
    - playing
    - buffering
    id: playing
  - trigger: state
    entity_id: media_player.living_room_apple_tv_media_player
    to: paused
    id: paused
  - trigger: state
    entity_id: binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    - event.living_room_switch_button_2
    - event.living_room_switch_button_3
    - event.living_room_switch_button_4
    attribute: event_type
    to: long_release
    id: living_room_button_long_press
  conditions: []
  actions:
  - variables:
      command: pause
  - choose:
    - conditions:
      - condition: trigger
        id:
        - living_room_button_long_press
      sequence:
      - action: media_player.turn_off
        metadata: {}
        target:
          entity_id: media_player.living_room_apple_tv_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - 'off'
        - no_one_home
      - condition: template
        value_template: '{{ state_attr(''media_player.living_room_apple_tv_media_player'',
          ''source_list'') != none }}'
      sequence:
      - variables:
          command: 'off'
    - conditions:
      - condition: trigger
        id:
        - waiting
        - paused
      sequence:
      - variables:
          command: pause
    - conditions:
      - condition: trigger
        id: playing
      sequence:
      - variables:
          command: playing
  - if:
    - condition: template
      value_template: '{{ command == ''off'' }}'
    then:
    - parallel:
      - if:
        - condition: state
          entity_id: light.living_room_light_strip_receiver
          state: 'on'
        then:
        - action: light.turn_off
          data:
            transition: 1
          target:
            entity_id:
            - light.living_room_light_strip_receiver
      - if:
        - condition: state
          entity_id: light.living_room_smart_plug_receiver_accessories
          state: 'on'
        then:
        - action: light.turn_off
          target:
            entity_id: light.living_room_smart_plug_receiver_accessories
      - if:
        - condition: state
          entity_id: media_player.living_room_receiver
          state: 'on'
        then:
        - action: media_player.turn_off
          target:
            entity_id: media_player.living_room_receiver
      - if:
        - condition: state
          entity_id: switch.living_room_tv_sync_box_power
          state: 'on'
        then:
        - action: switch.turn_off
          target:
            entity_id: switch.living_room_tv_sync_box_power
    else:
    - parallel:
      - if:
        - condition: state
          entity_id: light.living_room_light_strip_receiver
          state: 'off'
        then:
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            color_temp_kelvin: 2700
            brightness_pct: 100
          target:
            entity_id:
            - light.living_room_light_strip_receiver
      - if:
        - condition: state
          entity_id: light.living_room_smart_plug_receiver_accessories
          state: 'off'
        then:
        - action: light.turn_on
          target:
            entity_id: light.living_room_smart_plug_receiver_accessories
      - if:
        - condition: state
          entity_id: media_player.living_room_receiver
          state: 'off'
        then:
        - action: media_player.turn_on
          target:
            entity_id: media_player.living_room_receiver
        - delay:
            seconds: 3
        - action: media_player.select_source
          target:
            entity_id:
            - media_player.living_room_receiver
          data:
            source: Apple TV
        - action: media_player.select_sound_mode
          target:
            entity_id: media_player.living_room_receiver
          data:
            sound_mode: DOLBY DIGITAL
        - action: media_player.volume_set
          target:
            entity_id: media_player.living_room_receiver
          data:
            volume_level: 0.27
      - if:
        - condition: state
          entity_id: switch.living_room_tv_sync_box_power
          state: 'off'
        then:
        - action: switch.turn_on
          target:
            entity_id: switch.living_room_tv_sync_box_power
    - choose:
      - conditions:
        - condition: template
          value_template: '{{ command == ''playing'' }}'
        sequence:
        - action: huesyncbox.set_sync_state
          data:
            device_id: 1cf95a14183d127c38d2f6af89ed61c5
            power: true
            sync: true
            brightness: 100
            input: input1
            entertainment_area: TV-område
            mode: video
            intensity: moderate
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.living_room_tv_sync_box_light_sync
      - conditions:
        - condition: template
          value_template: '{{ command == ''pause'' }}'
        sequence:
        - action: huesyncbox.set_sync_state
          data:
            device_id: 1cf95a14183d127c38d2f6af89ed61c5
            sync: false
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1769344314831'
  alias: Todo tørretumbler
  description: Opret todo opgaver vedrørende tørretumbler
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    for:
      hours: 0
      minutes: 3
      seconds: 0
    below: '20'
    id: dryer_done
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    above: '3'
    id: dryer_emptied
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    above: '100'
    id: dryer_started
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Tøm tørretumbler
      description: Tørretumbleren er færdig, tøm den og læg tøjet på plads
      related_entity_id: sensor.utility_room_smart_plug_dryer_power
      entity_id: todo.todo_smart_todo
      is_active: '{{ trigger.id == ''dryer_done'' }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1769363385863'
  alias: Todo Aqara temperatursensor
  description: Kontroller batteri status på Aqara temperatursensorer
  triggers:
  - trigger: state
    entity_id:
    - sensor.bathroom_temperature_sensor_battery
  - trigger: time
    at: 03:18:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.bathroom_temperature_sensor_battery
        location: oven på spejlskabet
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: '{{ state_attr(repeat.item.entity_id, ''battery_quantity'') ~ '' * ''
            ~ state_attr(repeat.item.entity_id, ''battery_size'') }}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
          p: '{{ repeat.item.location or '''' }}'
      - action: system_log.write
        metadata: {}
        data:
          level: debug
          message: "Entity Id: {{ i }}      \nArea: {{ a }}      \nBattery type: {{
            b }}      \nLevel: {{ l }}      \nLocation: {{ p }}"
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på temperatursensor i {{ a }}
            description: 'Batteri niveau er {{ l }}% på Aqara temperatursensor, placeret
              i {{ a }}{{ '' '' ~ p if p else '''' }}. Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 20 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1769364737572'
  alias: Todo Aqara vandsensor
  description: Kontroller batteri status på Aqara vandsensorer
  triggers:
  - trigger: state
    entity_id:
    - sensor.kitchen_water_leak_sensor_sink_battery
    - sensor.utility_room_water_leak_sensor_sink_battery
  - trigger: time
    at: 03:19:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.kitchen_water_leak_sensor_sink_battery
        location: under opvaskemaskinen
      - entity_id: sensor.utility_room_water_leak_sensor_sink_battery
        location: under skabet, mellem rør
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt område'' }}'
          b: '{{ state_attr(repeat.item.entity_id, ''battery_quantity'') ~ '' * ''
            ~ state_attr(repeat.item.entity_id, ''battery_size'')}}'
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
          p: '{{ repeat.item.location or '''' }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}

            Location: {{ p }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på vandsensorer i {{ a }}
            description: 'Batteri niveau er {{ l }}% på Aqara vandsensorer, placeret
              i {{ a }}{{ '', i '' ~ p if p else '''' }}. Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 10 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1769369132822'
  alias: Todo opvaskemaskine
  description: Opret todo opgaver vedrørende opvaskemaskine
  triggers:
  - trigger: state
    entity_id: sensor.kitchen_dishwasher
    to: program_ended
    id: done
  - trigger: state
    entity_id: sensor.kitchen_dishwasher
    to:
    - waiting_to_start
    - in_use
    - programmed
    id: started
  - trigger: state
    entity_id: binary_sensor.kitchen_dishwasher_notification_active
    id: notification
  - trigger: state
    entity_id: binary_sensor.kitchen_dishwasher_problem
    id: problem
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - done
        - started
      sequence:
      - action: script.create_todo_task
        data:
          subject: Tøm opvaskemaskinen
          description: Opvaskemaskine er færdig, tøm og sæt service væk
          related_entity_id: sensor.kitchen_dishwasher
          entity_id: todo.todo_smart_todo
          is_active: '{{ trigger.id == ''done'' }}'
    - conditions:
      - condition: trigger
        id: notification
      sequence:
      - action: script.create_todo_task
        data:
          subject: Besked fra opvaskemaskinen
          description: Kontroller opvaskemaskinen der er en aktiv notifikation
          related_entity_id: binary_sensor.kitchen_dishwasher_notification_active
          entity_id: todo.todo_smart_todo
          is_active: '{{ is_state(''binary_sensor.kitchen_dishwasher_notification_active'',
            ''on'') }}'
    - conditions:
      - condition: trigger
        id: problem
      sequence:
      - action: script.create_todo_task
        data:
          subject: Problem med opvaskemaskinen
          description: Kontroller opvaskemaskinen der er registreret et problem
          related_entity_id: binary_sensor.kitchen_dishwasher_problem
          entity_id: todo.todo_smart_todo
          is_active: '{{ is_state(''binary_sensor.kitchen_dishwasher_problem'', ''on'')
            }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1769452207183'
  alias: Todo Yale lås
  description: Kontroller batteri status på Yale låse
  triggers:
  - trigger: state
    entity_id:
    - sensor.entrance_door_battery
    - sensor.utility_room_door_battery
    - sensor.garage_door_battery
    - sensor.patio_door_battery
    - sensor.patio_door_keypad_battery
  - trigger: time
    at: 03:21:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.entrance_door_battery
        battery_type: 4 × AA
      - entity_id: sensor.utility_room_door_battery
        battery_type: 4 × AA
      - entity_id: sensor.garage_door_battery
        battery_type: 4 × AA
      - entity_id: sensor.patio_door_battery
        battery_type: 2 × AAA
      - entity_id: sensor.patio_door_keypad_battery
        battery_type: 4 × AAA
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          d: '{{ device_attr(device_id(repeat.item.entity_id), ''name_by_user'') }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: "{% if repeat.item.battery_type is defined %}\n  {{ repeat.item.battery_type
            }}\n{% else %}\n  {{ state_attr(repeat.item.entity_id, 'battery_quantity')
            ~ ' * ' ~ state_attr(repeat.item.entity_id, 'battery_size') }}\n{% endif
            %}"
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Device: {{ d }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på {{ d }}
            description: "<table border=\"0\">\n  <tr>\n    <th align=\"left\">Enhed</th>\n
              \   <td>{{ d }}</td>\n  </tr>\n  <tr>\n    <th align=\"left\">Batteriniveau</th>\n
              \   <td>{{ l }}</td>\n  </tr>\n  <tr>\n    <th align=\"left\">Lokation</th>\n
              \   <td>{{ a }}</td>\n  </tr>\n  <tr>\n    <th align=\"left\">Batteritype</th>\n
              \   <td>{{ b }}</td>\n  </tr>\n</table>"
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 15 }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1769704796507'
  alias: Todo Haozee Jordfugtighedssensor
  description: Kontroller batteri status på aozee Jordfugtighedssensor
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_soil_moisture_sensor_battery
    - sensor.bedroom_soil_moisture_sensor_battery
    - sensor.charlies_room_soil_moisture_sensor_battery
  - trigger: time
    at: 03:22:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.living_room_soil_moisture_sensor_battery
      - entity_id: sensor.bedroom_soil_moisture_sensor_battery
      - entity_id: sensor.charlies_room_soil_moisture_sensor_battery
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - variables:
          i: '{{ repeat.item.entity_id }}'
          d: '{{ device_attr(device_id(repeat.item.entity_id), ''name_by_user'') }}'
          a: '{{ area_name(repeat.item.entity_id) or ''ukendt rum'' }}'
          b: "{% if repeat.item.battery_type is defined %}\n  {{ repeat.item.battery_type
            }}\n{% else %}\n  {{ state_attr(repeat.item.entity_id, 'battery_quantity')
            ~ ' * ' ~ state_attr(repeat.item.entity_id, 'battery_size') }}\n{% endif
            %}"
          l: '{{ states(repeat.item.entity_id) | int(default=-1) }}'
      - action: system_log.write
        data:
          level: debug
          message: 'Entity Id: {{ i }}

            Area: {{ a }}

            Battery type: {{ b }}

            Level: {{ l }}'
      - if:
        - condition: template
          value_template: '{{ l >= 0 }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift batteri på {{ d }}
            description: 'Batteri niveau er {{ l }}% på {{ d }}, placeret i {{ a }}.
              Batteritype: {{ b }}'
            related_entity_id: '{{ i }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ l < 10 }}'
  mode: restart
  trace:
    stored_traces: 30
