- id: '1735603602121'
  alias: Stue lys
  description: Automatik til at styre lys i stuen
  triggers:
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    attribute: event_type
    to: short_release
    id: button_1_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    attribute: event_type
    to: long_release
    id: button_1_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_2
    attribute: event_type
    to: short_release
    id: button_2_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_2
    attribute: event_type
    to: long_release
    id: button_2_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_3
    attribute: event_type
    to: short_release
    id: button_3_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_3
    attribute: event_type
    to: long_release
    id: button_3_long
  - trigger: state
    entity_id:
    - event.living_room_switch_button_4
    attribute: event_type
    to: short_release
    id: button_4_short
  - trigger: state
    entity_id:
    - event.living_room_switch_button_4
    attribute: event_type
    to: long_release
    id: button_4_long
  - trigger: state
    entity_id:
    - event.living_room_switch_rotary
    id: rotary
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - binary_sensor.living_room_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_strip_skylight
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
    - conditions:
      - condition: trigger
        id:
        - button_2_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 100
        target:
          entity_id:
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.living_room_light_strip_skylight
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 75
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.living_room_light_tv_left
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
    - conditions:
      - condition: trigger
        id:
        - button_3_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2100
          brightness_pct: 80
        target:
          entity_id:
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_skylight
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
    - conditions:
      - condition: trigger
        id:
        - button_4_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_skylight
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id:
          - button_1_long
          - button_2_long
          - button_3_long
          - button_4_long
          - no_one_home
        - condition: and
          conditions:
          - condition: trigger
            id:
            - lights_on
          - condition: state
            entity_id: binary_sensor.someone_home
            state: 'off'
        - condition: and
          conditions:
          - condition: trigger
            id:
            - sleeping
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.living_room_light_bookcase_left
          - light.living_room_light_bookcase_right
          - light.living_room_light_cabinet_left
          - light.living_room_light_cabinet_right
          - light.living_room_light_tv_left
          - light.living_room_light_tv_right
          - light.living_room_light_escher
          - light.living_room_light_window_left
          - light.living_room_light_window_right
          - light.living_room_light_dining_table_spot_cabinet
          - light.living_room_light_dining_table_spot_sofa
          - light.living_room_light_strip_glass_cabinet
          - light.living_room_light_strip_skylight
          - light.living_room_light_strip_tv
          - light.living_room_light_gradient_tube_tv
          - light.living_room_smart_plug_lamp
          - light.living_room_smart_plug_christmas_elf_house
          - light.living_room_light_coffee_table_1
          - light.living_room_light_coffee_table_2
          - light.living_room_light_table_lamp_cabinet
          - light.living_room_light_table_lamp_sofa
    - conditions:
      - condition: trigger
        id:
        - rotary
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: event.living_room_switch_rotary
            attribute: event_type
            state: clock_wise
          sequence:
          - action: script.living_room_light_rotary
            data:
              step: '{{ (state_attr(''event.living_room_switch_rotary'', ''steps'')|float
                / 3.60)|round(0) }}'
        default:
        - action: script.living_room_light_rotary
          data:
            step: '{{ (state_attr(''event.living_room_switch_rotary'', ''steps'')|float
              / -3.60)|round(0) }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1735658670560'
  alias: Indkørsel billader lås op
  description: Hvis en af bilerne er hjemme og tilsluttet, lås billaderen op
  triggers:
  - trigger: state
    entity_id:
    - sensor.driveway_ev_charger_status_description_safe
    to: Locked, car connected
  - trigger: state
    entity_id:
    - device_tracker.volvo_ex30_location
    to: home
  - trigger: state
    entity_id:
    - device_tracker.volvo_xc40_location
    to: home
  - trigger: state
    entity_id:
    - sensor.volvo_ex30_charging_connection_status
    to:
    - connected
  - trigger: state
    entity_id:
    - sensor.volvo_xc40_charging_connection_status
    to:
    - connected
  conditions:
  - condition: state
    entity_id: sensor.driveway_ev_charger_status_description_safe
    state: Locked, car connected
  actions:
  - if:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: device_tracker.volvo_ex30_location
          state: home
        - condition: state
          entity_id: sensor.volvo_ex30_charging_connection_status
          state: connected
      - condition: and
        conditions:
        - condition: state
          entity_id: device_tracker.volvo_xc40_location
          state: home
        - condition: state
          entity_id: sensor.volvo_xc40_charging_connection_status
          state: connected
    then:
    - action: lock.unlock
      metadata: {}
      data: {}
      target:
        entity_id: lock.driveway_ev_charger_lock
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1735725983183'
  alias: Garage lys
  description: Automatik til at styre lys i garagen
  triggers:
  - trigger: state
    entity_id:
    - event.garage_switch_button_1
    id: button_1
  - trigger: state
    entity_id:
    - event.garage_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.garage_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.garage_switch_button_4
    id: button_4
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - lock.garage_lock
    to: locked
    id: locked
  - trigger: state
    entity_id:
    - lock.garage_lock
    to: unlocked
    id: unlocked
  - trigger: state
    entity_id:
    - binary_sensor.garage_door
    from: 'off'
    to: 'on'
    id: opened
  - trigger: state
    entity_id:
    - binary_sensor.garage_door
    from: 'on'
    to: 'off'
    id: closed
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.garage_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_main
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_spots
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_projector
    - conditions:
      - condition: trigger
        id:
        - opened
        - unlocked
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.garage_light_main
    - conditions:
      - condition: trigger
        id:
        - locked
        - no_one_home
        - sleeping
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.garage_lights
    - conditions:
      - condition: trigger
        id:
        - closed
      - condition: state
        entity_id: lock.garage_lock
        state: locked
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.garage_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1735738251165'
  alias: Stue varmepumpe
  description: Styring af varmepumpe i stuen, for at varme hurtigere op hvis den ønskede
    temperatur er væsentligt koldere end den aktuelle.
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_heat_pump_mode
  - trigger: state
    entity_id:
    - binary_sensor.living_room_window
  - trigger: state
    entity_id:
    - binary_sensor.patio_door_long_open
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_window
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.living_room_heat_pump_mode
        state: boost
      - condition: state
        entity_id: binary_sensor.living_room_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.patio_door_long_open
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_window
        state: 'off'
      sequence:
      - action: climate.turn_on
        target:
          entity_id: climate.living_room_heat_pump
      - action: climate.set_temperature
        target:
          entity_id: climate.living_room_heat_pump
        data:
          temperature: '{{ states(''sensor.living_room_target_temperature'') | float(0)
            + 1 }}'
      - action: climate.set_hvac_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          hvac_mode: heat
      - action: climate.set_fan_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          fan_mode: Auto
      - action: climate.set_swing_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          swing_mode: Auto
      - action: climate.set_preset_mode
        metadata: {}
        data:
          preset_mode: boost
        target:
          entity_id: climate.living_room_heat_pump
    - conditions:
      - condition: state
        entity_id: sensor.living_room_heat_pump_mode
        state: heat
      - condition: state
        entity_id: binary_sensor.living_room_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.patio_door_long_open
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_window
        state: 'off'
      sequence:
      - action: climate.turn_on
        target:
          entity_id: climate.living_room_heat_pump
      - action: climate.set_temperature
        target:
          entity_id: climate.living_room_heat_pump
        data:
          temperature: '{{ states(''sensor.living_room_target_temperature'') | float(0)
            + 1 }}'
      - action: climate.set_hvac_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          hvac_mode: heat
      - action: climate.set_fan_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          fan_mode: Auto
      - action: climate.set_swing_mode
        target:
          entity_id: climate.living_room_heat_pump
        data:
          swing_mode: Auto
      - action: climate.set_preset_mode
        metadata: {}
        data:
          preset_mode: none
        target:
          entity_id: climate.living_room_heat_pump
    - conditions:
      - condition: state
        entity_id: sensor.living_room_heat_pump_mode
        state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.living_room_heat_pump
          state: 'off'
      sequence:
      - action: climate.turn_off
        target:
          entity_id: climate.living_room_heat_pump
      - action: climate.set_preset_mode
        data:
          preset_mode: none
        target:
          entity_id: climate.living_room_heat_pump
  mode: restart
  trace:
    stored_traces: 100
- id: '1735842629315'
  alias: Entre lås
  description: Automatik til at låse hoveddøren op og i baseret på hvem der er hjemme
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.anders_home
    from: 'off'
    to: 'on'
    id: anders_home
  - trigger: state
    entity_id:
    - binary_sensor.monique_home
    from: 'off'
    to: 'on'
    id: monique_home
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_home
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'off'
    to: 'on'
    id: charlie_home
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    - binary_sensor.bedroom_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.entrance_lock_timer
    to: idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.entrance_lock
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - anders_home
      - condition: state
        entity_id: lock.entrance_lock
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_anders'') }}'
        target:
          entity_id: lock.entrance_lock
    - conditions:
      - condition: trigger
        id:
        - monique_home
      - condition: state
        entity_id: lock.entrance_lock
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_monique'') }}'
        target:
          entity_id: lock.entrance_lock
    - conditions:
      - condition: trigger
        id:
        - emil_home
      - condition: state
        entity_id: lock.entrance_lock
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_emil'') }}'
        target:
          entity_id: lock.entrance_lock
    - conditions:
      - condition: trigger
        id:
        - charlie_home
      - condition: state
        entity_id: lock.entrance_lock
        state: locked
      sequence:
      - action: lock.unlock
        metadata: {}
        data:
          code: '{{ states(''sensor.yale_code_charlie'') }}'
        target:
          entity_id: lock.entrance_lock
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.entrance_lock
        state:
        - unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.entrance_lock
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.entrance_lock_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.entrance_lock
        state:
        - unlocked
      - condition: state
        entity_id: binary_sensor.house_sitter_home
        state: 'off'
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          message: Hoveddøren kunne ikke låses automatisk!
          id: entrance_lock_auto_warning
          recipient: home
          persistent: false
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1735847242174'
  alias: Terrasse lys
  description: Automatik til at styre lys på terrassen
  triggers:
  - trigger: state
    entity_id:
    - event.patio_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.patio_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.patio_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.patio_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.patio_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.patio_door
    from: 'off'
    to: 'on'
    id: opened
  - trigger: state
    entity_id:
    - lock.patio_lock
    to: locked
    id: locked
  - trigger: state
    entity_id: binary_sensor.everyone_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.patio_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    id: lights_on
  - trigger: state
    entity_id:
    - input_select.patio_light_scene
    to:
    - Jul
    id: christmas_scene
  - trigger: state
    entity_id:
    - input_select.patio_light_scene
    to:
    - Auto
    id: auto_scene
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 60
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: 10
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: -10
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          brightness_pct: 40
          rgb_color:
          - 253
          - 160
          - 83
        target:
          entity_id:
          - light.patio_light_dining_table
          - light.patio_light_sofa
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          brightness_pct: 40
          rgb_color:
          - 240
          - 106
          - 92
        target:
          entity_id:
          - light.patio_light_main
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          brightness_pct: 40
          rgb_color:
          - 199
          - 83
          - 253
        target:
          entity_id:
          - light.patio_light_bar
    - conditions:
      - condition: trigger
        id:
        - opened
      - condition: state
        entity_id: binary_sensor.patio_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 60
        target:
          entity_id:
          - light.patio_light_main
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - locked
        - sleeping
        - auto_scene
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - lights_on
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.home_outside_current_temperature
          below: 15
        - condition: state
          entity_id: binary_sensor.someone_home
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 0
        target:
          entity_id: light.patio_lights
    - conditions:
      - condition: trigger
        id:
        - christmas_scene
      sequence:
      - action: scene.turn_on
        metadata: {}
        target:
          entity_id: scene.patio_lys_christmas
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1735851968042'
  alias: Gang lys
  description: Automatik til at styre lys i gangen
  triggers:
  - trigger: state
    entity_id:
    - event.hallway_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.hallway_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.hallway_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.hallway_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - event.hallway_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.anders_home
    - binary_sensor.monique_home
    - binary_sensor.emil_home
    - binary_sensor.charlie_home
    - input_boolean.house_sitter
    from: 'off'
    to: 'on'
    id: someone_home
  - trigger: state
    entity_id: binary_sensor.hallway_presence
    to: 'off'
    id: person_cleared
  - trigger: state
    entity_id: binary_sensor.hallway_presence_sensor_occupancy
    to: 'on'
    id: person_detected
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
    to: 'on'
    id: bedroom_sleeping
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
    to: 'off'
    id: bedroom_waking
  - trigger: state
    entity_id: binary_sensor.bedroom_door
    to: 'on'
    id: bedroom_door_opened
  - trigger: state
    entity_id: binary_sensor.bedroom_door
    to: 'off'
    id: bedroom_door_closed
  - trigger: state
    entity_id: binary_sensor.hallway_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  conditions: []
  actions:
  - variables:
      transition: 1
      brightness: '{{ (state_attr(''light.hallway_lights'', ''brightness'') | int(0)
        / 255 * 100) | int(0) }}'
      kelvin: '{{ state_attr(''light.hallway_lights'', ''color_temp_kelvin'') | int(0)
        }}'
      lights:
      - light.hallway_lights
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
        - button_1_long
        - button_2
        - button_3
        - button_4
      sequence: []
    - conditions:
      - condition: trigger
        id:
        - no_one_home
      sequence:
      - variables:
          brightness: 0
    - conditions:
      - condition: trigger
        id:
        - lights_on
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - variables:
          brightness: 0
    - conditions:
      - condition: trigger
        id:
        - someone_home
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - variables:
          transition: 10
          brightness: 25
          kelvin: 2500
          lights:
          - light.hallway_light_bathroom
          - light.hallway_light_toilet
    - conditions:
      - condition: trigger
        id:
        - someone_home
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - variables:
          brightness: 75
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - bedroom_door_opened
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'on'
      sequence:
      - variables:
          brightness: 0
          transition: 0
    - conditions:
      - condition: trigger
        id:
        - bedroom_door_opened
      - condition: state
        entity_id: binary_sensor.hallway_presence
        state: 'on'
      sequence:
      - variables:
          brightness: 75
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - bedroom_door_closed
      - condition: state
        entity_id: binary_sensor.hallway_presence
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - variables:
          transition: 10
          brightness: 25
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - bedroom_door_closed
      - condition: state
        entity_id: binary_sensor.hallway_presence
        state: 'on'
      sequence:
      - variables:
          brightness: 75
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - bedroom_sleeping
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'on'
      sequence:
      - variables:
          brightness: 0
          transition: 10
    - conditions:
      - condition: trigger
        id:
        - bedroom_waking
      - condition: state
        entity_id: binary_sensor.hallway_presence
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      sequence:
      - variables:
          transition: 60
          brightness: 75
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      sequence:
      - variables:
          brightness: 0
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'off'
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'on'
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      sequence:
      - variables:
          transition: 10
          brightness: 25
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      sequence:
      - variables:
          brightness: 75
          kelvin: 2700
    - conditions:
      - condition: trigger
        id:
        - person_cleared
      - condition: state
        entity_id: binary_sensor.hallway_light
        state: 'on'
      sequence:
      - variables:
          brightness: 0
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.turn_on
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 75
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - action: light.turn_on
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.turn_on
        data:
          transition: 0.5
          brightness_step_pct: 10
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.turn_on
        data:
          transition: 0.5
          brightness_step_pct: -10
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.hallway_lights
    - conditions:
      - condition: template
        value_template: '{{ brightness == 0 }}'
      sequence:
      - action: light.turn_off
        data:
          transition: '{{ transition }}'
        target:
          entity_id: '{{ lights }}'
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'off'
      sequence:
      - action: light.turn_on
        target:
          entity_id: '{{ lights }}'
        data:
          transition: '{{ transition }}'
          color_temp_kelvin: '{{ kelvin }}'
          brightness_pct: '{{ brightness }}'
    default:
    - action: light.turn_on
      target:
        entity_id: '{{ lights }}'
      data:
        transition: '{{ transition }}'
        color_temp_kelvin: '{{ kelvin }}'
        brightness_pct: '{% set bedroom = (state_attr(''light.bedroom_lights'', ''brightness'')
          | int(0) / 255 * 100) | int %} {{ min(bedroom, brightness) if 0 < bedroom
          < 75 else brightness }}

          '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1735852365839'
  alias: Emils værelse lys
  description: Automatik til at styre lys på Emils værelse
  triggers:
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_3
    id: button_3
  - trigger: state
    entity_id:
    - event.emils_room_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'on'
    to: 'off'
    id: emil_leaving
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_home
  - trigger: state
    entity_id:
    - binary_sensor.emils_room_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: time
    at: input_datetime.emil_bedtime_alarm
    id: bedtime
  - trigger: time
    at: input_datetime.emil_wake_up_alarm
    id: wake_up
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
        - emil_home
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'off'
      - condition: trigger
        id:
        - button_2
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 60
          color_temp_kelvin: 2300
          brightness: 10
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: 10
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 0.5
          brightness_step_pct: -10
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - emil_leaving
        - lights_on
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 60
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.emils_room_lights
    - conditions:
      - condition: trigger
        id:
        - bedtime
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'on'
      - condition: numeric_state
        entity_id: light.emils_room_lights
        attribute: brightness
        above: 30
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 10
          brightness: 30
        target:
          entity_id:
          - light.emils_room_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736082177257'
  alias: Charlies værelse lys
  description: Automatik til at styre lys på Charlies værelse
  triggers:
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_1
    id: button_1_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_1
    id: button_1_long
    attribute: event_type
    to: long_release
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_2
    id: button_2_short
    attribute: event_type
    to: short_release
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_2
    id: button_2
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_3
    id: button_3
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - event.charlies_room_switch_button_4
    id: button_4
    attribute: event_type
    to: initial_press
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'on'
    to: 'off'
    id: charlie_leaving
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    from: 'off'
    to: 'on'
    id: charlie_home
  - trigger: state
    entity_id:
    - binary_sensor.charlies_room_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: time
    at: input_datetime.charlie_bedtime_alarm
    id: bedtime
  - trigger: time
    at: input_datetime.charlie_wake_up_alarm
    id: wake_up
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - parallel:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.charlies_room_smart_plug_string_lights
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            brightness_pct: 80
          target:
            entity_id:
            - light.charlies_room_light_desk_right
            - light.charlies_room_light_desk_mid
            - light.charlies_room_light_desk_left
    - conditions:
      - condition: trigger
        id:
        - button_1_long
      sequence:
      - parallel:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: light.charlies_room_smart_plug_string_lights
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            brightness_pct: 100
          target:
            entity_id:
            - light.charlies_room_light_desk_right
            - light.charlies_room_light_desk_mid
            - light.charlies_room_light_desk_left
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            color_temp_kelvin: 2700
            brightness_pct: 100
          target:
            entity_id:
            - light.charlies_room_light_dresser
            - light.charlies_room_light_bed_lamp
    - conditions:
      - condition: trigger
        id:
        - button_2_short
      sequence:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          brightness_pct: 80
        target:
          entity_id:
          - light.charlies_room_light_desk_right
          - light.charlies_room_light_desk_mid
          - light.charlies_room_light_desk_left
    - conditions:
      - condition: trigger
        id:
        - button_2
      - condition: state
        entity_id: event.charlies_room_switch_button_2
        attribute: event_type
        state: repeat
      sequence:
      - action: script.charlies_room_light_desk_adjust
        metadata: {}
        data:
          brightness_step: 25
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          entity_id: light.charlies_room_smart_plug_string_lights
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.charlies_room_lights
    - conditions:
      - condition: trigger
        id:
        - charlie_leaving
        - lights_on
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.charlies_room_lights
    - conditions:
      - condition: trigger
        id:
        - charlie_home
        - wake_up
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        target:
          entity_id: light.charlies_room_smart_plug_string_lights
        data: {}
    - conditions:
      - condition: trigger
        id:
        - bedtime
      - condition: state
        entity_id: binary_sensor.charlie_home
        state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 10
        target:
          entity_id:
          - light.charlies_room_light_desk_left
          - light.charlies_room_light_desk_mid
          - light.charlies_room_light_desk_right
          - light.charlies_room_light_dresser
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736083584615'
  alias: Soveværelse lys
  description: Automatik til at styre lys på soveværelset
  triggers:
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_1
    attribute: event_type
    to: initial_press
    id: button_1
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_2
    attribute: event_type
    to: initial_press
    id: button_2
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_3
    attribute: event_type
    to: initial_press
    id: button_3
  - trigger: state
    entity_id:
    - event.bedroom_switch_button_4
    attribute: event_type
    to: initial_press
    id: button_4
  - trigger: state
    entity_id:
    - binary_sensor.parent_home
    to: 'off'
    id: parents_leave
  - trigger: state
    entity_id:
    - input_boolean.house_sitter
    to: 'off'
    id: house_sitter_leave
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence
    from: 'on'
    to: 'off'
    id: cleared
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - sensor.anders_iphone_battery_state
    - sensor.monique_iphone_battery_state
    to: Charging
    id: charging
  - trigger: time
    at: input_datetime.monique_wake_up_alarm
    id: wake_up
  - trigger: state
    entity_id:
    - timer.bedroom_light_sunrise_delay_timer
    from: active
    to: idle
    id: sunrise_script
  - trigger: numeric_state
    entity_id: input_number.bedroom_blind_position
    below: 1
    id: blind_closed
  - trigger: numeric_state
    entity_id: input_number.bedroom_blind_position
    above: 1
    id: blind_opened
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: timer.bedroom_light_sunrise_delay_timer
      state: active
    then:
    - action: timer.cancel
      metadata: {}
      data: {}
      target:
        entity_id: timer.bedroom_light_sunrise_delay_timer
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - button_2
      sequence:
      - action: script.bedroom_light_sunrise
        data: {}
    - conditions:
      - condition: trigger
        id:
        - button_3
      sequence:
      - action: script.bedroom_light_sunset
        data:
          transition: 180
          brightness_from: 200
          brightness_to: 50
    - conditions:
      - condition: trigger
        id:
        - button_4
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - detected
      - condition: numeric_state
        entity_id: input_number.bedroom_blind_position
        above: 1
      - condition: numeric_state
        entity_id: sensor.home_outside_avarage_illuminance_15m
        below: 5000
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - blind_opened
      - condition: state
        entity_id: binary_sensor.bedroom_presence
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.home_outside_avarage_illuminance_15m
        below: 5000
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 30
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id: light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - blind_closed
      - condition: state
        entity_id: binary_sensor.bedroom_light
        state: 'on'
      sequence:
      - action: script.bedroom_light_sunset
        data:
          transition: 180
          brightness_from: 200
          brightness_to: 50
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.bedroom_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      sequence:
      - action: script.bedroom_light_sunrise
        data: {}
    - conditions:
      - condition: trigger
        id:
        - sunrise_script
      sequence:
      - action: script.bedroom_light_sunrise
        data: {}
    - conditions:
      - condition: trigger
        id:
        - parents_leave
        - house_sitter_leave
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - lights_on
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.bedroom_lights
    - conditions:
      - condition: trigger
        id:
        - charging
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'on'
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'on'
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.anders_home
          state: 'off'
        - condition: state
          entity_id: sensor.anders_iphone_battery_state
          state: Charging
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.monique_home
          state: 'off'
        - condition: state
          entity_id: sensor.monique_iphone_battery_state
          state: Charging
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 10
        target:
          entity_id:
          - light.bedroom_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1736103151599'
  alias: Emils værelse rullegardin stop
  description: Automatik for at stoppe rullegardin på Emils værelse
  triggers:
  - trigger: device
    device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_long_release
    subtype: open
    id: open_long_pressed
  - trigger: device
    device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_long_release
    subtype: close
    id: close_long_pressed
  conditions: []
  actions:
  - target:
      entity_id: automation.emils_room_blind
    action: automation.turn_off
  - action: cover.stop_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.emils_room_blind
  - delay:
      seconds: 1
  - action: input_number.set_value
    target:
      entity_id: input_number.emils_room_blind_position
    data:
      value: '{{ state_attr(''cover.emils_room_blind'', ''current_position'') }}'
  - target:
      entity_id: automation.emils_room_blind
    action: automation.turn_on
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736106304486'
  alias: Charlies værelse rullegardin stop
  description: Automatik for at stoppe rullegardin på Charlies værelse
  triggers:
  - trigger: device
    device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_long_release
    subtype: open
    id: open_long_pressed
  - trigger: device
    device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_long_release
    subtype: close
    id: close_long_pressed
  conditions: []
  actions:
  - target:
      entity_id: automation.charlies_room_blind
    action: automation.turn_off
  - action: cover.stop_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.charlies_room_blind
  - delay:
      seconds: 1
  - action: input_number.set_value
    target:
      entity_id: input_number.charlies_room_blind_position
    data:
      value: '{{ state_attr(''cover.charlies_room_blind'', ''current_position'') }}'
  - target:
      entity_id: automation.charlies_room_blind
    action: automation.turn_on
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1736106591926'
  alias: Soveværelse rullegardin stop
  description: Automatik for at stoppe rullegardin på soveværelse
  triggers:
  - trigger: device
    device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_long_release
    subtype: open
    id: open_long_pressed
  - trigger: device
    device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_long_release
    subtype: close
    id: close_long_pressed
  conditions: []
  actions:
  - target:
      entity_id: automation.bedroom_blind
    action: automation.turn_off
  - action: cover.stop_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.bedroom_blind
  - delay:
      seconds: 1
  - action: input_number.set_value
    target:
      entity_id: input_number.bedroom_blind_position
    data:
      value: '{{ state_attr(''cover.bedroom_blind'', ''current_position'') }}'
  - target:
      entity_id: automation.bedroom_blind
    action: automation.turn_on
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1737201831964'
  alias: Indkørsel billader sæt pris
  description: Sæt elektricitets prisen på billader
  triggers:
  - trigger: state
    entity_id:
    - sensor.energy_price
  - value_template: '{% set last = state_attr(''automation.driveway_ev_charger_set_price'',
      ''last_triggered'') %} {{ last is none or ( now() - last ).total_seconds() >
      3600 }}

      '
    trigger: template
  conditions: []
  actions:
  - action: number.set_value
    metadata: {}
    data:
      value: '{{ states(''sensor.energy_price'') }}'
    target:
      entity_id: number.driveway_ev_charger_energy_price
  mode: single
  trace:
    stored_traces: 10
- id: '1737240652738'
  alias: Teknik solcelle batteri sæt operating mode
  description: Sæt operation mode på solcelle batteri for at lade om natten hvis billigere
  triggers:
  - trigger: time
    at: 00:01:00
  conditions: []
  actions:
  - variables:
      charge_start: '{{ now().replace(hour=0, minute=0, second=0) }}'
      charge_end: '{{ now().replace(hour=6, minute=0, second=0) }}'
      charge_periods: "{% set g = namespace(count = 0) %}\n{% set start = as_timestamp(charge_start)
        %}\n{% set end = as_timestamp(charge_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for entry in prices %}\n  {% set ts = as_timestamp(entry.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.count = g.count + 1
        %}\n  {% endif %}\n{% endfor %}\n{{ g.count }}      \n"
      use_start: '{{ now().replace(hour=17, minute=0, second=0) }}'
      use_end: '{{ now().replace(hour=21, minute=0, second=0) }}'
      use_periods: "{% set g = namespace(count = 0) %}\n{% set start = as_timestamp(use_start)
        %}\n{% set end = as_timestamp(use_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for entry in prices %}\n  {% set ts = as_timestamp(entry.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.count = g.count + 1
        %}\n  {% endif %}\n{% endfor %}\n{{ g.count }}      \n"
      capacity: "{% set fixed_use = 700 %}\n{% set g = namespace(capacity = 0) %}\n{%
        set start = as_timestamp(charge_end) %}\n{% set end = as_timestamp(use_start)
        %} \n{% set forecast = state_attr('sensor.solar_forecast_energy_today',\n'detailedHourly')
        %}\n{% set g.capacity =\nstates('sensor.technic_room_solar_battery_installed_capacity_total')|float(0)\n%}\n{%
        set g.capacity = g.capacity * (1 - states('sensor.technic_room_solar_battery_battery_percentage_user')|float(0)
        / 100) %}\n{% for p in forecast %}\n  {% set ts = as_timestamp(p.period_start)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.capacity = max(0, g.capacity
        - max(0, p.pv_estimate * 1000 - fixed_use)) %}\n  {% endif %}\n{% endfor %}\n\n{{
        g.capacity|round(0) }}\n"
      schedule: "{{\n  \"[{\\\"start\\\": \\\"\" ~ (as_datetime(charge_start) + timedelta(minutes=1)).strftime('%H:%M')
        ~\n  \"\\\", \\\"stop\\\": \\\"\" ~ as_datetime(charge_end).strftime('%H:%M')
        ~\n  \"\\\", \\\"threshold_p_max\\\": \" ~ capacity ~\n  \"}, {\\\"start\\\":
        \\\"\" ~ (as_datetime(charge_end) + timedelta(minutes=1)).strftime('%H:%M')
        ~\n  \"\\\", \\\"stop\\\": \\\"\" ~ as_datetime(use_start).strftime('%H:%M')
        ~\n  \"\\\", \\\"threshold_p_max\\\": 0}]\"\n}}\n"
      charge_cost: "{% set g = namespace(charge_cost=0) %}\n{% set start = as_timestamp(charge_start)
        %}\n{% set end = as_timestamp(charge_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for p in prices %}\n  {% set ts = as_timestamp(p.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.charge_cost = g.charge_cost
        + p.price * (capacity / 1000 / charge_periods) %}\n  {% endif %}\n{% endfor
        %}\n{{ g.charge_cost | round(2) }}\n"
      use_cost: "{% set g = namespace(use_cost=0) %}\n{% set start = as_timestamp(use_start)
        %}\n{% set end = as_timestamp(use_end) %}\n{% set prices = state_attr('sensor.energy_data_service',
        'raw_today') %}\n{% for p in prices %}\n  {% set ts = as_timestamp(p.hour)
        %}\n  {% if ts >= start and ts <= end %}\n    {% set g.use_cost = g.use_cost
        + p.price * (capacity / 1000 / use_periods) %}\n  {% endif %}\n{% endfor %}\n{{
        g.use_cost | round(2) }}\n"
  - action: system_log.write
    data:
      level: info
      message: 'Charge Start: {{ charge_start }}

        Charge End: {{ charge_end }}

        Charge Periods: {{ charge_periods }}

        Use Start: {{ use_start }}

        Use End: {{ use_end }}

        Use Periods: {{ use_periods }}

        Capacity: {{ capacity }}

        Schedule: {{ schedule }}

        Charge cost: {{ charge_cost }}

        Use cost: {{ use_cost }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ capacity | int > 0 and (use_cost | float - charge_cost
          | float) > 5 }}

          '
      sequence:
      - action: sonnenbatterie.set_operating_mode
        data:
          device_id: 11f8db43595fb97c43173da2b7b5b2b7
          mode: timeofuse
        response_variable: conversation_response
      - action: sonnenbatterie.set_tou_schedule
        data:
          device_id: 11f8db43595fb97c43173da2b7b5b2b7
          schedule: '{{ schedule }}'
        response_variable: conversation_response
    default:
    - action: sonnenbatterie.set_operating_mode
      data:
        device_id: 11f8db43595fb97c43173da2b7b5b2b7
        mode: automatic
      response_variable: conversation_response
  - action: system_log.write
    metadata: {}
    data:
      level: debug
      message: '{{ conversation_response }}'
  mode: single
  trace:
    stored_traces: 30
- id: '1737299093662'
  alias: Emils værelse varme
  description: Automatik til at styre varmen på Emils værelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.emils_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.emils_room_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.emils_room_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.emils_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.emils_room_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.emils_room_target_temperature'') | float(0.0)
          != states(''sensor.emils_room_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.emils_room_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.emils_room_target_temperature'') | float(0.0)
          == states(''sensor.emils_room_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.emils_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.emils_room_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.emils_room_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.emils_room_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.emils_room_radiator_thermostat
        target_sensor: sensor.emils_room_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737309773463'
  alias: Charlies værelse varme
  description: Automatik til at styre varmen på Charlies værelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.charlies_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.charlies_room_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.charlies_room_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.charlies_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.charlies_room_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.charlies_room_target_temperature'') |
          float(0.0) != states(''sensor.charlies_room_desired_temperature'') | float(21.0)
          }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.charlies_room_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.charlies_room_target_temperature'') |
          float(0.0) == states(''sensor.charlies_room_desired_temperature'') | float(21.0)
          }}'
      - condition: state
        entity_id: timer.charlies_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.charlies_room_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.charlies_room_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.charlies_room_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.charlies_room_radiator_thermostat
        - climate.charlies_room_temperature_sensor
        target_sensor: sensor.charlies_room_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737310160740'
  alias: Soveværelse varme
  description: Automatik til at styre varmen i soveværelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.bedroom_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.bedroom_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.bedroom_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.bedroom_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.bedroom_target_temperature'') | float(0.0)
          != states(''sensor.bedroom_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 01:00:00
        target:
          entity_id: timer.bedroom_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.bedroom_target_temperature'') | float(0.0)
          == states(''sensor.bedroom_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.bedroom_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.bedroom_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.bedroom_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.bedroom_radiator_thermostat
        target_sensor: sensor.bedroom_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737310628140'
  alias: Toilet varme
  description: Automatik til at styre varmen på toilettet
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.toilet_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.toilet_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.toilet_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.toilet_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.toilet_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.toilet_target_temperature'') | float(0.0)
          != states(''sensor.toilet_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:15:00
        target:
          entity_id: timer.toilet_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.toilet_target_temperature'') | float(0.0)
          == states(''sensor.toilet_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.toilet_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.toilet_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.toilet_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.toilet_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.toilet_radiator_thermostat
        target_sensor: sensor.toilet_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737311363654'
  alias: Badeværelse varme
  description: Automatik til at styre varmen på badeværelset
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.bathroom_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.bathroom_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.bathroom_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.bathroom_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bathroom_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.bathroom_target_temperature'') | float(0.0)
          != states(''sensor.bathroom_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:15:00
        target:
          entity_id: timer.bathroom_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.bathroom_target_temperature'') | float(0.0)
          == states(''sensor.bathroom_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.bathroom_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bathroom_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.bathroom_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.bathroom_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.bathroom_radiator_thermostat_floor
        - climate.bathroom_radiator_thermostat_wall
        target_sensor: sensor.bathroom_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737311656075'
  alias: Bryggers varme
  description: Automatik til at styre varmen på bryggers
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.utility_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.utility_room_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.utility_room_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.utility_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.utility_room_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.utility_room_target_temperature'') | float(0.0)
          != states(''sensor.utility_room_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:30:00
        target:
          entity_id: timer.utility_room_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.utility_room_target_temperature'') | float(0.0)
          == states(''sensor.utility_room_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.utility_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.utility_room_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.utility_room_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.utility_room_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.utility_room_radiator_thermostat_wall
        - climate.utility_room_radiator_thermostat_floor
        - climate.utility_room_temperature_sensor
        target_sensor: sensor.utility_room_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737312016227'
  alias: Stue varme
  description: Automatik til at styre varmen i stuen
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.living_room_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.living_room_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.living_room_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.living_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.living_room_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.living_room_target_temperature'') | float(0.0)
          != states(''sensor.living_room_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 02:00:00
        target:
          entity_id: timer.living_room_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_target_temperature'') | float(0.0)
          == states(''sensor.living_room_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.living_room_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.living_room_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.living_room_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.living_room_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.living_room_radiator_thermostat_bookcase
        - climate.living_room_radiator_thermostat_dining_table
        - climate.living_room_radiator_thermostat_sofa
        - climate.kitchen_radiator_thermostat
        target_sensor: sensor.living_room_target_temperature
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1737313921011'
  alias: Gang varme
  description: Automatik til at styre varmen i gangen
  triggers:
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: sensor.hallway_target_temperature
    id: target_changed
  - trigger: state
    entity_id: timer.hallway_heating_manual_timer
    to: idle
  - trigger: state
    entity_id: sensor.hallway_desired_temperature
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: state
        entity_id: timer.hallway_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.hallway_heating_manual_timer
    - conditions:
      - condition: trigger
        id: target_changed
      - condition: template
        value_template: '{{ states(''sensor.hallway_target_temperature'') | float(0.0)
          != states(''sensor.hallway_desired_temperature'') | float(21.0) }}'
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:30:00
        target:
          entity_id: timer.hallway_heating_manual_timer
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.hallway_target_temperature'') | float(0.0)
          == states(''sensor.hallway_desired_temperature'') | float(21.0) }}'
      - condition: state
        entity_id: timer.hallway_heating_manual_timer
        state: active
      sequence:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.hallway_heating_manual_timer
  - if:
    - condition: state
      entity_id: timer.hallway_heating_manual_timer
      state: idle
    then:
    - action: script.set_climate_temperature
      data:
        temperature: '{{ states(''sensor.hallway_desired_temperature'') | float(21.0)
          }}'
        entities:
        - climate.hallway_radiator_thermostat
        target_sensor: sensor.hallway_target_temperature
  mode: restart
  trace:
    stored_traces: 50
- id: '1737757884659'
  alias: Hjem varme motioner radiatorventiler
  description: 'Automatik til at motionere radiator ventiler når varmepumpe er slukket.

    '
  triggers:
  - trigger: time
    at: 01:00:00
  conditions: []
  actions:
  - if:
    - condition: time
      weekday:
      - mon
    - condition: state
      entity_id: binary_sensor.home_central_heating
      state: 'off'
    then:
    - action: script.exercising_radiator_valves
  mode: single
- id: '1737796089950'
  alias: Solcast PV Forecast opdater
  description: Opdater sol produktion udsigten i Solcast PV Forecast
  triggers:
  - trigger: time
    at: 00:00:00
  - trigger: sun
    event: sunrise
    offset: 0
  conditions: []
  actions:
  - action: solcast_solar.update_forecasts
    metadata: {}
    data: {}
  mode: single
  trace:
    stored_traces: 10
- id: '1737835831554'
  alias: Hjem sæt huspasser
  description: Slår huspasser fra når familien kommer hjem, og til hvis andre låser
    op med keypad
  triggers:
  - entity_id: binary_sensor.family_home
    from: 'off'
    to: 'on'
    id: family_home
    trigger: state
  - entity_id:
    - sensor.entrance_lock_operator
    - sensor.utility_room_lock_operator
    id: unlock
    trigger: state
  actions:
  - data:
      name: Huspasser
      message: 'Huspasser slået til via {{ trigger.entity_id }}

        Operator {{ states(trigger.entity_id) }}

        '
      entity_id: input_boolean.house_sitter
    action: logbook.log
  - choose:
    - conditions:
      - condition: trigger
        id: family_home
      - condition: template
        value_template: '{{ now() > (states.input_boolean.house_sitter.last_updated
          + timedelta(minutes=15)) }}'
      sequence:
      - target:
          entity_id: input_boolean.house_sitter
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: unlock
      - condition: state
        entity_id: binary_sensor.family_home
        state: 'off'
      - condition: template
        value_template: '{{ state_attr(trigger.entity_id, ''method'') == ''keypad''
          }}

          '
      - condition: template
        value_template: '{{ ''Busted-Janum'' not in states(trigger.entity_id) }}

          '
      sequence:
      - target:
          entity_id: input_boolean.house_sitter
        action: input_boolean.turn_on
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1737916297775'
  alias: Indkørsel lys
  description: Automatik til at styre lys i indkørsel
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_street_presence
    from: 'off'
    to: 'on'
    id: detected_street
  - trigger: state
    entity_id:
    - binary_sensor.driveway_street_presence
    from: 'on'
    to: 'off'
    id: cleared_street
  - trigger: state
    entity_id:
    - binary_sensor.driveway_house_south_presence
    from: 'off'
    to: 'on'
    id: detected_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_house_south_presence
    from: 'on'
    to: 'off'
    id: cleared_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'on'
    to: 'off'
    id: cleared_entrance
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_east_presence
    from: 'off'
    to: 'on'
    id: detected_east
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_east_presence
    from: 'on'
    to: 'off'
    id: cleared_east
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'on'
    to: 'off'
    id: twilight
  - trigger: time
    at: '22:00:00'
    id: night
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_south
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_right_1
          - light.driveway_light_right_2
          - light.driveway_light_right_3
          - light.driveway_light_left_1
          - light.driveway_light_left_2
          - light.driveway_light_left_3
          - light.driveway_light_left_4
          - light.driveway_light_left_5
          - light.driveway_light_left_6
          - light.driveway_light_left_7
          - light.driveway_light_left_8
          - light.driveway_light_left_9
          sequence:
          - action: light.turn_on
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
            data:
              brightness_pct: 100
              color_temp_kelvin: 3000
              transition: 1
          - delay: '00:00:00.1'
    - conditions:
      - condition: trigger
        id:
        - detected_street
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_right_3
          - light.driveway_light_right_2
          - light.driveway_light_right_1
          - light.driveway_light_left_9
          - light.driveway_light_left_8
          - light.driveway_light_left_7
          - light.driveway_light_left_6
          - light.driveway_light_left_5
          - light.driveway_light_left_4
          - light.driveway_light_left_3
          - light.driveway_light_left_2
          - light.driveway_light_left_1
          sequence:
          - action: light.turn_on
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
            data:
              brightness_pct: 100
              color_temp_kelvin: 3000
              transition: 1
          - delay: '00:00:00.1'
    - conditions:
      - condition: trigger
        id:
        - detected_entrance
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_right_2
          - light.driveway_light_right_3
          - light.driveway_light_left_2
          - light.driveway_light_left_3
          - light.driveway_light_left_4
          - light.driveway_light_left_5
          - light.driveway_light_left_6
          - light.driveway_light_left_7
          - light.driveway_light_left_8
          - light.driveway_light_left_9
          sequence:
          - action: light.turn_on
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
            data:
              brightness_pct: 100
              color_temp_kelvin: 3000
              transition: 1
          - delay: '00:00:00.1'
    - conditions:
      - condition: trigger
        id:
        - detected_east
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          transition: 1
          color_temp_kelvin: 3000
        target:
          entity_id:
          - light.driveway_light_left_1
    - conditions:
      - condition: trigger
        id:
        - cleared_street
        - cleared_south
        - cleared_entrance
        - cleared_east
        - twilight
      - condition: state
        entity_id: binary_sensor.driveway_street_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.driveway_house_south_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.driveway_entrance_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.garden_house_east_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      - condition: template
        value_template: '{% set wd = now().weekday() %} {% set h = now().hour %} {%
          set d = now().day %} {% set m = now().month %} {{ (wd in [4,5] and h < 23)
          or (m == 12 and d == 31 and h < 24) or (h < 22) }}'
      - condition: time
        after: '12:00:00'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ now().month == 12 and now().day >= 1 and now().day
              <= 26 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_christmas
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ (now().month == 12 and now().day >= 30) or (now().month
              == 1 and now().day == 1) }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_new_years
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ now().month == 10 and now().day >= 15 and now().day
              <= 31 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_halloween
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ now().month == 3 and now().day == 17 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_sankt_patrick
            data:
              transition: 1
        - conditions:
          - condition: template
            value_template: '{{ now().month == 2 and now().day == 14 }}'
          sequence:
          - action: scene.turn_on
            target:
              entity_id: scene.driveway_light_valentines
            data:
              transition: 1
        default:
        - action: scene.turn_on
          target:
            entity_id: scene.driveway_light_twlight
          data:
            transition: 1
    - conditions:
      - condition: trigger
        id:
        - cleared_street
        - cleared_south
        - cleared_entrance
        - cleared_east
        - night
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.home_outside_light
          state: 'on'
        - condition: and
          conditions:
          - condition: state
            entity_id: binary_sensor.driveway_street_presence
            state: 'off'
          - condition: state
            entity_id: binary_sensor.driveway_house_south_presence
            state: 'off'
          - condition: state
            entity_id: binary_sensor.driveway_entrance_presence
            state: 'off'
          - condition: state
            entity_id: binary_sensor.garden_house_east_presence
            state: 'off'
      sequence:
      - repeat:
          for_each:
          - light.driveway_light_left_1
          - light.driveway_light_left_2
          - light.driveway_light_left_3
          - light.driveway_light_left_4
          - light.driveway_light_left_5
          - light.driveway_light_left_6
          - light.driveway_light_left_7
          - light.driveway_light_left_8
          - light.driveway_light_left_9
          - light.driveway_light_right_1
          - light.driveway_light_right_2
          - light.driveway_light_right_3
          sequence:
          - action: light.turn_off
            continue_on_error: true
            target:
              entity_id: '{{ repeat.item }}'
          - delay: '00:00:00.1'
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1738962148356'
  alias: Garage 3D Printer
  description: Automatik til at slukke for 3D printer
  triggers:
  - trigger: state
    entity_id:
    - sensor.garage_3d_printer
    from:
    - busy
    - printing
    to:
    - finished
    - idle
    - ready
    id: finished
  - trigger: state
    entity_id:
    - sensor.garage_3d_printer
    to:
    - busy
    - printing
    id: started
  - trigger: state
    entity_id:
    - sensor.garage_3d_printer
    to:
    - stopped
    - error
    - attention
    - pause
    id: failed
  - trigger: state
    entity_id: timer.garage_3d_printer_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: light.garage_3d_printer_power
    from: 'on'
    to: 'off'
    id: 'off'
  - trigger: state
    entity_id: light.garage_3d_printer_power
    from: 'off'
    to: 'on'
    id: 'on'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: finished
      sequence:
      - action: timer.start
        metadata: {}
        target:
          entity_id: timer.garage_3d_printer_timer
        data:
          duration: 00:10:00
      - action: script.create_todo_task
        data:
          subject: Hent 3D printer
          entity_id: todo.todo_smart_todo
          description: 3D-printeren i garagen er færdig, hent printet og gør printeren
            ren.
          related_entity_id: sensor.garage_3d_printer
      - action: script.push_notification
        data:
          type: info
          recipient: emil
          persistent: false
          id: 3d_printer_finished
          title: 3D-print er færdig
          message: 3D-printeren i garagen er færdig, hent printet og gør printeren
            ren.
    - conditions:
      - condition: trigger
        id: started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garage_3d_printer_timer
    - conditions:
      - condition: trigger
        id: failed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garage_3d_printer_timer
      - action: script.create_todo_task
        data:
          subject: Kontroller 3D printer
          entity_id: todo.todo_smart_todo
          description: 3D-printeren i garagen er stoppet med status [{{ states('sensor.garage_3d_printer')
            }}], kontroller og genstart.
          related_entity_id: sensor.garage_3d_printer
      - action: script.push_notification
        data:
          type: warning
          recipient: emil
          persistent: false
          id: 3d_printer_failed
          title: 3D-print er fejlet
          message: 3D-printeren i garagen er stoppet med status [{{states('sensor.garage_3d_printer')
            }}]
    - conditions:
      - condition: trigger
        id: timeout
      - condition: state
        entity_id: sensor.garage_3d_printer
        state:
        - idle
        - finished
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.garage_3d_printer_power
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - action: homeassistant.disable_device
        data:
          device_id:
          - 5120a1d4206d34361feb88c4094a20de
      - delay:
          seconds: 3
      - action: homeassistant.disable_config_entry
        data:
          config_entry_id: 01JGCEWM58T7N5MY3Z1HSEDK4E
      - delay:
          seconds: 3
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - action: homeassistant.enable_config_entry
        data:
          config_entry_id: 01JGCEWM58T7N5MY3Z1HSEDK4E
      - delay:
          seconds: 3
      - action: homeassistant.enable_device
        data:
          device_id:
          - 5120a1d4206d34361feb88c4094a20de
      - delay:
          seconds: 3
      - action: homeassistant.reload_config_entry
        data:
          entry_id: 01JGCEWM58T7N5MY3Z1HSEDK4E
      - delay:
          seconds: 3
      - action: timer.start
        metadata: {}
        target:
          entity_id: timer.garage_3d_printer_timer
        data:
          duration: 01:00:00
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1739016002574'
  alias: Emils værelse blæser
  description: Tænder for Dyson Hot+Cool i Emils værelse, for at varme hurtigere op
    hvis den ønskede temperatur er væsentligt koldere end den aktuelle.
  triggers:
  - trigger: state
    entity_id: sensor.emils_room_air_purifier_mode
  - trigger: state
    entity_id: binary_sensor.emil_home
  - trigger: numeric_state
    entity_id: sensor.emils_room_air_quality_score
    above: 50
  - trigger: numeric_state
    entity_id: sensor.emils_room_air_quality_score
    below: 50
  - trigger: state
    entity_id: binary_sensor.emils_room_light
  - trigger: state
    entity_id: binary_sensor.emils_room_window
    to: 'on'
    id: window_opened
  - trigger: state
    entity_id: binary_sensor.emils_room_window
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id: timer.emils_room_air_purifier_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - variables:
      mode: 'off'
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      sequence: []
    - conditions:
      - condition: trigger
        id: timeout
      sequence: []
    - conditions:
      - condition: trigger
        id: window_opened
      sequence:
      - variables:
          mode: fan
      - action: timer.start
        metadata: {}
        data:
          duration: 00:10:00
        target:
          entity_id: timer.emils_room_air_purifier_timer
    - conditions:
      - condition: trigger
        id: window_closed
      - condition: state
        entity_id: timer.emils_room_air_purifier_timer
        state: active
      sequence:
      - variables:
          mode: 'off'
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.emils_room_air_purifier_timer
    - conditions:
      - condition: state
        entity_id: sensor.emils_room_air_purifier_mode
        state: heat
      - condition: state
        entity_id: binary_sensor.emils_room_window
        state: 'off'
      sequence:
      - variables:
          mode: heat
    - conditions:
      - condition: state
        entity_id: sensor.emils_room_air_purifier_mode
        state: cool
      sequence:
      - variables:
          mode: cool
    - conditions:
      - condition: numeric_state
        entity_id: sensor.emils_room_air_quality_score
        below: 50
      - condition: state
        entity_id: binary_sensor.emils_room_window
        state: 'off'
      sequence:
      - variables:
          mode: filter
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      sequence: []
    - conditions:
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'on'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.emils_room_air_purifier_night_mode
    default:
    - action: switch.turn_on
      target:
        entity_id: switch.emils_room_air_purifier_night_mode
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.emils_room_air_purifier
          state: 'off'
      sequence:
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
    - conditions:
      - condition: template
        value_template: '{{ mode == ''heat'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ min(states(''sensor.emils_room_target_temperature'') |
            float(0.0) + 3, 37) }}'
          hvac_mode: heat
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
    - conditions:
      - condition: template
        value_template: '{{ mode == ''cool'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ max(1, states(''sensor.emils_room_target_temperature'')
            | float(0.0) - 3) }}'
          hvac_mode: cool
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
    - conditions:
      - condition: template
        value_template: '{{ mode == ''fan'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ states(''sensor.emils_room_current_temperature'')|float(21)
            }}'
          hvac_mode: cool
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_percentage
        metadata: {}
        data:
          percentage: 100
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Normal
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
    - conditions:
      - condition: template
        value_template: '{{ mode == ''filter'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.emils_room_air_purifier
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: cool
        target:
          entity_id: climate.emils_room_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.emils_room_air_purifier_fan
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.emils_room_air_purifier_focus_mode
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1739480121158'
  alias: Push configuration filer til GitHub
  description: Automatik til at sende configuration filer etc til GitHub repository
  triggers:
  - trigger: time
    at: '23:00:00'
  - trigger: event
    event_type: event_homeassistant_restarted
  - trigger: event
    event_type: homeassistant_close
  - trigger: event
    event_type: homeassistant_stop
  conditions: []
  actions:
  - action: shell_command.pushupdates_to_github
    data: {}
  mode: single
  trace:
    stored_traces: 20
- id: '1739615474729'
  alias: Stue medieafspiller sæt status
  description: Automatik til at sætte status helper for medie i stuen
  triggers:
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to:
    - playing
    - buffering
    id: started
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to:
    - idle
    - paused
    id: ended
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to: 'off'
    id: 'off'
    for:
      seconds: 3
  - trigger: state
    entity_id: timer.living_room_media_player_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: binary_sensor.someone_home
    to: 'off'
    id: away
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.living_room_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.living_room_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - timeout
      - condition: state
        entity_id: sensor.living_room_apple_tv_media_player_safe
        state:
        - idle
        - paused
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - away
        - 'off'
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.living_room_media_player_timer
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.living_room_media_player
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1739647490572'
  alias: Soveværelse blæser
  description: Tænder for Dyson Hot+Cool i soveværelset, for at varme hurtigere op
    hvis den ønskede temperatur er væsentligt koldere end den aktuelle.
  triggers:
  - trigger: state
    entity_id: sensor.bedroom_air_purifier_mode
  - trigger: state
    entity_id: binary_sensor.parent_home
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
  - trigger: state
    entity_id: input_boolean.house_sitter
  - trigger: numeric_state
    entity_id: sensor.bedroom_air_quality_score
    above: 50
  - trigger: numeric_state
    entity_id: sensor.bedroom_air_quality_score
    below: 50
  - trigger: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
    id: window_opened
  - trigger: state
    entity_id: binary_sensor.bedroom_window
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id: timer.bedroom_air_purifier_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - variables:
      mode: 'off'
      silent_period: '{% set w = as_local(states(''input_datetime.monique_wake_up_alarm'')
        | as_datetime) %} {% set s = w - timedelta(hours=1) %} {% set n = now() %}
        {{ s < n < w }}

        '
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: input_boolean.house_sitter
        state: 'off'
      sequence: []
    - conditions:
      - condition: trigger
        id: window_opened
      sequence:
      - variables:
          mode: fan
      - action: timer.start
        metadata: {}
        data:
          duration: 00:10:00
        target:
          entity_id: timer.bedroom_air_purifier_timer
    - conditions:
      - condition: trigger
        id: window_closed
      - condition: state
        entity_id: timer.bedroom_air_purifier_timer
        state: active
      sequence:
      - variables:
          mode: 'off'
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.bedroom_air_purifier_timer
    - conditions:
      - condition: state
        entity_id: sensor.bedroom_air_purifier_mode
        state: heat
      - condition: state
        entity_id: binary_sensor.bedroom_window_sensor_door
        state: 'off'
      - condition: template
        value_template: '{{ not silent_period }}'
      sequence:
      - variables:
          mode: heat
    - conditions:
      - condition: state
        entity_id: sensor.bedroom_air_purifier_mode
        state: cool
      - condition: template
        value_template: '{{ not silent_period }}'
      sequence:
      - variables:
          mode: cool
    - conditions:
      - condition: numeric_state
        entity_id: sensor.bedroom_air_quality_score
        below: 50
      - condition: state
        entity_id: binary_sensor.bedroom_window_sensor_door
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: numeric_state
        entity_id: input_number.bedroom_blind_position
        above: 1
      sequence:
      - variables:
          mode: filter
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      sequence: []
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.bedroom_air_purifier_night_mode
    default:
    - action: switch.turn_on
      target:
        entity_id: switch.bedroom_air_purifier_night_mode
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mode == ''off'' }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.bedroom_air_purifier
          state:
          - 'off'
      sequence:
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 225
          angle_high: 225
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
    - conditions:
      - condition: template
        value_template: '{{ mode == ''heat'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ min(states(''sensor.bedroom_target_temperature'') | float(0.0)
            + 3, 37) }}'
          hvac_mode: heat
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
    - conditions:
      - condition: template
        value_template: '{{ mode == ''cool'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ max(1, states(''sensor.bedroom_target_temperature'') |
            float(0.0) - 3) }}'
          hvac_mode: cool
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
    - conditions:
      - condition: template
        value_template: '{{ mode == ''fan'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{ states(''sensor.bedroom_current_temperature'')|float(21)
            }}'
          hvac_mode: cool
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_percentage
        metadata: {}
        data:
          percentage: 100
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Normal
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: forward
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
    - conditions:
      - condition: template
        value_template: '{{ mode == ''filter'' }}'
      sequence:
      - action: climate.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: climate.bedroom_air_purifier
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: cool
        target:
          entity_id: climate.bedroom_air_purifier
      - action: fan.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_preset_mode
        metadata: {}
        data:
          preset_mode: Auto
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.set_direction
        metadata: {}
        data:
          direction: reverse
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: fan.oscillate
        metadata: {}
        data:
          oscillating: 'true'
        target:
          entity_id: fan.bedroom_air_purifier_fan
      - action: dyson_local.set_angle
        data:
          entity_id: fan.bedroom_air_purifier_fan
          angle_low: 155
          angle_high: 225
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1739712804347'
  alias: Indkørsel todo postkasse
  description: Opret todo opgaver vedrørende postkasse
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_mailbox_vibration_sensor
    to: 'on'
    id: new_post
  - trigger: state
    entity_id:
    - binary_sensor.driveway_mailbox_vibration_sensor
    to: unavailable
    for:
      seconds: 180
    id: sensor_unavailable
  conditions: []
  actions:
  - choose:
    - conditions:
        condition: trigger
        id: new_post
      sequence:
      - action: script.create_todo_task
        data:
          subject: Tøm postkasse
          description: Der er nye breve i postkassen ved vejen
          related_entity_id: binary_sensor.driveway_mailbox_vibration_sensor
          entity_id: todo.todo_smart_todo
    - conditions:
        condition: trigger
        id: sensor_unavailable
      sequence:
      - action: script.create_todo_task
        data:
          subject: Der kan være noget i postkassen
          description: Sensoren på postkasssen har været utilgængelig i længere tid
            og der kan derfor være post i postkassen ved vejen
          related_entity_id: binary_sensor.driveway_mailbox_vibration_sensor
          entity_id: todo.todo_smart_todo
  mode: restart
  trace:
    stored_traces: 30
- id: '1739714838791'
  alias: Todo smart todo oprydning
  description: Automatik der sletter afsluttede opgaver fra smart todo listen
  triggers:
  - trigger: time
    at: 03:05:00
  conditions: []
  actions:
  - action: script.cleanup_todo_tasks
    data:
      entity_id: todo.todo_smart_todo
      date: '{{ (now() - timedelta(days=2)).date() }}'
    response_variable: response
  - action: system_log.write
    data:
      level: info
      message: 'Deleted: {{ response.deleted }} '
  mode: restart
  trace:
    stored_traces: 30
- id: '1739742119703'
  alias: Hjem smart todo Tabo
  description: Kontroller batteri status på Tado enheder
  triggers:
  - trigger: time
    at: 03:20:00
  conditions: []
  actions:
  - action: rest_command.tado_get_auth_token
    data:
      secrets:
        tado_username: '{{ states(''sensor.tado_username'') }}'
        tado_password: '{{ states(''sensor.tado_password'') }}'
        tado_client_secret: '{{ states(''sensor.tado_client_secret'') }}'
    response_variable: response
  - variables:
      token: '{{ response.content.access_token }}'
  - action: rest_command.tado_get_profile
    data:
      bearer_token: '{{ token }}'
    response_variable: response
  - variables:
      home_id: '{{ response.content.homes[0].id }}'
  - action: rest_command.tado_get_rooms_and_devices
    data:
      home_id: '{{ home_id }}'
      bearer_token: '{{ token }}'
    response_variable: response
  - variables:
      devices: "[\n  {% for room in response.content.rooms %}\n    {% for device in
        room.devices %}\n      {\n        \"roomName\": \"{{ room.roomName }}\",\n
        \       \"deviceSerialNo\": \"{{ device.serialNumber }}\",\n        \"batteryState\":
        \"{{ device.batteryState }}\",\n        \"type\": \"{{ state_attr('sensor.tado_device_types',
        'types').get(device.type, device.type) }}\",\n        \"location\": \"{{ state_attr('sensor.tado_device_locations',
        'locations').get(device.serialNumber, device.serialNumber) }}\",\n        \"entity_id\":
        \"{{ state_attr('sensor.tado_device_ids', 'ids').get(device.serialNumber,
        device.serialNumber) }}\",\n        \"battery\": \"{{ state_attr('sensor.tado_device_batterys',
        'batterys').get(device.type, device.type) }}\",\n      }{% if not loop.last
        %}, {% endif %}\n    {% endfor %}\n  {% if not loop.last %}, {% endif %}\n
        \ {% endfor %}\n]"
  - repeat:
      count: '{{ devices | length }}'
      sequence:
      - action: system_log.write
        metadata: {}
        data:
          level: debug
          message: '{{ devices[repeat.index - 1] }}'
      - action: script.home_create_todo_task
        data:
          subject: Skift batteri på {{ devices[repeat.index - 1].type }} i {{ devices[repeat.index
            - 1].roomName }}{{ '' if not devices[repeat.index - 1].location else '
            (' ~ devices[repeat.index - 1].location ~ ')'}}
          description: 'Skift batteri på Tado {{ devices[repeat.index - 1].type }}
            med serie no {{ devices[repeat.index - 1].deviceSerialNo }}, der er pladseret
            {{ devices[repeat.index - 1].roomName }}{{ '''' if not devices[repeat.index
            - 1].location else '' ('' ~ devices[repeat.index - 1].location ~ '')''}},
            batteri status er {{ devices[repeat.index - 1].batteryState }}. Batteri:
            {{ devices[repeat.index - 1].battery }}'
          related_entity_id: '{{ devices[repeat.index - 1].entity_id }}'
          entity_id: todo.home_smart_todo
          is_active: '{{ devices[repeat.index - 1].batteryState != ''NORMAL'' }}'
  mode: restart
- id: '1739744093398'
  alias: Hjem todo IKEA rullegardiner
  description: Kontroller batteri status på IKEA rullegardiner
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.bedroom_blind_battery
    - sensor.emils_room_blind_battery
    - sensor.charlies_room_blind_battery
    - sensor.bedroom_blind_open_close_remote_battery
    - sensor.emils_room_blind_open_close_remote_battery
    - sensor.charlies_room_blind_open_close_remote_battery
    below: 5
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.bedroom_blind_battery
    - sensor.emils_room_blind_battery
    - sensor.charlies_room_blind_battery
    - sensor.bedroom_blind_open_close_remote_battery
    - sensor.emils_room_blind_open_close_remote_battery
    - sensor.charlies_room_blind_open_close_remote_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:12:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.bedroom_blind_battery
        battery_type: Genopladelig batteripakke
      - entity_id: sensor.emils_room_blind_battery
        battery_type: Genopladelig batteripakke
      - entity_id: sensor.charlies_room_blind_battery
        battery_type: Genopladelig batteripakke
      - entity_id: sensor.bedroom_blind_open_close_remote_battery
      - entity_id: sensor.emils_room_blind_open_close_remote_battery
      - entity_id: sensor.charlies_room_blind_open_close_remote_battery
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          type: '{{ repeat.item.battery_type | default('''') }}'
          threshold: 5
  mode: restart
  trace:
    stored_traces: 30
- id: '1739816800938'
  alias: Stue todo Roborock
  description: Kontroller status på robostøvsuger
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_robot_vacuum_dock_error
    - sensor.living_room_robot_vacuum_error
  - trigger: time
    at: 04:01:00
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Løs problem med Dobbys hus ({{ states('sensor.living_room_robot_vacuum_dock_error')
        }})
      description: Advarsel på Roborock docking station. Kode {{ states('sensor.living_room_robot_vacuum_dock_error')
        }}
      related_entity_id: sensor.living_room_robot_vacuum_dock_error
      entity_id: todo.todo_smart_todo
      is_active: '{{ states(''sensor.living_room_robot_vacuum_dock_error'') != ''ok''
        }}'
  - action: script.create_todo_task
    data:
      subject: Løs problem med Dobby ({{ states('sensor.living_room_robot_vacuum_error')
        }})
      description: Advarsel på Roborock robot støvsuger. Kode {{ states('sensor.living_room_robot_vacuum_error')
        }}
      related_entity_id: sensor.living_room_robot_vacuum_error
      entity_id: todo.todo_smart_todo
      is_active: '{{ states(''sensor.living_room_robot_vacuum_error'') != ''none''
        }}'
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.living_room_robot_vacuum_error
        state: none
    then:
    - action: script.push_notification
      data:
        type: warning
        recipient: home
        id: living_room_robot_vacuum_error
        title: Løs problem med Dobby
        message: Advarsel på Roborock robot støvsuger. Kode {{ states('sensor.living_room_robot_vacuum_error')
          }}
  mode: restart
  trace:
    stored_traces: 30
- id: '1739904709484'
  alias: Hjem todo Netatmo
  description: Kontroller batteri status på Netatmo enheder
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.garage_weather_station_battery
    - sensor.garden_anemometer_battery
    - sensor.garden_rain_gauge_battery
    - sensor.garden_weather_station_battery
    - sensor.greenhouse_weather_station_battery
    - sensor.technic_room_weather_station_battery
    below: 5
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.garage_weather_station_battery
    - sensor.garden_anemometer_battery
    - sensor.garden_rain_gauge_battery
    - sensor.garden_weather_station_battery
    - sensor.greenhouse_weather_station_battery
    - sensor.technic_room_weather_station_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:13:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.garage_weather_station_battery
        location: over køleskabet
        battery_type: 4 * AAA
      - entity_id: sensor.garden_anemometer_battery
        location: teknik rummet
        battery_type: strøm tilslutning
      - entity_id: sensor.garden_rain_gauge_battery
        location: på terrassen
        battery_type: 2 * AAA
      - entity_id: sensor.garden_weather_station_battery
        location: på garagen
        battery_type: 2 * AAA
      - entity_id: sensor.greenhouse_weather_station_battery
        battery_type: 4 * AAA
      - entity_id: sensor.technic_room_weather_station_battery
        location: på vandvarmer
        battery_type: 4 * AAA
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          type: '{{ repeat.item.battery_type | default('''') }}'
          location: '{{ repeat.item.location | default('''') }}'
          threshold: 5
  mode: restart
  trace:
    stored_traces: 30
- id: '1739906369450'
  alias: Hjem todo Philips Hue kontakter
  description: Kontroller batteri status på Philips Hue kontakter
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_switch_battery
    - sensor.kitchen_switch_battery
    - sensor.bedroom_switch_battery
    - sensor.hallway_switch_battery
    - sensor.patio_switch_battery
    - sensor.emils_room_switch_battery
    - sensor.charlies_room_switch_battery
    below: 5
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_switch_battery
    - sensor.kitchen_switch_battery
    - sensor.bedroom_switch_battery
    - sensor.hallway_switch_battery
    - sensor.patio_switch_battery
    - sensor.emils_room_switch_battery
    - sensor.charlies_room_switch_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:15:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.living_room_switch_battery
        battery_type: 1 * CR2032
      - entity_id: sensor.kitchen_switch_battery
        battery_type: 1 * CR2032
      - entity_id: sensor.bedroom_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.hallway_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.kitchen_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.patio_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.emils_room_switch_battery
        battery_type: 1 * CR2450
      - entity_id: sensor.charlies_room_switch_battery
        battery_type: 1 * CR2450
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          type: '{{ repeat.item.battery_type | default('''') }}'
          threshold: 5
  mode: restart
  trace:
    stored_traces: 30
- id: '1739907378753'
  alias: Hjem todo Philips Hue bevægelsessensor
  description: Kontroller batteri status på Philips Hue bevægelsessensorer
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.driveway_motion_sensor_entrance_battery
    - sensor.driveway_motion_sensor_house_south_battery
    - sensor.driveway_motion_sensor_street_battery
    - sensor.garden_motion_sensor_house_east_battery
    - sensor.garden_motion_sensor_house_west_battery
    - sensor.garden_motion_sensor_house_north_battery
    - sensor.entrance_motion_sensor_battery
    - sensor.utility_room_motion_sensor_battery
    - sensor.toilet_motion_sensor_battery
    below: 20
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.driveway_motion_sensor_entrance_battery
    - sensor.driveway_motion_sensor_house_south_battery
    - sensor.driveway_motion_sensor_street_battery
    - sensor.garden_motion_sensor_house_east_battery
    - sensor.garden_motion_sensor_house_west_battery
    - sensor.garden_motion_sensor_house_north_battery
    - sensor.entrance_motion_sensor_battery
    - sensor.utility_room_motion_sensor_battery
    - sensor.toilet_motion_sensor_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:20:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.driveway_motion_sensor_entrance_battery
        battery_type: 2 * AA
        location: ved hoveddøren
      - entity_id: sensor.driveway_motion_sensor_house_south_battery
        battery_type: 2 * AA
        location: på syd gavlen
      - entity_id: sensor.driveway_motion_sensor_street_battery
        battery_type: 2 * AA
        location: ved vejen
      - entity_id: sensor.garden_motion_sensor_house_north_battery
        battery_type: 2 * AA
        location: på nord gavlen
      - entity_id: sensor.garden_motion_sensor_house_west_battery
        battery_type: 2 * AA
        location: ved soveværelset
      - entity_id: sensor.garden_motion_sensor_house_east_battery
        battery_type: 2 * AA
        location: ved bryggersdøren
      - entity_id: sensor.entrance_motion_sensor_battery
        battery_type: 2 * AAA
      - entity_id: sensor.utility_room_motion_sensor_battery
        battery_type: 2 * AAA
      - entity_id: sensor.toilet_motion_sensor_battery
        battery_type: 2 * AAA
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          type: '{{ repeat.item.battery_type | default('''') }}'
          location: '{{ repeat.item.location | default('''') }}'
          threshold: 20
  mode: restart
  trace:
    stored_traces: 30
- id: '1739915975801'
  alias: Hjem todo Philips Hue dørsensor
  description: Kontroller batteri status på Philips Hue dør og vindue sensorer
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.bedroom_door_sensor_battery
    - sensor.garage_door_sensor_battery
    below: 10
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.bedroom_door_sensor_battery
    - sensor.garage_door_sensor_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:14:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.bedroom_door_sensor_battery
        battery_type: 1 * CR2
      - entity_id: sensor.garage_door_sensor_battery
        battery_type: 1 * CR2
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          type: '{{ repeat.item.battery_type | default('''') }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1740165836750'
  alias: Oprydning todo indkøbsseddel
  description: Automatik der sletter afsluttede opgaver på indkøbsseddel
  triggers:
  - trigger: time
    at: 03:00:00
  conditions: []
  actions:
  - action: script.cleanup_todo_tasks
    data:
      entity_id: todo.todo_shopping_list
      date: '{{ (now() - timedelta(days=2)).date() }}'
    response_variable: response
  - action: system_log.write
    data:
      level: info
      message: 'Deleted: {{ response.deleted }} '
  mode: restart
  trace:
    stored_traces: 30
- id: '1740170480608'
  alias: Hjem todo Frient røgalarm
  description: Kontroller batteri status på Frient røgalarm
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.charlies_room_smoke_alarm_battery
    - sensor.emils_room_smoke_alarm_battery
    - sensor.bedroom_smoke_alarm_battery
    - sensor.garage_smoke_alarm_battery
    - sensor.storage_smoke_alarm_battery
    - sensor.technic_room_smoke_alarm_battery
    below: 10
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.charlies_room_smoke_alarm_battery
    - sensor.emils_room_smoke_alarm_battery
    - sensor.bedroom_smoke_alarm_battery
    - sensor.garage_smoke_alarm_battery
    - sensor.storage_smoke_alarm_battery
    - sensor.technic_room_smoke_alarm_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:24:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.charlies_room_smoke_alarm_battery
      - entity_id: sensor.emils_room_smoke_alarm_battery
      - entity_id: sensor.bedroom_smoke_alarm_battery
      - entity_id: sensor.garage_smoke_alarm_battery
      - entity_id: sensor.storage_smoke_alarm_battery
      - entity_id: sensor.technic_room_smoke_alarm_battery
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1740337167224'
  alias: Hjem todo Aqara vibrationsensor
  description: Kontroller batteri status på Aqara vibrationsensorer
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.driveway_mailbox_vibration_sensor_battery
    below: 20
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.driveway_mailbox_vibration_sensor_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:11:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.driveway_mailbox_vibration_sensor_battery
        temperature: '{{ states(''sensor.driveway_mailbox_vibration_sensor_device_temperature'')
          }}'
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          temperature:
          threshold: 20
  mode: restart
  trace:
    stored_traces: 30
- id: '1740422421448'
  alias: Monique sæt sengetid
  description: Sæt sengetid input hjælper for Monique, når webhook er kaldt
  triggers:
  - trigger: webhook
    allowed_methods:
    - POST
    local_only: false
    webhook_id: monique-set-bedtime-CNwYS0I0HIbgeRZ1GmGOxxvS
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: '{{ now() + timedelta(seconds=10) }}'
    target:
      entity_id: input_datetime.monique_bedtime_alarm
  mode: restart
  trace:
    stored_traces: 10
- id: '1740423743719'
  alias: Emil sæt sengetid
  description: Sæt sengetid input hjælper for Emil, når webhook er kaldt
  triggers:
  - trigger: webhook
    allowed_methods:
    - POST
    local_only: false
    webhook_id: emil-set-bedtime-06NToCv45RaHexKeI8Smp4d-
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: '{{ now() + timedelta(seconds=10) }}'
    target:
      entity_id: input_datetime.emil_bedtime_alarm
  mode: restart
  trace:
    stored_traces: 10
- id: '1740423776035'
  alias: Charlie sæt sengetid
  description: Sæt sengetid input hjælper for Charlie, når webhook er kaldt
  triggers:
  - trigger: webhook
    allowed_methods:
    - POST
    local_only: false
    webhook_id: charlie-set-bedtime-o80tZ1S3giYimCOs0ZQ4Xloc
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      datetime: '{{ now() + timedelta(seconds=10) }}'
    target:
      entity_id: input_datetime.charlie_bedtime_alarm
  mode: restart
  trace:
    stored_traces: 10
- id: '1740779558756'
  alias: Hjem todo affald
  description: Automation til at oprette todo for at tømme affald og tage affaldscontainer
    på til vejen
  triggers:
  - trigger: time
    at: '10:00:00'
  conditions: []
  actions:
  - action: rest_command.perfect_waste_get_next_address_collection
    metadata: {}
    data:
      addressID: '17545'
      municipality: 253
    response_variable: response
  - variables:
      pickup_date: '{{ as_datetime(response.content.result.date).date() }}'
      tomorrow: '{{ now().date() + timedelta(days=1) }}'
      today: '{{ now().date() }}'
      status: '{{ response.status }}'
      containers: "{% set ns = namespace(fractions=[]) %}\n{% for fraction in response.content.result.fractions
        %}\n  {% set ns.fractions = ns.fractions + [fraction.fractionName] %}\n{%
        endfor %}\n{{ ns.fractions }}"
      description_text: "Følgende affaldscontainere skal køres op til vejen i dag:
        <ul> {% for c in containers %}\n  <li>{{ c }}</li>\n{% endfor %} </ul>"
  - action: system_log.write
    metadata: {}
    data:
      level: debug
      message: '"Pickup date: {{ pickup_date }}"

        "Tomorrow: {{ tomorrow }}"'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ status != 200 }}'
      sequence:
      - action: persistent_notification.create
        metadata: {}
        data:
          message: 'Status: {{ status }}

            Response: {{ response }}              '
          title: Unable to find next trash pickup
    - conditions:
      - condition: template
        value_template: '{{ pickup_date == tomorrow }}'
      sequence:
      - action: input_datetime.set_datetime
        metadata: {}
        data:
          date: '{{ pickup_date }}'
        target:
          entity_id: input_datetime.home_trash_pickup_date
      - action: script.create_todo_task
        data:
          subject: Kør affaldscontainer op til vejen
          description: '{{ description_text }}'
          related_entity_id: rest_command.perfect_waste_get_next_address_collection
          entity_id: todo.todo_smart_todo
          is_active: 'true'
    - conditions:
      - condition: template
        value_template: '{{ states(''input_datetime.home_trash_pickup_date'') == today
          }}'
      sequence:
      - action: script.create_todo_task
        data:
          subject: Hent affaldscontainer ved vejen
          description: Hent affaldscontainere ved vejen og sæt tilbage bag garagen.
          related_entity_id: rest_command.perfect_waste_get_next_address_collection
          entity_id: todo.todo_smart_todo
  - if:
    - condition: template
      value_template: '{{ now().weekday() == 1 }}'
    then:
    - action: script.create_todo_task
      data:
        subject: Tøm affald
        description: Tøm alle affaldsspande i huset, inklusiv toiletter, værelser
          og bryggers
        entity_id: todo.todo_smart_todo
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1740941401019'
  alias: Todo iPhone indstillinger
  description: Automatik til at kontrollere iPhone-status
  triggers:
  - entity_id:
    - sensor.anders_iphone_location_permission
    - sensor.monique_iphone_location_permission
    - sensor.emil_iphone_location_permission
    - sensor.charlie_iphone_location_permission
    id: permission_changed
    trigger: state
  - entity_id:
    - sensor.anders_iphone_connection_type
    - sensor.monique_iphone_connection_type
    - sensor.emil_iphone_connection_type
    - sensor.charlie_iphone_connection_type
    to: Wi-Fi
    id: wifi_connected
    trigger: state
  - at: 05:00:00
    id: periodic
    trigger: time
  conditions: []
  actions:
  - variables:
      iphones:
      - name: Anders
        location_permission: sensor.anders_iphone_location_permission
        connection_type: sensor.anders_iphone_connection_type
        device_tracker: device_tracker.anders_iphone
        notify: notify.mobile_app_anders_iphone
      - name: Monique
        location_permission: sensor.monique_iphone_location_permission
        connection_type: sensor.monique_iphone_connection_type
        device_tracker: device_tracker.monique_iphone
        notify: notify.mobile_app_monique_iphone
      - name: Emil
        location_permission: sensor.emil_iphone_location_permission
        connection_type: sensor.emil_iphone_connection_type
        device_tracker: device_tracker.emil_iphone
        notify: notify.mobile_app_emil_iphone
      - name: Charlie
        location_permission: sensor.charlie_iphone_location_permission
        connection_type: sensor.charlie_iphone_connection_type
        device_tracker: device_tracker.charlie_iphone
        notify: notify.mobile_app_charlie_iphone
  - if:
    - condition: trigger
      id:
      - permission_changed
      - periodic
    then:
    - repeat:
        for_each: '{{ iphones }}'
        sequence:
        - action: script.create_todo_task
          data:
            subject: 'Lokation: Tillad altid ({{ repeat.item.name }} iPhone)'
            description: Gå til Indstillinger → Anonymitet & sikkerhed → Lokalitetstjenester,
              og sæt Home Assistant til "Altid". Slå også "Præcis lokalitet" til.
            related_entity_id: '{{ repeat.item.location_permission }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ states(repeat.item.location_permission) != ''Authorized
              Always'' }}'
  - if:
    - condition: trigger
      id:
      - wifi_connected
      - periodic
    then:
    - repeat:
        for_each: '{{ iphones }}'
        sequence:
        - if:
          - condition: template
            value_template: '{{ states(repeat.item.connection_type) == ''Wi-Fi'' }}'
          then:
          - action: homeassistant.update_entity
            data:
              entity_id: '{{ repeat.item.device_tracker }}'
          - action: '{{ repeat.item.notify }}'
            data:
              message: request_location_update
    - delay: 00:00:10
    - repeat:
        for_each: '{{ iphones }}'
        sequence:
        - if:
          - condition: template
            value_template: '{{ states(repeat.item.connection_type) == ''Wi-Fi'' }}'
          then:
          - action: script.create_todo_task
            data:
              subject: Lokation opdateres ikke ({{ repeat.item.name }} iPhone)
              description: Lokationen fra {{ repeat.item.name }} iPhone er ikke blevet
                opdateret som forventet. Kontroller Home Assistant appens lokationsindstillinger
                og baggrundsopdatering.
              related_entity_id: '{{ repeat.item.device_tracker }}'
              entity_id: todo.todo_smart_todo
              is_active: "{{ (as_timestamp(now()) -\n    as_timestamp(states[repeat.item.device_tracker].last_updated))
                > 60 }}"
  mode: single
  trace:
    stored_traces: 20
- id: '1741115279443'
  alias: Stue todo Canon printer
  description: Kontroller blæk status på Canon printer
  triggers:
  - entity_id:
    - sensor.living_room_printer_black_bk
    - sensor.living_room_printer_black_pgbk
    - sensor.living_room_printer_cyan
    - sensor.living_room_printer_magenta
    - sensor.living_room_printer_photo_blue
    - sensor.living_room_printer_yellow
    below: 15
    trigger: numeric_state
  - entity_id:
    - sensor.living_room_printer_black_bk
    - sensor.living_room_printer_black_pgbk
    - sensor.living_room_printer_cyan
    - sensor.living_room_printer_magenta
    - sensor.living_room_printer_photo_blue
    - sensor.living_room_printer_yellow
    above: 20
    trigger: numeric_state
  - entity_id: sensor.living_room_printer
    trigger: state
    from: printing
    to: idle
  - at: 03:17:00
    trigger: time
  conditions: []
  actions:
  - repeat:
      for_each:
      - entity: sensor.living_room_printer_black_pgbk
        name: sort (PGBK)
        ink: Canon Pixma 580 PGBK (Black)
      - entity: sensor.living_room_printer_black_bk
        name: sort (BK)
        ink: Canon Pixma 581 BK (Black)
      - entity: sensor.living_room_printer_cyan
        name: cyan
        ink: Canon Pixma 581 C (Cyan)
      - entity: sensor.living_room_printer_magenta
        name: magenta
        ink: Canon Pixma 581 M (Magenta)
      - entity: sensor.living_room_printer_photo_blue
        name: foto blå
        ink: Canon Pixma 581 PB (Photo blå)
      - entity: sensor.living_room_printer_yellow
        name: gul
        ink: Canon Pixma 581 Y (Yellow)
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(repeat.item.entity) not in [''unknown'', ''unavailable'']
            }}'
        then:
        - action: script.create_todo_task
          data:
            subject: Skift {{ repeat.item.name }} blæk på printer
            description: 'Blæk niveau for {{ repeat.item.name }} er {{ states(repeat.item.entity)
              }}% på Canon TS8300 printer.<br> Blæk type: {{ repeat.item.ink }}'
            related_entity_id: '{{ repeat.item.entity }}'
            entity_id: todo.todo_smart_todo
            is_active: '{{ states(repeat.item.entity)|int(100) < state_attr(repeat.item.entity,
              ''marker_low_level'')|int(15) }}'
  - action: script.create_todo_task
    data:
      subject: Løs problem med printer
      description: 'Der er registreret et problem med Canon TS8300 printer.<br> Message:
        {{ state_attr(''sensor.living_room_printer'', ''state_message'') }}<br> Reason:
        {{ state_attr(''sensor.living_room_printer'', ''state_reason'') }}'
      related_entity_id: sensor.living_room_printer
      entity_id: todo.todo_smart_todo
      is_active: '{{ states(''sensor.living_room_printer'') not in [''printing'',
        ''idle''] }}'
  mode: restart
- id: '1742241186159'
  alias: Bryggers todo vaskemaskine
  description: Opret todo opgaver vedrørende vaskemaskine
  triggers:
  - trigger: state
    entity_id: input_select.utility_room_washer_state
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Tøm vaskemaskinen
      description: Vaskemaskinen er færdig, tøm og tør tøjet
      related_entity_id: input_select.utility_room_washer_state
      entity_id: todo.todo_smart_todo
      is_active: '{{ is_state(''input_select.utility_room_washer_state'', ''finished'')
        }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1747337340117'
  alias: Entre lys
  description: Automatik til at styre lys i entreen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.entrance_presence
    to: 'on'
    id: detected_inside
  - trigger: state
    entity_id:
    - binary_sensor.entrance_presence
    to: 'off'
    id: cleared_inside
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    to: 'on'
    id: detected_outside
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    to: 'off'
    id: cleared_outside
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
  conditions: []
  actions:
  - variables:
      light: '{{ states(''binary_sensor.entrance_light'') }}'
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_inside
      - condition: numeric_state
        entity_id: sensor.entrance_motion_sensor_illuminance
        below: 200
      sequence:
      - variables:
          light: 'on'
    - conditions:
      - condition: trigger
        id:
        - detected_outside
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - variables:
          light: 'on'
    - conditions:
      - condition: trigger
        id:
        - cleared_inside
        - cleared_outside
      - condition: state
        entity_id: binary_sensor.entrance_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.driveway_entrance_presence
        state: 'off'
      sequence:
      - variables:
          light: 'off'
    - conditions:
      - condition: trigger
        id:
        - no_one_home
      sequence:
      - variables:
          light: 'off'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ light == "on" }}

          '
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 30
          transition: 1
        target:
          entity_id:
          - light.entrance_lights
    - conditions:
      - condition: template
        value_template: '{{ light == "on" }}

          '
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 80
          transition: 1
        target:
          entity_id:
          - light.entrance_lights
    - conditions:
      - condition: template
        value_template: '{{ light == "off" }}

          '
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.entrance_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1747340588102'
  alias: Toilet lys
  description: Automatik til at styre lys på toilettet
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.toilet_presence
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.toilet_presence
    from: 'on'
    to: 'off'
    id: cleared
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 10
          transition: 1
        target:
          entity_id:
          - light.toilet_light
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          transition: 1
        target:
          entity_id:
          - light.toilet_light
    - conditions:
      - condition: trigger
        id:
        - cleared
        - no_one_home
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.toilet_light
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1748709891445'
  alias: Bryggers lys
  description: Automatik til at styre lys i bryggerset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_presence
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_presence
    to: 'off'
    id: cleared
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      - condition: numeric_state
        entity_id: sensor.utility_room_motion_sensor_illuminance
        below: 400
      - condition: numeric_state
        entity_id: light.kitchen_lights
        attribute: brightness
        below: 60
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 30
          transition: 1
        target:
          entity_id:
          - light.utility_room_lights
    - conditions:
      - condition: trigger
        id:
        - detected
      - condition: numeric_state
        entity_id: sensor.utility_room_motion_sensor_illuminance
        below: 400
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          color_temp_kelvin: 2700
          brightness_pct: 80
          transition: 1
        target:
          entity_id:
          - light.utility_room_lights
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - cleared
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.utility_room_lights
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760275142990'
  alias: Køkken lys
  description: Automatik til at styre lys i køkkenet
  triggers:
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_1
    attribute: event_type
    to: short_release
    id: button_1_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_1
    attribute: event_type
    to: long_release
    id: button_1_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_2
    attribute: event_type
    to: short_release
    id: button_2_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_2
    attribute: event_type
    to: long_release
    id: button_2_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_3
    attribute: event_type
    to: short_release
    id: button_3_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_3
    attribute: event_type
    to: long_release
    id: button_3_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_4
    attribute: event_type
    to: short_release
    id: button_4_short
  - trigger: state
    entity_id:
    - event.kitchen_switch_button_4
    attribute: event_type
    to: long_release
    id: button_4_long
  - trigger: state
    entity_id:
    - event.kitchen_switch_rotary
    id: rotary
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_light
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: lights_on
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_presence
    to:
    - 'off'
    id: person_cleared
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_presence
    to:
    - 'on'
    id: person_detected
  - trigger: state
    entity_id:
    - binary_sensor.living_room_light
    to: 'off'
    id: living_room_light_off
  - trigger: state
    entity_id:
    - binary_sensor.living_room_light
    to: 'on'
    id: living_room_light_on
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - button_1_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - button_2_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 15
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - button_3_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - button_4_short
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 3000
          brightness_pct: 100
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - button_1_long
        - button_2_long
        - button_3_long
        - button_4_long
        - no_one_home
        - living_room_light_off
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - person_detected
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.kitchen_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 10
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
    - conditions:
      - condition: trigger
        id:
        - person_cleared
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      - condition: state
        entity_id: binary_sensor.living_room_light
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - person_detected
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - person_cleared
      - condition: state
        entity_id: binary_sensor.kitchen_light
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 15
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - living_room_light_on
      - condition: state
        entity_id: binary_sensor.kitchen_presence
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2700
          brightness_pct: 80
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - living_room_light_on
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 50
        target:
          entity_id:
          - light.kitchen_light_strip_countertop
      - action: light.turn_on
        metadata: {}
        data:
          transition: 1
          color_temp_kelvin: 2300
          brightness_pct: 15
        target:
          entity_id:
          - light.kitchen_light_pendant_island_left
          - light.kitchen_light_pendant_island_right
          - light.kitchen_light_pendant_sink_left
          - light.kitchen_light_pendant_sink_right
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_light_spot_island
          - light.kicthen_light_spot_cooktop
          - light.kitchen_light_spot_oven
          - light.kitchen_light_spot_sink
          - light.kitchen_light_spot_fridge
          - light.kitchen_light_spot_hallway
    - conditions:
      - condition: trigger
        id:
        - light_on
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.kitchen_lights
    - conditions:
      - condition: trigger
        id:
        - rotary
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: event.kitchen_switch_rotary
            attribute: event_type
            state: clock_wise
          - condition: state
            entity_id: binary_sensor.kitchen_light
            state: 'off'
          sequence:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_pct: '{{ (state_attr(''event.kitchen_switch_rotary'', ''steps'')|float
                / 3.60)|round(0) }}'
            target:
              entity_id: light.kitchen_lights
        - conditions:
          - condition: state
            entity_id: event.kitchen_switch_rotary
            attribute: event_type
            state: clock_wise
          sequence:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_step_pct: '{{ (state_attr(''event.kitchen_switch_rotary'',
                ''steps'')|float / 3.60)|round(0) }}'
            target:
              entity_id: '{{ state_attr(''light.kitchen_lights'', ''entity_id'') |  expand()
                | selectattr(''state'', ''eq'', ''on'') |  map(attribute=''entity_id'')
                | list }}'
        default:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_step_pct: '{{ (state_attr(''event.kitchen_switch_rotary'',
              ''steps'')|float / -3.60)|round(0) }}'
          target:
            entity_id: '{{ state_attr(''light.kitchen_lights'', ''entity_id'') | expand()
              | selectattr(''state'', ''eq'', ''on'') | map(attribute=''entity_id'')
              | list }}      '
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1760825733513'
  alias: Have lys hus nord
  description: Automatik til at styre lys i haven på nord siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_north_presence
    from: 'off'
    to: 'on'
    id: detected_north
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_north_presence
    from: 'on'
    to: 'off'
    id: cleared_north
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_east_presence
    from: 'off'
    to: 'on'
    id: detected_east
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_east_presence
    from: 'on'
    to: 'off'
    id: cleared_east
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_north
        - detected_east
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_north
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_north
          - cleared_east
        - condition: state
          entity_id: binary_sensor.garden_house_north_presence
          state: 'off'
        - condition: state
          entity_id: binary_sensor.garden_house_east_presence
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_north
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760825948230'
  alias: Have lys hus vest
  description: Automatik til at styre lys i haven på vest siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_west_presence
    from: 'off'
    to: 'on'
    id: detected_west
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_west_presence
    from: 'on'
    to: 'off'
    id: cleared_west
  - trigger: state
    entity_id:
    - binary_sensor.driveway_house_south_presence
    from: 'off'
    to: 'on'
    id: detected_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_house_south_presence
    from: 'on'
    to: 'off'
    id: cleared_south
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_west
        - detected_south
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_west
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_west
          - cleared_south
        - condition: state
          entity_id: binary_sensor.garden_house_west_presence
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_house_south_presence
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_west
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760878547397'
  alias: Indkørsel bevægelsessensor vej
  description: Håndtering af bevægelsessensoren i indkørslen ved vejen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_street_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.driveway_motion_sensor_street_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.driveway_motion_sensor_street_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878795560'
  alias: Indkørsel bevægelsessensor hus syd
  description: Håndtering af bevægelsessensoren i indkørslen på syd siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_house_south_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.driveway_motion_sensor_house_south_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.driveway_motion_sensor_house_south_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878828758'
  alias: Indkørsel bevægelsessensor entre
  description: Håndtering af bevægelsessensoren i indkørslen ved hoveddøren
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.driveway_motion_sensor_entrance_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.driveway_motion_sensor_entrance_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.driveway_motion_sensor_entrance_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878858273'
  alias: Have bevægelsessensor hus øst
  description: Håndtering af bevægelsessensoren i haven på øst siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_east_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garden_motion_sensor_house_east_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.garden_motion_sensor_house_east_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878885972'
  alias: Have bevægelsessensor hus nord
  description: Håndtering af bevægelsessensoren i haven på nord siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_north_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_north_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garden_motion_sensor_house_north_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.garden_motion_sensor_house_north_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760878906998'
  alias: Have bevægelsessensor hus vest
  description: Håndtering af bevægelsessensoren i haven på vest siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.garden_motion_sensor_house_west_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.garden_motion_sensor_house_west_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.garden_motion_sensor_house_west_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 5
- id: '1760882456215'
  alias: Have lys hus øst
  description: Automatik til at styre lys i haven på øst siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_east_presence
    from: 'off'
    to: 'on'
    id: detected_east
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_east_presence
    from: 'on'
    to: 'off'
    id: cleared_east
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'on'
    to: 'off'
    id: cleared_entrance
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_east
        - detected_entrance
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_east
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_east
          - cleared_entrance
        - condition: state
          entity_id: binary_sensor.garden_house_east_presence
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_entrance_presence
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.garden_light_house_east
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760882975403'
  alias: Indkørsel lys hus syd
  description: Automatik til at styre lys i indkørslen på syd siden af huset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_house_south_presence
    from: 'off'
    to: 'on'
    id: detected_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_house_south_presence
    from: 'on'
    to: 'off'
    id: cleared_south
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'on'
    to: 'off'
    id: cleared_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_street_presence
    from: 'off'
    to: 'on'
    id: detected_street
  - trigger: state
    entity_id:
    - binary_sensor.driveway_street_presence
    from: 'on'
    to: 'off'
    id: cleared_street
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_west_presence
    from: 'off'
    to: 'on'
    id: detected_west
  - trigger: state
    entity_id:
    - binary_sensor.garden_house_west_presence
    from: 'on'
    to: 'off'
    id: cleared_west
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_south
        - detected_entrance
        - detected_street
        - detected_west
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 100
          color_temp_kelvin: 2700
          transition: 1
        target:
          entity_id:
          - light.driveway_light_house_south
    - conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - cleared_south
          - cleared_entrance
          - cleared_street
          - cleared_west
        - condition: state
          entity_id: binary_sensor.driveway_house_south_presence
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_entrance_presence
          state: 'off'
        - condition: state
          entity_id: binary_sensor.driveway_street_presence
          state: 'off'
        - condition: state
          entity_id: binary_sensor.garden_house_west_presence
          state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.driveway_light_house_south
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760883022741'
  alias: Indkørsel lys entre
  description: Automatik til at styre lys i indkørslen ved hoveddøren
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'off'
    to: 'on'
    id: detected_entrance
  - trigger: state
    entity_id:
    - binary_sensor.driveway_entrance_presence
    from: 'on'
    to: 'off'
    id: cleared_entrance
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected_entrance
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 70
          transition: 1
          color_temp_kelvin: 2700
        target:
          entity_id:
          - light.driveway_light_entrance_spot_1
          - light.driveway_light_entrance_spot_2
          - light.driveway_light_entrance_spot_3
    - conditions:
      - condition: trigger
        id:
        - cleared_entrance
      sequence:
      - action: light.turn_off
        metadata: {}
        data:
          transition: 1
        target:
          entity_id:
          - light.driveway_light_entrance_spot_1
          - light.driveway_light_entrance_spot_2
          - light.driveway_light_entrance_spot_3
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1760968576162'
  alias: Soveværelse tilstedeværelsessensor
  description: Automatik til at styre soveværelse tilstedeværelsessensor
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence_sensor_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_presence_sensor_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  - trigger: state
    entity_id: timer.bedroom_presence_sensor_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: binary_sensor.bedroom_door
    from: 'on'
    to: 'off'
    id: closed
  - trigger: state
    entity_id: binary_sensor.bedroom_door
    from: 'off'
    to: 'on'
    id: opened
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
    id: wake
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: detected
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'off'
      - condition: state
        entity_id: input_boolean.bedroom_presence
        state: 'off'
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_presence_sensor_timer
    - conditions:
      - condition: trigger
        id: detected
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.bedroom_presence
      - action: timer.pause
        target:
          entity_id: timer.bedroom_presence_sensor_timer
    - conditions:
      - condition: trigger
        id: cleared
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'off'
      - condition: template
        value_template: '{{ states.binary_sensor.bedroom_door.last_changed | as_local
          > now() - timedelta(seconds=30) }}'
      sequence: []
    - conditions:
      - condition: trigger
        id: cleared
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'on'
      sequence:
      - action: timer.start
        data:
          duration: 00:10:00
        target:
          entity_id: timer.bedroom_presence_sensor_timer
    - conditions:
      - condition: trigger
        id: cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:02:00
        target:
          entity_id: timer.bedroom_presence_sensor_timer
    - conditions:
      - condition: trigger
        id: timeout
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.bedroom_presence
    - conditions:
      - condition: trigger
        id:
        - opened
        - closed
      - condition: state
        entity_id: binary_sensor.bedroom_presence_sensor_occupancy
        state: 'on'
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.bedroom_presence
    - conditions:
      - condition: trigger
        id: opened
      - condition: state
        entity_id: binary_sensor.bedroom_presence_sensor_occupancy
        state: 'off'
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.bedroom_presence
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:30
        target:
          entity_id: timer.bedroom_presence_sensor_timer
    - conditions:
      - condition: trigger
        id: closed
      - condition: state
        entity_id: binary_sensor.bedroom_presence_sensor_occupancy
        state: 'off'
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.bedroom_presence
    - conditions:
      - condition: trigger
        id: sleeping
      sequence:
      - action: select.select_option
        target:
          entity_id: select.bedroom_presence_sensor_detection_sensitivity
        data:
          option: High
    - conditions:
      - condition: trigger
        id: wake
      sequence:
      - action: select.select_option
        target:
          entity_id: select.bedroom_presence_sensor_detection_sensitivity
        data:
          option: Low
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1761840992462'
  alias: Terrasse lås
  description: Automatik til at styre terrasse dør låsen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    - binary_sensor.bedroom_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.patio_lock_timer
    to:
    - idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.patio_lock
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.patio_lock
        state: unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.patio_lock
      - action: timer.start
        metadata: {}
        data:
          duration: 00:01:00
        target:
          entity_id: timer.patio_lock_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.patio_lock
        state:
        - unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.patio_lock
      - delay: 00:00:01
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: lock.patio_lock
            state: locked
        - condition: state
          entity_id: binary_sensor.house_sitter_home
          state: 'off'
        then:
        - action: script.push_notification
          data:
            type: critical
            title: Advarsel
            message: Terrassedøren kunne ikke låses automatisk!
            id: patio_lock_auto_warning
            recipient: home
            persistent: false
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1763801218547'
  alias: Hjem ventilation forvarme
  description: Styring af forvarme til Nilan ventilationsanlæg
  triggers:
  - trigger: state
    entity_id: binary_sensor.everyone_sleeping
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: numeric_state
    entity_id: sensor.home_outside_current_temperature
    below: 1
  - trigger: numeric_state
    entity_id: sensor.home_outside_current_temperature
    above: 3
  - trigger: state
    entity_id: climate.storage_ventilation_system_ventilation
    attribute: fan_mode
    to:
    - 'off'
  - trigger: state
    entity_id: climate.storage_ventilation_system_ventilation
    attribute: fan_mode
    from:
    - 'off'
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.home_outside_current_temperature
        below: 1
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.everyone_sleeping
        state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.storage_ventilation_system_ventilation
          attribute: fan_mode
          state: 'off'
      sequence:
      - action: switch.turn_on
        target:
          entity_id: switch.storage_smart_plug_ventilation_preheating
    - conditions:
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.home_outside_current_temperature
          above: 3
        - condition: state
          entity_id: binary_sensor.someone_home
          state: 'off'
        - condition: state
          entity_id: binary_sensor.everyone_sleeping
          state: 'on'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.storage_smart_plug_ventilation_preheating
  mode: restart
  trace:
    stored_traces: 30
- id: '1763846508906'
  alias: Bryggers lås
  description: Automatik til at låse bryggersdøren op og i baseret på hvem der er
    hjemme
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    - binary_sensor.bedroom_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.utility_room_lock_timer
    to: idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.utility_room_lock
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.utility_room_lock
        state: unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.utility_room_lock
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.utility_room_lock_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.utility_room_lock
        state:
        - unlocked
      - condition: state
        entity_id: binary_sensor.house_sitter_home
        state: 'off'
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          message: Bryggers døren kunne ikke låses automatisk!
          id: utility_room_lock_auto_warning
          recipient: home
          persistent: false
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1763847410643'
  alias: Garage lås
  description: Automatik til at låse garage døren op og i baseret på hvem der er hjemme
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - binary_sensor.everyone_sleeping
    - binary_sensor.bedroom_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - timer.garage_lock_timer
    to: idle
    id: auto_locking_expired
  conditions: []
  actions:
  - action: homeassistant.update_entity
    data:
      entity_id: lock.garage_lock
  - delay:
      seconds: 3
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_one_home
        - sleeping
      - condition: state
        entity_id: lock.garage_lock
        state: unlocked
      sequence:
      - action: lock.lock
        metadata: {}
        data: {}
        target:
          entity_id: lock.garage_lock
      - action: timer.start
        metadata: {}
        data:
          duration: 00:00:10
        target:
          entity_id: timer.garage_lock_timer
    - conditions:
      - condition: trigger
        id:
        - auto_locking_expired
      - condition: state
        entity_id: lock.garage_lock
        state:
        - unlocked
      - condition: state
        entity_id: binary_sensor.house_sitter_home
        state: 'off'
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          message: Garage døren kunne ikke låses automatisk!
          id: garage_lock_auto_warning
          recipient: home
          persistent: false
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1764364029434'
  alias: Hjem aflæs EL måler
  description: Aflæs elektricitets forbrug og gem i CSV fil
  triggers:
  - at: 01:00:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().day == 1 }}'
  actions:
  - action: shell_command.append_to_file
    metadata: {}
    data:
      line: '{{ (state_attr(''sensor.home_electricity_meter'', ''ValueDate'') | as_datetime
        | as_local).strftime(''%Y-%m-%dT%H:%M:%S'') }},{{ state_attr(''sensor.home_electricity_meter'',
        ''CounterReadingImport'') }}'
      file: /config/data/meter_reading_electricity.csv
  mode: single
- id: '1764365776080'
  alias: Hjem læs elektricitet måler aflæsninger
  description: Indlæs elektricitet måler aflæsninger og opdater sensor
  triggers:
  - trigger: homeassistant
    event: start
  - trigger: event
    event_type: folder_data_csv
    event_data:
      status: meter_reading_electricity
  - trigger: state
    entity_id: sensor.home_meter_readings_electricity
    to: '0'
  conditions: []
  actions:
  - action: shell_command.csv_to_json
    metadata: {}
    data:
      csvfile: /config/data/meter_reading_electricity.csv
      jsonfile: /config/data/meter_reading_electricity.json
  - action: file.read_file
    metadata: {}
    data:
      file_name: /config/data/meter_reading_electricity.json
      file_encoding: JSON
    response_variable: readings
  - action: python_script.hass_entities
    data:
      action: set_state_attributes
      entity_id: sensor.home_meter_readings_electricity
      state: '{{ readings.data[-1].reading }}'
      attributes:
      - raw: '{{ readings.data }}'
  - action: python_script.meter_interpolate
    data:
      entity_id: sensor.home_meter_readings_electricity
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1764615121152'
  alias: Opdater iPhone location
  description: Opdater iPhone location hvis iPhone-sensorer er mere end 1 time gamle.
  triggers:
  - minutes: /10
    trigger: time_pattern
  conditions:
  - condition: template
    value_template: '{{ stale_locations | count > 0 }}'
  actions:
  - repeat:
      for_each: '{{ stale_locations }}'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.anders_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_anders_iphone
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.monique_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_monique_iphone
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.emil_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_emil_iphone
        - conditions:
          - condition: template
            value_template: '{{ repeat.item == ''sensor.charlie_iphone_location_last_updated''
              }}'
          sequence:
          - data:
              message: request_location_update
            action: notify.mobile_app_charlie_iphone
  variables:
    iphone_sensors:
    - sensor.anders_iphone_location_last_updated
    - sensor.monique_iphone_location_last_updated
    - sensor.emil_iphone_location_last_updated
    - sensor.charlie_iphone_location_last_updated
    stale_locations: "{% set ns = namespace(stale=[]) %} {% for e in iphone_sensors
      %}\n  {% set s = states(e) %}\n  {% if s not in ['unknown', 'unavailable', '']
      %}\n    {% set age = (now() - (s | as_datetime)).total_seconds() %}\n    {%
      if age > 3600 and age < 4200 %} \n      {% set ns.stale = ns.stale + [e] %}\n
      \   {% endif %}\n  {% endif %}\n{% endfor %} {{ ns.stale }}"
  mode: single
  trace:
    stored_traces: 20
- id: '1764966963610'
  alias: Hjem aflæs vand måler
  description: Aflæs vand forbrug og gem i CSV fil
  triggers:
  - at: 01:00:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().day == 1 }}'
  actions:
  - action: shell_command.append_to_file
    metadata: {}
    data:
      line: '{{ (state_attr(''sensor.home_water_meter'', ''timestamp'') | as_datetime).strftime(''%Y-%m-%dT%H:%M:%S'')
        }},{{ state_attr(''sensor.home_water_meter'', ''total_m3'') }}'
      file: /config/data/meter_reading_water.csv
  mode: single
- id: '1764973371100'
  alias: Overvåg data folder
  description: Overvågning af data folder
  triggers:
  - trigger: state
    entity_id:
    - event.folder_watcher_config_data
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: event.folder_watcher_config_data
        state:
        - meter_reading_electricity.csv
        attribute: file
      sequence:
      - event: folder_data_csv
        event_data:
          status: meter_reading_electricity
    - conditions:
      - condition: state
        entity_id: event.folder_watcher_config_data
        state:
        - meter_reading_water.csv
        attribute: file
      sequence:
      - event: folder_data_csv
        event_data:
          status: meter_reading_water
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1764974327446'
  alias: Hjem læs vand måler aflæsninger
  description: Indlæs vand måler aflæsninger og opdater sensor
  triggers:
  - trigger: homeassistant
    event: start
  - trigger: event
    event_type: folder_data_csv
    event_data:
      status: meter_reading_water
  - trigger: state
    entity_id: sensor.home_meter_readings_water
    to: '0'
  conditions: []
  actions:
  - action: shell_command.csv_to_json
    metadata: {}
    data:
      csvfile: /config/data/meter_reading_water.csv
      jsonfile: /config/data/meter_reading_water.json
  - action: file.read_file
    metadata: {}
    data:
      file_name: /config/data/meter_reading_water.json
      file_encoding: JSON
    response_variable: readings
  - action: python_script.hass_entities
    data:
      action: set_state_attributes
      entity_id: sensor.home_meter_readings_water
      state: '{{ readings.data[-1].reading }}'
      attributes:
      - raw: '{{ readings.data }}'
  - action: python_script.meter_interpolate
    data:
      entity_id: sensor.home_meter_readings_water
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1765134832184'
  alias: Køkken robotstøvsuger rengøring
  description: Styring af robotstøvsuger for at gør rent i køkkenet og bryggers
  triggers:
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  - trigger: numeric_state
    entity_id: sensor.living_room_robot_vacuum_battery
    above: 30
  - trigger: state
    entity_id: binary_sensor.living_room_media_player
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
    for: 00:02:00
  - trigger: state
    entity_id: binary_sensor.monique_sleep_window
    to: 'off'
    for: 00:02:00
  - trigger: state
    entity_id: binary_sensor.kitchen_presence
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.utility_room_presence
    to: 'off'
  - trigger: time
    at: '11:30:00'
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_time_since_empty_dust_bin
    to: '0'
    for: 00:02:00
  conditions:
  - condition: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    state: none
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.kitchen_robot_vacuum_last_cleaning_time'')
          | as_datetime).date() != now().date() }}

          '
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      - condition: state
        entity_id: binary_sensor.living_room_media_player
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: numeric_state
        entity_id: input_number.bedroom_blind_position
        above: 1
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.utility_room_presence
        state: 'off'
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          < 20 }}

          '
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: kitchen_cleaning
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.kitchen_robot_vacuum_last_cleaning_time'')
          | as_datetime | as_local).date() < (now().date() - timedelta(days=1)) }}

          '
      - condition: time
        after: '11:30:00'
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: kitchen_cleaning
          started_by: '{{ this.entity_id }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: kitchen_cleaning
      - condition: time
        weekday:
        - mon
        - wed
        - fri
        - sun
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop_low
          timeout: 30
          rooms:
          - Køkken
          - Bryggers
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.kitchen_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: kitchen_cleaning
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop
          timeout: 30
          rooms:
          - Køkken
          - Bryggers
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.kitchen_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768131852214'
  alias: Stue robotstøvsuger docked
  description: Automatic til at kontrollere robotstøvsuger
  triggers:
  - trigger: state
    entity_id: vacuum.living_room_robot_vacuum
    to: docked
  - trigger: state
    entity_id: vacuum.living_room_robot_vacuum
    to: docked
    for:
      seconds: 120
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_status
    to:
    - idle
    - charging
    - charging_complete
  - trigger: state
    entity_id: timer.living_room_robot_vacuum_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: sensor.living_room_robot_vacuum_status
        state:
        - idle
        - charging
        - charging_complete
      - condition: template
        value_template: '{{ (now() - states.input_select.living_room_robot_vacuum_current_cleaning.last_updated).total_seconds()
          > 60 }}

          '
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.living_room_robot_vacuum_timer
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: none
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: trigger
        id: timeout
      sequence:
      - action: script.living_room_robot_vacuum_dock
        metadata: {}
        data: {}
      - delay:
          minutes: 2
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: vacuum.living_room_robot_vacuum
            state: docked
          - condition: state
            entity_id: sensor.living_room_robot_vacuum_status
            state:
            - idle
            - charging
            - charging_complete
        then:
        - action: script.push_notification
          data:
            type: critical
            title: Advarsel
            id: living_room_robot_vacuum_return_to_dock
            persistent: true
            message: Robotstøvsuger kan ikke returnere til docking station
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768136225501'
  alias: Stue robotstøvsuger tøm støvbeholder
  description: Tøm støvbeholder på robotstøvsuger
  triggers:
  - trigger: state
    entity_id:
    - sensor.living_room_robot_vacuum_total_cleaning_time
  - trigger: state
    entity_id: vacuum.living_room_robot_vacuum
    to: docked
  - trigger: state
    entity_id: timer.living_room_robot_vacuum_timer
    to: idle
  - trigger: state
    entity_id: binary_sensor.someone_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_media_player
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_door_sensor_door
    to: 'off'
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          > 10 }}

          '
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: timer.living_room_robot_vacuum_timer
        state: idle
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: none
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_media_player
        state: 'off'
      sequence:
      - action: script.living_room_robot_vacuum_empty_dust_bin
        metadata: {}
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          > 10 }}

          '
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: timer.living_room_robot_vacuum_timer
        state: idle
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: none
      - condition: state
        entity_id: binary_sensor.someone_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'on'
      - condition: state
        entity_id: binary_sensor.living_room_media_player
        state: 'off'
      sequence:
      - action: script.living_room_robot_vacuum_empty_dust_bin
        metadata: {}
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          > 30 }}

          '
      - condition: state
        entity_id: vacuum.living_room_robot_vacuum
        state: docked
      - condition: state
        entity_id: timer.living_room_robot_vacuum_timer
        state: idle
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: none
      sequence:
      - action: script.living_room_robot_vacuum_empty_dust_bin
        metadata: {}
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768143802884'
  alias: Gang robotstøvsuger rengøring
  description: Styring af robotstøvsuger for at gør rent i gangen
  triggers:
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  - trigger: numeric_state
    entity_id: sensor.living_room_robot_vacuum_battery
    above: 30
  - trigger: state
    entity_id: binary_sensor.living_room_media_player
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.someone_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.monique_sleep_window
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.hallway_presence
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_door_long_open
    to: 'on'
  - trigger: time
    at: '12:00:00'
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_time_since_empty_dust_bin
    to: '0'
    for: 00:02:00
  conditions:
  - condition: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    state: none
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.hallway_robot_vacuum_last_cleaning_time'')
          | as_datetime).date() != now().date() }}

          '
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 30
      - condition: state
        entity_id: binary_sensor.living_room_media_player
        state: 'off'
      - condition: state
        entity_id: binary_sensor.someone_sleeping
        state: 'off'
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.hallway_presence
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_long_open
        state: 'on'
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          < 20 }}

          '
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: hallway_cleaning
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.hallway_robot_vacuum_last_cleaning_time'')
          | as_datetime | as_local).date() < (now().date() - timedelta(days=1)) }}

          '
      - condition: time
        after: '12:00:00'
      - condition: state
        entity_id: binary_sensor.living_room_door
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 30
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: hallway_cleaning
          started_by: '{{ this.entity_id }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: hallway_cleaning
      - condition: time
        weekday:
        - mon
        - thu
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop
          timeout: 30
          rooms:
          - Gang
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.hallway_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: hallway_cleaning
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop_low
          timeout: 30
          rooms:
          - Gang
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.hallway_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768144156024'
  alias: Stue robotstøvsuger rengøring
  description: Styring af robotstøvsuger for at gør rent i stuen
  triggers:
  - trigger: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    to: none
  - trigger: numeric_state
    entity_id: sensor.living_room_robot_vacuum_battery
    above: 40
  - trigger: state
    entity_id: binary_sensor.living_room_media_player
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_sleeping
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.monique_sleep_window
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.living_room_door_sensor_door
    to: 'off'
  - trigger: numeric_state
    entity_id: input_number.bedroom_blind_position
    above: 1
  - trigger: time
    at: '12:30:00'
  - trigger: state
    entity_id: sensor.living_room_robot_vacuum_time_since_empty_dust_bin
    to: '0'
    for: 00:02:00
  conditions:
  - condition: state
    entity_id: input_select.living_room_robot_vacuum_current_cleaning
    state: none
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.living_room_robot_vacuum_last_cleaning_time'')
          | as_datetime).date() != now().date() }}

          '
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      - condition: state
        entity_id: binary_sensor.living_room_media_player
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bedroom_sleeping
        state: 'off'
      - condition: numeric_state
        entity_id: input_number.bedroom_blind_position
        above: 1
      - condition: state
        entity_id: binary_sensor.monique_sleep_window
        state: 'off'
      - condition: state
        entity_id: binary_sensor.living_room_door_sensor_door
        state: 'off'
      - condition: template
        value_template: '{{ states(''sensor.living_room_robot_vacuum_time_since_empty_dust_bin'')|int
          < 10 }}

          '
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: living_room_cleaning
          started_by: '{{ this.entity_id }}'
    - conditions:
      - condition: template
        value_template: '{{ (states(''input_datetime.living_room_robot_vacuum_last_cleaning_time'')
          | as_datetime | as_local).date() < (now().date() - timedelta(days=1)) }}

          '
      - condition: time
        after: '11:00:00'
      - condition: numeric_state
        entity_id: sensor.living_room_robot_vacuum_battery
        above: 40
      sequence:
      - action: script.living_room_robot_vacuum_set_current
        data:
          option: living_room_cleaning
          started_by: '{{ this.entity_id }}'
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: living_room_cleaning
      - condition: template
        value_template: "{{ now() >=\n   (states('input_datetime.living_room_robot_vacuum_last_washing_time')
          | as_datetime | as_local + timedelta(hours=82)) }}"
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac_mop_low
          timeout: 45
          rooms:
          - Stue
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.living_room_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.living_room_robot_vacuum_last_washing_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
    - conditions:
      - condition: state
        entity_id: input_select.living_room_robot_vacuum_current_cleaning
        state: living_room_cleaning
      sequence:
      - action: script.living_room_robot_vacuum_start_cleaning
        metadata: {}
        data:
          type: vac
          timeout: 45
          rooms:
          - Stue
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.living_room_robot_vacuum_last_cleaning_time
        data:
          datetime: '{{ (now() | as_local).strftime(''%Y-%m-%d %H:%M:%S'') }}

            '
  mode: queued
  max: 10
  trace:
    stored_traces: 100
- id: '1768156511533'
  alias: Loftrum ventilationsanlæg
  description: Styring af varme genveks ventilationsanlæg
  triggers:
  - trigger: state
    entity_id: sensor.home_target_maximum_temperature
  - trigger: state
    entity_id: sensor.storage_ventilation_desired_level
  - trigger: state
    entity_id: binary_sensor.someone_home
  - trigger: state
    entity_id: binary_sensor.everyone_sleeping
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: climate.storage_ventilation_system_ventilation
      attribute: fan_mode
      state:
      - 'off'
  actions:
  - action: number.set_value
    metadata: {}
    target:
      entity_id: number.storage_ventilation_system_temperature_target
    data:
      value: '{{ states(''sensor.home_target_maximum_temperature'') }}'
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.someone_home
          state: 'off'
        - condition: state
          entity_id: binary_sensor.everyone_sleeping
          state: 'on'
        - condition: state
          entity_id: sensor.storage_ventilation_desired_level
          state: '1'
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: low
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '1'
        target:
          entity_id: select.storage_ventilation_system_fan_level
    - conditions:
      - condition: state
        entity_id: sensor.storage_ventilation_desired_level
        state: '4'
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: high
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '4'
        target:
          entity_id: select.storage_ventilation_system_fan_level
    - conditions:
      - condition: state
        entity_id: sensor.storage_ventilation_desired_level
        state: '3'
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: medium
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '3'
        target:
          entity_id: select.storage_ventilation_system_fan_level
    - conditions:
      - condition: state
        entity_id: sensor.storage_ventilation_desired_level
        state: '2'
      sequence:
      - action: climate.set_fan_mode
        data:
          fan_mode: middle
        target:
          entity_id: climate.storage_ventilation_system_ventilation
      - action: select.select_option
        data:
          option: '2'
        target:
          entity_id: select.storage_ventilation_system_fan_level
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1769101770558'
  alias: Soveværelse dør
  description: Automatik til at styre timer til soveværelse dør
  triggers:
  - trigger: state
    entity_id: binary_sensor.bedroom_door
    to: 'off'
    id: closed
  - trigger: state
    entity_id: binary_sensor.bedroom_door
    to: 'on'
    id: opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: closed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_door_timer
    - conditions:
      - condition: trigger
        id: opened
      sequence:
      - action: timer.start
        target:
          entity_id: timer.bedroom_door_timer
        data:
          duration: 00:02:00
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1769208997346'
  alias: Gang fotorammer
  description: Automatik for at styre fotorammer i gangen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.someone_home
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_door
  - trigger: state
    entity_id:
    - media_player.hallway_photo_frame_joakim
    - media_player.hallway_photo_frame_emil
    - media_player.hallway_photo_frame_charlie
    from: unavailable
    id: Available
  - trigger: homeassistant
    event: start
    id: started
  actions:
  - if:
    - condition: trigger
      id: started
    then:
    - action: androidtv.adb_command
      data:
        command: echo test
      target:
        entity_id:
        - media_player.hallway_photo_frame_joakim
        - media_player.hallway_photo_frame_emil
        - media_player.hallway_photo_frame_charlie
    - delay:
        seconds: 30
  - action: homeassistant.update_entity
    target:
      entity_id:
      - media_player.hallway_photo_frame_joakim
      - media_player.hallway_photo_frame_emil
      - media_player.hallway_photo_frame_charlie
  - delay:
      seconds: 3
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.someone_home
        state: 'off'
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.bedroom_sleeping
          state: 'on'
        - condition: state
          entity_id: binary_sensor.bedroom_door
          state: 'on'
    then:
    - action: media_player.turn_off
      target:
        entity_id:
        - media_player.hallway_photo_frame_charlie
        - media_player.hallway_photo_frame_emil
        - media_player.hallway_photo_frame_joakim
    else:
    - action: media_player.turn_on
      target:
        entity_id:
        - media_player.hallway_photo_frame_charlie
        - media_player.hallway_photo_frame_emil
        - media_player.hallway_photo_frame_joakim
  - delay:
      seconds: 3
  - action: homeassistant.update_entity
    target:
      entity_id:
      - media_player.hallway_photo_frame_joakim
      - media_player.hallway_photo_frame_emil
      - media_player.hallway_photo_frame_charlie
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769257682123'
  alias: Stue medieafspiller
  description: Styring af tilbehør til medie afspilning i Stuen
  triggers:
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to: 'off'
    id: 'off'
    for:
      seconds: 3
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to: idle
    id: waiting
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to:
    - playing
    - buffering
    id: playing
  - trigger: state
    entity_id: sensor.living_room_apple_tv_media_player_safe
    to: paused
    id: paused
  - trigger: state
    entity_id: binary_sensor.someone_home
    from: 'on'
    to: 'off'
    id: no_one_home
  - trigger: state
    entity_id:
    - event.living_room_switch_button_1
    - event.living_room_switch_button_2
    - event.living_room_switch_button_3
    - event.living_room_switch_button_4
    attribute: event_type
    to: long_release
    id: living_room_button_long_press
  - trigger: state
    entity_id: binary_sensor.living_room_media_player
    to: 'off'
    id: media_off
  conditions: []
  actions:
  - variables:
      command: pause
  - choose:
    - conditions:
      - condition: trigger
        id:
        - living_room_button_long_press
        - no_one_home
      sequence:
      - variables:
          command: 'off'
    - conditions:
      - condition: trigger
        id:
        - media_off
      - condition: state
        entity_id: binary_sensor.living_room_light
        state: 'off'
      sequence:
      - variables:
          command: 'off'
    - conditions:
      - condition: trigger
        id:
        - 'off'
      - condition: template
        value_template: '{{ state_attr(''media_player.living_room_apple_tv_media_player'',
          ''source_list'') != none }}'
      sequence:
      - variables:
          command: 'off'
    - conditions:
      - condition: trigger
        id:
        - waiting
        - paused
      sequence:
      - variables:
          command: pause
    - conditions:
      - condition: trigger
        id: playing
      sequence:
      - variables:
          command: playing
  - if:
    - condition: template
      value_template: '{{ command == ''off'' }}'
    then:
    - parallel:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: sensor.living_room_apple_tv_media_player_safe
            state: 'off'
        then:
        - action: media_player.turn_off
          metadata: {}
          target:
            entity_id: media_player.living_room_apple_tv_media_player
          data: {}
      - if:
        - condition: state
          entity_id: light.living_room_light_strip_receiver
          state: 'on'
        then:
        - action: light.turn_off
          data:
            transition: 1
          target:
            entity_id:
            - light.living_room_light_strip_receiver
      - if:
        - condition: state
          entity_id: light.living_room_smart_plug_receiver_accessories
          state: 'on'
        then:
        - action: light.turn_off
          target:
            entity_id: light.living_room_smart_plug_receiver_accessories
      - if:
        - condition: state
          entity_id: media_player.living_room_receiver
          state: 'on'
        then:
        - action: media_player.turn_off
          target:
            entity_id: media_player.living_room_receiver
      - if:
        - condition: state
          entity_id: switch.living_room_tv_sync_box_power
          state: 'on'
        then:
        - action: switch.turn_off
          target:
            entity_id: switch.living_room_tv_sync_box_power
    else:
    - if:
      - condition: state
        entity_id: sensor.living_room_apple_tv_media_player_safe
        state: 'off'
      then:
      - action: media_player.turn_on
        metadata: {}
        target:
          entity_id: media_player.living_room_apple_tv_media_player
        data: {}
      - delay:
          seconds: 30
    - parallel:
      - if:
        - condition: state
          entity_id: light.living_room_light_strip_receiver
          state: 'off'
        then:
        - action: light.turn_on
          metadata: {}
          data:
            transition: 1
            color_temp_kelvin: 2700
            brightness_pct: 100
          target:
            entity_id:
            - light.living_room_light_strip_receiver
      - if:
        - condition: state
          entity_id: light.living_room_smart_plug_receiver_accessories
          state: 'off'
        then:
        - action: light.turn_on
          target:
            entity_id: light.living_room_smart_plug_receiver_accessories
      - if:
        - condition: state
          entity_id: media_player.living_room_receiver
          state: 'off'
        then:
        - action: media_player.turn_on
          target:
            entity_id: media_player.living_room_receiver
        - delay:
            seconds: 3
        - action: media_player.select_source
          target:
            entity_id:
            - media_player.living_room_receiver
          data:
            source: Apple TV
        - action: media_player.select_sound_mode
          target:
            entity_id: media_player.living_room_receiver
          data:
            sound_mode: DOLBY DIGITAL
        - action: media_player.volume_set
          target:
            entity_id: media_player.living_room_receiver
          data:
            volume_level: 0.27
      - if:
        - condition: state
          entity_id: switch.living_room_tv_sync_box_power
          state: 'off'
        then:
        - action: switch.turn_on
          target:
            entity_id: switch.living_room_tv_sync_box_power
    - choose:
      - conditions:
        - condition: template
          value_template: '{{ command == ''playing'' }}'
        sequence:
        - action: huesyncbox.set_sync_state
          data:
            device_id: 1cf95a14183d127c38d2f6af89ed61c5
            power: true
            sync: true
            brightness: 100
            input: input1
            entertainment_area: TV-område
            mode: video
            intensity: moderate
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id:
            - switch.living_room_tv_sync_box_light_sync
      - conditions:
        - condition: template
          value_template: '{{ command == ''pause'' }}'
        sequence:
        - action: huesyncbox.set_sync_state
          data:
            device_id: 1cf95a14183d127c38d2f6af89ed61c5
            sync: false
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1769344314831'
  alias: Bryggers todo tørretumbler
  description: Opret todo opgaver vedrørende tørretumbler
  triggers:
  - trigger: state
    entity_id: input_select.utility_room_dryer_state
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Tøm tørretumbler
      description: Tørretumbleren er færdig, tøm den og læg tøjet på plads
      related_entity_id: input_select.utility_room_dryer_state
      entity_id: todo.todo_smart_todo
      is_active: '{{ is_state(''input_select.utility_room_dryer_state'', ''finished'')
        }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1769363385863'
  alias: Hjem todo Aqara temperatursensor
  description: Kontroller batteri status på Aqara temperatursensorer
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.bathroom_temperature_sensor_battery
    - sensor.patio_temperature_sensor_battery
    - sensor.utility_room_freezer_temperature_sensor_battery
    below: 10
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.bathroom_temperature_sensor_battery
    - sensor.patio_temperature_sensor_battery
    - sensor.utility_room_freezer_temperature_sensor_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:18:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.bathroom_temperature_sensor_battery
        location: oven på spejlskabet
        temperature: '{{ states(''sensor.bathroom_temperature_sensor_temperature'')
          }}'
      - entity_id: sensor.patio_temperature_sensor_battery
        location: på kontakten over sofa
        temperature: '{{ states(''sensor.patio_temperature_sensor_temperature'') }}'
      - entity_id: sensor.utility_room_freezer_temperature_sensor_battery
        location: i kummefryseren
        temperature: '{{ states(''sensor.utility_room_freezer_temperature_sensor_temperature'')
          }}'
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          location: '{{ repeat.item.location | default('''') }}'
          temperature: '{{ repeat.item.temperature | default('''') }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1769364737572'
  alias: Hjem todo Aqara vandsensor
  description: Kontroller batteri status på Aqara vandsensorer
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.kitchen_sink_water_leak_sensor_battery
    - sensor.utility_room_sink_water_leak_sensor_battery
    below: 10
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.kitchen_sink_water_leak_sensor_battery
    - sensor.utility_room_sink_water_leak_sensor_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:19:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.kitchen_sink_water_leak_sensor_battery
        location: under opvaskemaskinen
      - entity_id: sensor.utility_room_sink_water_leak_sensor_battery
        location: under skabet, mellem rør
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          location: '{{ repeat.item.location | default('''') }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1769369132822'
  alias: Køkken todo opvaskemaskine
  description: Opret todo opgaver vedrørende opvaskemaskine
  triggers:
  - trigger: state
    entity_id: sensor.kitchen_dishwasher_safe
    to: program_ended
    id: done
  - trigger: state
    entity_id: sensor.kitchen_dishwasher_safe
    to:
    - waiting_to_start
    - in_use
    - programmed
    id: started
  - trigger: state
    entity_id: binary_sensor.kitchen_dishwasher_notification_active_safe
    id: notification
  - trigger: state
    entity_id: binary_sensor.kitchen_dishwasher_problem_safe
    id: problem
  - trigger: numeric_state
    entity_id: sensor.kitchen_dishwasher_powerdisk_level_safe
    below: 3
  - trigger: numeric_state
    entity_id: sensor.kitchen_dishwasher_powerdisk_level_safe
    above: 80
  - trigger: numeric_state
    entity_id: sensor.kitchen_dishwasher_salt_level_safe
    below: 15
  - trigger: numeric_state
    entity_id: sensor.kitchen_dishwasher_salt_level_safe
    above: 80
  - trigger: numeric_state
    entity_id: sensor.kitchen_dishwasher_rinse_aid_level_safe
    below: 15
  - trigger: numeric_state
    entity_id: sensor.kitchen_dishwasher_rinse_aid_level_safe
    above: 80
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: sensor.kitchen_dishwasher_safe
      state:
      - program_ended
      - waiting_to_start
      - in_use
      - programmed
    then:
    - action: script.create_todo_task
      data:
        subject: Tøm opvaskemaskinen
        description: Opvaskemaskine er færdig, tøm og sæt service væk
        related_entity_id: sensor.kitchen_dishwasher_safe
        entity_id: todo.todo_smart_todo
        is_active: '{{ states(''sensor.kitchen_dishwasher_safe'') == ''program_ended''
          }}'
  - variables:
      supply_tasks:
      - subject: PowerDisk
        entity_id: sensor.kitchen_dishwasher_powerdisk_level_safe
        threshold: 3
      - subject: Salt
        entity_id: sensor.kitchen_dishwasher_salt_level_safe
        threshold: 15
      - subject: Afspændingsmiddel
        entity_id: sensor.kitchen_dishwasher_rinse_aid_level_safe
        threshold: 15
      supply_todos: "{% set ns = namespace(count=0) %} {% for item in supply_tasks
        %}\n  {% if states(item.entity_id) | float(100) < item.threshold | float(10)
        %}\n    {% set ns.count = ns.count + 1 %}\n  {% endif %}\n{% endfor %} {{
        ns.count }}"
  - repeat:
      for_each: '{{ supply_tasks }}'
      sequence:
      - action: script.create_todo_task
        data:
          subject: Fyld {{ repeat.item.subject }} på (opvaskemaskine)
          description: '{{ repeat.item.subject }}-niveauet i opvaskemaskinen er {{
            states(repeat.item.entity_id) | float(100) | round(0) }}%.'
          related_entity_id: '{{ repeat.item.entity_id }}'
          entity_id: todo.todo_smart_todo
          is_active: '{{ states(repeat.item.entity_id) | float(100) < repeat.item.threshold
            | float(10) }}'
  - action: script.create_todo_task
    data:
      subject: Besked fra opvaskemaskinen
      description: Kontroller opvaskemaskinen der er en aktiv notifikation
      related_entity_id: binary_sensor.kitchen_dishwasher_notification_active_safe
      entity_id: todo.todo_smart_todo
      is_active: '{{ is_state(''binary_sensor.kitchen_dishwasher_notification_active_safe'',
        ''on'') and supply_todos | int(0) == 0 }}'
  - action: script.create_todo_task
    data:
      subject: Problem med opvaskemaskinen
      description: Kontroller opvaskemaskinen der er registreret et problem
      related_entity_id: binary_sensor.kitchen_dishwasher_problem_safe
      entity_id: todo.todo_smart_todo
      is_active: '{{ is_state(''binary_sensor.kitchen_dishwasher_problem_safe'', ''on'')
        }}'
  - action: script.create_todo_task
    data:
      subject: Opvaskermaskinens program er fejlet
      description: Opvaskemaskinens program er i fejl status, kontroller opvaske maskinen
      related_entity_id: sensor.kitchen_dishwasher_safe_problem
      entity_id: todo.todo_smart_todo
      is_active: '{{ is_state(''sensor.kitchen_dishwasher_safe'', ''failure'') }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 300
- id: '1769452207183'
  alias: Hjem todo Yale lås
  description: Kontroller batteri status på Yale låse
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.entrance_lock_battery
    - sensor.utility_room_lock_battery
    - sensor.garage_lock_battery
    - sensor.patio_lock_battery
    - sensor.patio_keypad_battery
    below: 15
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.entrance_lock_battery
    - sensor.utility_room_lock_battery
    - sensor.garage_lock_battery
    - sensor.patio_lock_battery
    - sensor.patio_keypad_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:21:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.entrance_lock_battery
        battery_type: 4 × AA
      - entity_id: sensor.utility_room_lock_battery
        battery_type: 4 × AA
      - entity_id: sensor.garage_lock_battery
        battery_type: 4 × AA
      - entity_id: sensor.patio_lock_battery
        battery_type: 2 × AAA
      - entity_id: sensor.patio_keypad_battery
        battery_type: 4 × AAA
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
          type: '{{ repeat.item.battery_type | default('''') }}'
          threshold: 15
  mode: restart
  trace:
    stored_traces: 30
- id: '1769704796507'
  alias: Hjem todo Haozee Jordfugtighedssensor
  description: Kontroller batteri status på aozee Jordfugtighedssensor
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_soil_moisture_sensor_battery
    - sensor.bedroom_soil_moisture_sensor_battery
    - sensor.charlies_room_soil_moisture_sensor_battery
    below: 10
    for:
      minutes: 3
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_soil_moisture_sensor_battery
    - sensor.bedroom_soil_moisture_sensor_battery
    - sensor.charlies_room_soil_moisture_sensor_battery
    above: 70
    for:
      minutes: 3
  - trigger: time
    at: 03:22:00
  conditions: []
  actions:
  - variables:
      sensors:
      - entity_id: sensor.living_room_soil_moisture_sensor_battery
      - entity_id: sensor.bedroom_soil_moisture_sensor_battery
      - entity_id: sensor.charlies_room_soil_moisture_sensor_battery
  - repeat:
      for_each: '{{ sensors }}'
      sequence:
      - action: script.create_todo_battery_task
        data:
          entity_id: '{{ repeat.item.entity_id }}'
  mode: restart
  trace:
    stored_traces: 30
- id: '1769854798414'
  alias: Stue dør
  description: Automatik til at styre timer til stue dør
  triggers:
  - trigger: state
    entity_id: binary_sensor.living_room_door
    to: 'off'
    id: closed
  - trigger: state
    entity_id: binary_sensor.living_room_door
    to: 'on'
    id: opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: closed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.living_room_door_timer
    - conditions:
      - condition: trigger
        id: opened
      sequence:
      - action: timer.start
        target:
          entity_id: timer.living_room_door_timer
        data:
          duration: 00:02:00
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1769856473538'
  alias: Soveværelse medieafstiller sæt status
  description: Automatik til at sætte status helper for medie i soveværelset
  triggers:
  - trigger: state
    entity_id: sensor.bedroom_apple_tv_media_player_safe
    to: playing
    id: started
  - trigger: state
    entity_id: sensor.bedroom_apple_tv_media_player_safe
    to:
    - buffering
    - idle
    - paused
    id: ended
  - trigger: state
    entity_id: sensor.bedroom_apple_tv_media_player_safe
    to: 'off'
    id: 'off'
    for:
      seconds: 3
  - trigger: state
    entity_id: timer.bedroom_media_player_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: binary_sensor.someone_home
    to: 'off'
    id: away
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.bedroom_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.bedroom_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.bedroom_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - timeout
      - condition: state
        entity_id: sensor.bedroom_apple_tv_media_player_safe
        state:
        - idle
        - paused
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.bedroom_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - away
        - 'off'
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_media_player_timer
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.bedroom_media_player
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769856539505'
  alias: Emils værelse medieafstiller sæt status
  description: Automatik til at sætte status helper for medie på Emils værelse
  triggers:
  - trigger: state
    entity_id: sensor.emils_room_apple_tv_media_player_safe
    to: playing
    id: started
  - trigger: state
    entity_id: sensor.emils_room_apple_tv_media_player_safe
    to:
    - buffering
    - idle
    - paused
    id: ended
  - trigger: state
    entity_id: sensor.emils_room_apple_tv_media_player_safe
    to: 'off'
    id: 'off'
    for:
      seconds: 3
  - trigger: state
    entity_id: timer.emils_room_media_player_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: binary_sensor.emil_home
    to: 'off'
    id: away
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.emils_room_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.emils_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.emils_room_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.emils_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - timeout
      - condition: state
        entity_id: sensor.charlies_room_apple_tv_media_player_safe
        state:
        - idle
        - paused
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.emils_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - away
        - 'off'
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.emils_room_media_player_timer
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.emils_room_media_player
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769856579014'
  alias: Charlies værelse medieafstiller sæt status
  description: Automatik til at sætte status helper for medie på Charlies værelse
  triggers:
  - trigger: state
    entity_id: sensor.charlies_room_apple_tv_media_player_safe
    to: playing
    id: started
  - trigger: state
    entity_id: sensor.charlies_room_apple_tv_media_player_safe
    to:
    - buffering
    - idle
    - paused
    id: ended
  - trigger: state
    entity_id: sensor.charlies_room_apple_tv_media_player_safe
    to: 'off'
    id: 'off'
    for:
      seconds: 3
  - trigger: state
    entity_id: timer.charlies_room_media_player_timer
    to: idle
    id: timeout
  - trigger: state
    entity_id: binary_sensor.charlie_home
    to: 'off'
    id: away
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - started
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.charlies_room_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.charlies_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - ended
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.charlies_room_media_player_timer
      - action: input_boolean.turn_on
        metadata: {}
        target:
          entity_id: input_boolean.charlies_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - timeout
      - condition: state
        entity_id: sensor.charlies_room_apple_tv_media_player_safe
        state:
        - idle
        - paused
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.charlies_room_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - away
        - 'off'
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.charlies_room_media_player_timer
      - action: input_boolean.turn_off
        metadata: {}
        target:
          entity_id: input_boolean.charlies_room_media_player
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769871939427'
  alias: Køkken tilstedeværelsessensor
  description: Automatik til at styre køkken tilstedeværelsessensor
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_presence_sensor_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_presence_sensor_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - target:
          entity_id: input_datetime.kitchen_presence_sensor_start
        data:
          datetime: '{{ now() }}'
        action: input_datetime.set_datetime
      - action: timer.cancel
        target:
          entity_id: timer.kitchen_presence_sensor_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - target:
          entity_id: input_number.kitchen_presence_sensor_seconds
        data:
          value: '{% set start = states(''input_datetime.kitchen_presence_sensor_start'')
            | as_datetime | as_local %} {% set seconds = states(''input_number.kitchen_presence_sensor_seconds'')
            | float(0.0) %} {% set duration = (as_timestamp(now()) - as_timestamp(start))
            | round(1) %} {{ seconds + duration }}'
        action: input_number.set_value
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.kitchen_presence_sensor_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769872044331'
  alias: Gang tilstedeværelsessensor
  description: Automatik til at styre gang tilstedeværelsessensor
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.hallway_presence_sensor_occupancy
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.hallway_presence_sensor_occupancy
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.hallway_presence_sensor_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.hallway_presence_sensor_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769872343999'
  alias: Bryggers bevægelsessensor
  description: Håndtering af bevægelsessensoren i bryggerset
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.utility_room_motion_sensor_motion
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.utility_room_motion_sensor_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:02:00
        target:
          entity_id: timer.utility_room_motion_sensor_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769872488563'
  alias: Toilet bevægelsessensor
  description: Håndtering af bevægelsessensoren på toilettet
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.toilet_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.toilet_motion_sensor_motion
    from: 'on'
    to: 'off'
    id: cleared
  - trigger: state
    entity_id:
    - timer.toilet_motion_sensor_timer
    to: idle
    id: timeout
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.toilet_motion_sensor_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:02:00
        target:
          entity_id: timer.toilet_motion_sensor_timer
    - conditions:
      - condition: trigger
        id:
        - timeout
      sequence:
      - action: counter.increment
        target:
          entity_id: counter.toilet_motion_sensor_count
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769872582999'
  alias: Entre bevægelsessensor
  description: Håndtering af bevægelsessensoren i entreen
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.entrance_motion_sensor_motion
    from: 'off'
    to: 'on'
    id: detected
  - trigger: state
    entity_id:
    - binary_sensor.entrance_motion_sensor_motion
    from: 'on'
    to: 'off'
    id: cleared
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detected
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.entrance_motion_sensor_timer
    - conditions:
      - condition: trigger
        id:
        - cleared
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:03:00
        target:
          entity_id: timer.entrance_motion_sensor_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1769930000823'
  alias: Emils værelse medieafspiller
  description: Styring af tilbehør til medie afspilning på Emils værelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.emils_room_media_player
    to: 'off'
    id: 'off'
  - trigger: state
    entity_id: binary_sensor.emil_home
    to: 'off'
    id: not_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - not_home
      sequence:
      - action: media_player.turn_off
        metadata: {}
        target:
          entity_id: media_player.emils_room_apple_tv_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - 'off'
      - condition: state
        entity_id: binary_sensor.emils_room_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.emils_room_blind
        state: 'off'
      sequence:
      - action: media_player.turn_off
        metadata: {}
        target:
          entity_id: media_player.emils_room_apple_tv_media_player
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1769931237193'
  alias: Charlies værelse medieafspiller
  description: Styring af tilbehør til medie afspilning på Charlies værelse
  triggers:
  - trigger: state
    entity_id: binary_sensor.charlies_room_media_player
    to: 'off'
    id: 'off'
  - trigger: state
    entity_id: binary_sensor.charlie_home
    to: 'off'
    id: not_home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - not_home
      sequence:
      - action: media_player.turn_off
        metadata: {}
        target:
          entity_id: media_player.charlies_room_apple_tv_media_player
        data: {}
    - conditions:
      - condition: trigger
        id:
        - 'off'
      - condition: state
        entity_id: binary_sensor.charlies_room_light
        state: 'off'
      - condition: state
        entity_id: binary_sensor.charlies_room_blind
        state: 'off'
      sequence:
      - action: media_player.turn_off
        metadata: {}
        target:
          entity_id: media_player.charlies_room_apple_tv_media_player
        data: {}
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1770064791859'
  alias: Hjem todo periodevis
  description: Opret opgave der er styret at tid, f.eks. månedlige
  triggers:
  - trigger: time
    at: 05:00:00
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ now().day == 1 }}'
    then:
    - action: script.create_todo_task
      data:
        subject: Organisér kvitteringer
        description: Tøm punge og spid i køkkenet for kvitteringer, og sortér dem
          i mappen.
        entity_id: todo.todo_smart_todo
  - if:
    - condition: template
      value_template: '{{ now().day == 1 }}'
    then:
    - action: script.create_todo_task
      data:
        subject: Afstem budgetkonto
        description: Træk posteringer fra banken for budgetkontoen, og afstem dem
          med posterne i budget-regnearket. Ret eventuelle afvigelser.
        entity_id: todo.todo_smart_todo
  mode: restart
  trace:
    stored_traces: 30
- id: '1770229021068'
  alias: Charlies værelse rullegardin
  description: Automatik for rullegardin på Charlies værelse
  triggers:
  - trigger: device
    device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_short_press
    subtype: open
    id: open_short_pressed
  - trigger: device
    device_id: 937baa924ab8fff3bfbd80513dde21d2
    domain: zha
    type: remote_button_short_press
    subtype: close
    id: close_short_pressed
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    to: 'on'
    id: charlie_home
  - trigger: state
    entity_id:
    - binary_sensor.charlie_home
    to: 'off'
    id: charlie_leaving
  - trigger: time
    at:
    - '12:00:00'
    id: noon
  - trigger: time
    at: input_datetime.charlie_bedtime_alarm
    id: bedtime
  - trigger: time
    at:
      entity_id: input_datetime.charlie_wake_up_alarm
      offset: 01:00:00
    id: wake_up
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    to: 'off'
    id: dark_outside
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    to: 'on'
    id: light_outside
  - trigger: state
    entity_id:
    - binary_sensor.charlies_room_window
    to: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.charlies_room_window
    to: 'on'
    id: window_opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_short_pressed
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 0
    - conditions:
      - condition: state
        entity_id: binary_sensor.house_sitter_home
        state: 'on'
      sequence: []
    - conditions:
      - condition: trigger
        id:
        - charlie_leaving
        - charlie_home
        - noon
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - light_outside
      - condition: template
        value_template: '{% set n = now() %}

          {% set w = states(''input_datetime.charlie_wake_up_alarm'') | as_datetime
          | as_local + timedelta(hours=1) %}

          {{ n.date() == w.date() and n.time() >= w.time() }}'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - dark_outside
        - charlie_leaving
        - charlie_home
        - bedtime
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.charlies_room_blind_position
        data:
          value: 0
  - variables:
      position: '{{ states(''input_number.charlies_room_blind_position'') | int(0)
        }}'
  - if:
    - condition: state
      entity_id: binary_sensor.charlies_room_window
      state: 'on'
    - condition: template
      value_template: "{{ not(trigger.id == 'close_short_pressed'\n   and (state_attr('cover.charlies_room_blind','current_position')
        | float(999)) <= 20) }}\n"
    then:
    - variables:
        position: '{{ [position | int, 20] | max }}'
  - wait_template: '{{ states(''cover.charlies_room_blind'') not in [''opening'',
      ''closing''] }}

      '
    timeout: 00:00:30
    continue_on_timeout: true
  - action: system_log.write
    data:
      level: debug
      message: 'Trigger: {{ trigger.id }}

        Current position: {{ state_attr(''cover.charlies_room_blind'', ''current_position'')
        }}

        Desired position: {{ states(''input_number.charlies_room_blind_position'')
        }}

        New position: {{ position }}'
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_long_pressed
        - close_long_pressed
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) == 100 }}'
      - condition: numeric_state
        entity_id: cover.charlies_room_blind
        attribute: current_position
        below: 100
      sequence:
      - action: cover.open_cover
        target:
          entity_id: cover.charlies_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) == 0 }}'
      - condition: numeric_state
        entity_id: cover.charlies_room_blind
        attribute: current_position
        above: 0
      sequence:
      - action: cover.close_cover
        target:
          entity_id: cover.charlies_room_blind
    - conditions:
      - condition: template
        value_template: '{{ state_attr(''cover.charlies_room_blind'', ''current_position'')
          | int(0) != position | int(0) }}'
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ position }}'
        target:
          entity_id: cover.charlies_room_blind
  - wait_template: '{{ states(''cover.charlies_room_blind'') not in [''opening'',
      ''closing''] }}

      '
    timeout: 00:00:30
    continue_on_timeout: true
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1770235218775'
  alias: Soveværelse rullegardin
  description: Automatik for rullegardin på soveværelse
  triggers:
  - device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_short_press
    subtype: open
    trigger: device
    id: open_short_pressed
  - trigger: device
    device_id: 8421d7ed40291054dc9c1406bbf716fe
    domain: zha
    type: remote_button_short_press
    subtype: close
    id: close_short_pressed
  - trigger: state
    entity_id: event.bedroom_switch_button_2
    attribute: event_type
    to: initial_press
    id: button_2
  - trigger: state
    entity_id: event.bedroom_switch_button_3
    attribute: event_type
    to: initial_press
    id: button_3
  - trigger: time
    at: input_datetime.monique_wake_up_alarm
    id: wake_up
  - trigger: state
    entity_id: timer.bedroom_blind_timer
    from: active
    to: idle
    id: wake_up_delay
  - trigger: state
    entity_id: binary_sensor.parent_home
    to: 'on'
    id: parent_home
  - trigger: state
    entity_id: binary_sensor.parent_home
    to: 'off'
    id: parent_leave
  - trigger: state
    entity_id: binary_sensor.home_outside_light
    to: 'off'
    id: dark_outside
  - trigger: state
    entity_id: binary_sensor.home_outside_light
    to: 'on'
    id: light_outside
  - trigger: state
    entity_id: binary_sensor.bedroom_sun_overheat
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.bedroom_sun_overheat
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_window
    to: 'off'
  - trigger: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
  - trigger: state
    entity_id: fan.bedroom_air_purifier_fan
    to: 'off'
  - trigger: state
    entity_id: fan.bedroom_air_purifier_fan
    to: 'on'
  - trigger: event
    event_type: bedroom_blind
    event_data:
      command: open
    id: open_event
  - trigger: event
    event_type: bedroom_blind
    event_data:
      command: close
    id: close_event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_short_pressed
        - button_2
        - open_event
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.bedroom_blind_timer
      - action: input_number.set_value
        target:
          entity_id: input_number.bedroom_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
        - button_3
        - close_event
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.bedroom_blind_timer
      - action: input_number.set_value
        target:
          entity_id: input_number.bedroom_blind_position
        data:
          value: 0
    - conditions:
      - condition: state
        entity_id: binary_sensor.house_sitter_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      sequence:
      - action: timer.pause
        target:
          entity_id: timer.bedroom_blind_timer
    - conditions:
      - condition: trigger
        id:
        - wake_up
      - condition: state
        entity_id: binary_sensor.monique_home
        state: 'on'
      sequence:
      - action: timer.start
        data:
          duration: 00:05:00
        target:
          entity_id: timer.bedroom_blind_timer
    - conditions:
      - condition: trigger
        id:
        - wake_up_delay
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.bedroom_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - parent_home
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.bedroom_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - dark_outside
        - parent_leave
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.bedroom_blind_position
        data:
          value: 0
    - conditions:
      - condition: trigger
        id:
        - light_outside
        - parent_leave
      - condition: state
        entity_id: binary_sensor.parent_home
        state: 'off'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.bedroom_blind_position
        data:
          value: 100
  - wait_template: '{{ states(''cover.bedroom_blind'') not in [''opening'', ''closing'']
      }}'
    timeout: 00:00:30
    continue_on_timeout: true
  - variables:
      position: '{{ states(''input_number.bedroom_blind_position'') | int(0) }}'
  - if:
    - condition: state
      entity_id: binary_sensor.bedroom_window
      state: 'on'
    - condition: template
      value_template: "{{ not(trigger.id in ['close_short_pressed','button_3']\n   and
        (state_attr('cover.bedroom_blind','current_position') | float(999)) <= 20)
        }}\n"
    then:
    - variables:
        position: '{{ [position | int, 20] | max }}'
  - if:
    - condition: state
      entity_id: binary_sensor.bedroom_sun_overheat
      state: 'on'
    - condition: template
      value_template: "{{ not(trigger.id in ['open_short_pressed','button_2','open_event']\n
        \  and (state_attr('cover.bedroom_blind','current_position') | float(999))
        >= 50) }}\n"
    then:
    - variables:
        position: '{{ [position | int, 50] | min }}'
  - if:
    - condition: state
      entity_id: fan.bedroom_air_purifier_fan
      state: 'on'
    - condition: template
      value_template: "{{ not(trigger.id in ['close_short_pressed','button_3','close_event']\n
        \  and (state_attr('cover.bedroom_blind','current_position') | float(999))
        <= 60) }}\n"
    then:
    - variables:
        position: '{{ [position | int, 60] | max }}'
  - action: system_log.write
    data:
      level: debug
      message: 'Trigger: {{ trigger.id }}

        Current position: {{ state_attr(''cover.bedroom_blind'', ''current_position'')
        }}

        Desired position: {{ states(''input_number.bedroom_blind_position'') }}

        New position: {{ position }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) == 100 }}'
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        below: 100
      sequence:
      - action: cover.open_cover
        target:
          entity_id: cover.bedroom_blind
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) == 0 }}'
      - condition: numeric_state
        entity_id: cover.bedroom_blind
        attribute: current_position
        above: 0
      sequence:
      - action: cover.close_cover
        target:
          entity_id: cover.bedroom_blind
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) != state_attr(''cover.bedroom_blind'',
          ''current_position'') }}'
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ position | int(0) }}'
        target:
          entity_id: cover.bedroom_blind
  - wait_template: '{{ states(''cover.bedroom_blind'') not in [''opening'', ''closing'']
      }}'
    timeout: 00:00:30
    continue_on_timeout: true
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1770236661641'
  alias: Emils værelse rullegardin
  description: Automatik for rullegardin på Emils værelse
  triggers:
  - device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_short_press
    subtype: open
    trigger: device
    id: open_short_pressed
  - trigger: device
    device_id: 1dd2442d9e607d9f290aebbb666cef43
    domain: zha
    type: remote_button_short_press
    subtype: close
    id: close_short_pressed
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'on'
    to: 'off'
    id: emil_leaving
  - trigger: state
    entity_id:
    - binary_sensor.emil_home
    from: 'off'
    to: 'on'
    id: emil_home
  - trigger: time
    at:
    - '12:00:00'
    id: noon
  - trigger: time
    at: input_datetime.emil_bedtime_alarm
    id: bedtime
  - trigger: time
    at:
      entity_id: input_datetime.emil_wake_up_alarm
      offset: 01:00:00
    id: wake_up
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'on'
    to: 'off'
    id: dark_outside
  - trigger: state
    entity_id:
    - binary_sensor.home_outside_light
    from: 'off'
    to: 'on'
    id: light_outside
  - trigger: state
    entity_id:
    - binary_sensor.emils_room_window_sensor_door
    from: 'on'
    to: 'off'
    id: window_closed
  - trigger: state
    entity_id:
    - binary_sensor.emils_room_window_sensor_door
    from: 'off'
    to: 'on'
    id: window_opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_short_pressed
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - close_short_pressed
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 0
    - conditions:
      - condition: trigger
        id:
        - emil_leaving
        - light_outside
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - emil_leaving
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'off'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 0
    - conditions:
      - condition: trigger
        id:
        - emil_home
        - noon
        - wake_up
      - condition: state
        entity_id: binary_sensor.emil_home
        state: 'on'
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 40
    - conditions:
      - condition: trigger
        id:
        - emil_home
        - noon
        - wake_up
      - condition: state
        entity_id: binary_sensor.home_outside_light
        state: 'on'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 100
    - conditions:
      - condition: trigger
        id:
        - emil_home
        - dark_outside
        - bedtime
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.emils_room_blind_position
        data:
          value: 0
  - variables:
      position: '{{ states(''input_number.emils_room_blind_position'') }}'
  - if:
    - condition: state
      entity_id: binary_sensor.emils_room_window
      state: 'on'
    - condition: template
      value_template: "{{ not(trigger.id == 'close_short_pressed'\n   and (state_attr('cover.emils_room_blind','current_position')
        | float(999)) <= 20) }}\n"
    then:
    - variables:
        position: '{{ [position | int, 20] | max }}'
  - wait_template: '{{ states(''cover.emils_room_blind'') not in [''opening'', ''closing'']
      }}

      '
    timeout: 00:00:30
    continue_on_timeout: true
  - action: system_log.write
    data:
      level: debug
      message: 'Trigger: {{ trigger.id }}

        Current position: {{ state_attr(''cover.emils_room_blind'', ''current_position'')
        }}

        Desired position: {{ states(''input_number.emils_room_blind_position'') }}

        New position: {{ position }}'
  - choose:
    - conditions:
      - condition: trigger
        id:
        - open_long_pressed
        - close_long_pressed
      sequence: []
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) == 100 }}'
      - condition: numeric_state
        entity_id: cover.emils_room_blind
        attribute: current_position
        below: 100
      sequence:
      - action: cover.open_cover
        target:
          entity_id: cover.emils_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) == 0 }}'
      - condition: numeric_state
        entity_id: cover.emils_room_blind
        attribute: current_position
        above: 0
      sequence:
      - action: cover.close_cover
        target:
          entity_id: cover.emils_room_blind
    - conditions:
      - condition: template
        value_template: '{{ position | int(0) != state_attr(''cover.emils_room_blind'',
          ''current_position'') | int(0) }}'
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ position | int(0) }}'
        target:
          entity_id: cover.emils_room_blind
  - wait_template: '{{ states(''cover.emils_room_blind'') not in [''opening'', ''closing'']
      }}

      '
    timeout: 00:00:30
    continue_on_timeout: true
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1770311389520'
  alias: Todo strømpriser
  description: Overvåg om strømpriser er tilgængelige og valide
  triggers:
  - trigger: time_pattern
    hours: /1
    minutes: 1
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.energy_data_service'') in [''unknown'',
          ''unavailable'', ''none'', ''''] }}'
      sequence:
      - action: script.push_notification
        data:
          type: info
          recipient: anders
          persistent: true
          title: Strømpriser er ikke tilgængelig
          message: Priser fra sensor.energy_data_service er ikke valide
    - conditions:
      - condition: template
        value_template: '{{ state_attr(''sensor.energy_data_service'', ''raw_today'')
          is none }}'
      sequence:
      - action: script.push_notification
        data:
          type: info
          recipient: anders
          persistent: true
          title: Detaljeret strøm pris mangler
          message: Attributen raw_today fra sensor.energy_data_service mangler
  mode: restart
  trace:
    stored_traces: 50
- id: '1770323072575'
  alias: Køkken todo køleskab
  description: Opret todo opgaver vedrørende køleskab
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_fridge_filter_status
    id: status_changed
  - trigger: event
    event_type: todo_item_completed
    event_data:
      related: binary_sensor.kitchen_fridge_filter_status
    id: todo_completed
  - trigger: state
    entity_id: binary_sensor.kitchen_fridge_fridge_door
    to: 'on'
    for:
      seconds: 180
    id: fridge_door_open
  - trigger: state
    entity_id: binary_sensor.kitchen_fridge_freezer_door
    to: 'on'
    for:
      seconds: 60
    id: freezer_door_open
  - trigger: numeric_state
    entity_id: sensor.kitchen_fridge_fridge_temperature
    above: 6
    id: fridge_to_warm
  - trigger: numeric_state
    entity_id: sensor.kitchen_fridge_freezer_temperature
    above: -17
    id: freezer_to_warm
  - trigger: time_pattern
    hours: /1
    id: periodic
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: status_changed
      sequence:
      - action: script.create_todo_task
        data:
          subject: Skift køleskabsfilter
          description: Skift vandfilteret til køleskabet, det er pladseret under bryggersvasken.
          related_entity_id: binary_sensor.kitchen_fridge_filter_status
          entity_id: todo.todo_smart_todo
          is_active: '{{ is_state(''binary_sensor.kitchen_fridge_filter_status'',
            ''on'') }}'
    - conditions:
      - condition: trigger
        id: todo_completed
      sequence:
      - action: button.press
        metadata: {}
        target:
          entity_id: button.kitchen_fridge_reset_water_filter
        data: {}
    - conditions:
      - condition: trigger
        id: fridge_door_open
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          id: kitchen_fridge_door_open
          persistent: false
          recipient: home
          message: Døren på køleskabet i køkkenet har været åben længe
    - conditions:
      - condition: trigger
        id: freezer_door_open
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          id: kitchen_freezer_door_open
          persistent: false
          recipient: home
          message: Døren på fryseren i køkkenet har været åben længe
    - conditions:
      - condition: trigger
        id: fridge_to_warm
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          id: kitchen_fridge_temperature
          persistent: false
          recipient: home
          message: Køleskabet i køkkenet er for varmt, temperaturen er {{ states('sensor.kitchen_fridge_fridge_temperature')
            | round(1) }} °C, skal være under 6 °C
    - conditions:
      - condition: trigger
        id: freezer_to_warm
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          id: kitchen_freezer_temperature
          persistent: false
          recipient: home
          message: Fryseren i køkkenet er for varmt, temperaturen er {{ states('sensor.kitchen_fridge_freezer_temperature')
            | round(1) }} °C, skal være under -17 °C
    - conditions:
      - condition: trigger
        id: periodic
      sequence:
      - action: script.create_todo_task
        data:
          subject: Indstil temperatur på køleskabet i køkkenet
          entity_id: todo.todo_smart_todo
          description: Køleskabet i køkkenets temperaturen er {{ states('sensor.kitchen_fridge_fridge_temperature')
            | round(1) }} °C, bør være 3 °C
          related_entity_id: sensor.kitchen_fridge_fridge_temperature
          is_active: '{{ not (2 <= (states(''sensor.kitchen_fridge_fridge_temperature'')
            | float(0)) <= 5) }}'
      - action: script.create_todo_task
        data:
          subject: Indstil temperatur på fryseren i køkkenet
          entity_id: todo.todo_smart_todo
          description: Fryseren i køkkenets temperaturen er {{ states('sensor.kitchen_fridge_freezer_temperature')
            | round(1) }} °C, bør være -18 °C
          related_entity_id: sensor.kitchen_fridge_freezer_temperature
          is_active: '{{ not (-22 <= (states(''sensor.kitchen_fridge_freezer_temperature'')
            | float(0)) <= -17) }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770324301195'
  alias: Todo monitor afsluttede
  description: Send event når et item bliver completed
  triggers:
  - trigger: state
    entity_id: todo.todo_smart_todo
  conditions: []
  actions:
  - variables:
      completed: "{% set new = trigger.to_state.attributes.all_todos | default([])
        | selectattr('status', 'eq', 'completed') | list %}\n{% set old = trigger.from_state.attributes.all_todos
        | default([]) | selectattr('status', 'eq', 'completed') | map(attribute='todo_id')
        | list %}\n{% set completed = new | rejectattr('todo_id', 'in', old) | list
        %} \n{% set ns = namespace(result=[]) %} \n{% for item in completed %}\n  {%
        set related = none %}\n  {% if 'Relateret:' in item.description %}\n    {%
        set related = item.description.split('Relateret:')[1].strip() %}\n  {% endif
        %}\n\n  {% set ns.result = ns.result + [{\n    \"subject\": item.subject,\n
        \   \"todo_id\": item.todo_id,\n    \"related\": related\n   }] %}\n{% endfor
        %} {{ ns.result | to_json }}"
  - repeat:
      count: '{{ completed | trim | from_json | length }}'
      sequence:
      - variables:
          item: '{{ (completed | trim | from_json)[repeat.index - 1] }}'
      - event: todo_item_completed
        event_data:
          subject: '{{ item.subject }}'
          todo_id: '{{ item.todo_id }}'
          related: '{{ item.related }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1770410133642'
  alias: Bryggers dør
  description: Automatik til at styre timer til bryggers dør
  triggers:
  - trigger: state
    entity_id: binary_sensor.utility_room_door
    to: 'off'
    id: closed
  - trigger: state
    entity_id: binary_sensor.utility_room_door
    to: 'on'
    id: opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: closed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.utility_room_door_timer
    - conditions:
      - condition: trigger
        id: opened
      sequence:
      - action: timer.start
        target:
          entity_id: timer.utility_room_door_timer
        data:
          duration: 00:00:15
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1770410173949'
  alias: Terrasse dør
  description: Automatik til at styre timer til terrasse dør
  triggers:
  - trigger: state
    entity_id: binary_sensor.patio_door
    to: 'off'
    id: closed
  - trigger: state
    entity_id: binary_sensor.patio_door
    to: 'on'
    id: opened
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: closed
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.patio_door_timer
    - conditions:
      - condition: trigger
        id: opened
      sequence:
      - action: timer.start
        target:
          entity_id: timer.patio_door_timer
        data:
          duration: 00:00:15
  mode: queued
  max: 10
  trace:
    stored_traces: 50
- id: '1770459627394'
  alias: Todo køkken affald filter
  description: Opret todo opgaver vedrørende skift af biofilter på affald
  triggers:
  - trigger: time
    at: input_datetime.kitchen_trash_biofilter_next_change
    id: deadline
  - at: 03:51:00
    id: periodic
    trigger: time
  - trigger: event
    event_type: todo_item_completed
    event_data:
      related: input_datetime.kitchen_trash_biofilter_next_change
    id: todo_completed
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - deadline
        - periodic
      sequence:
      - action: script.create_todo_task
        data:
          subject: Skift biofilter på affald i køkken
          description: Skift biofilter på rest og mad affaldsspande i køkkenet, i
            skabet ved siden af vasken.
          related_entity_id: input_datetime.kitchen_trash_biofilter_next_change
          entity_id: todo.todo_smart_todo
          is_active: '{{ states(''input_datetime.kitchen_trash_biofilter_next_change'')
            | as_datetime | as_local < now() }}'
    - conditions:
      - condition: trigger
        id: todo_completed
      sequence:
      - action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.kitchen_trash_biofilter_next_change
        data:
          datetime: '{{ (now() + timedelta(days=120)).strftime(''%Y-%m-%d %H:%M:%S'')
            }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770464713887'
  alias: Toilet todo
  description: Opret todo opgaver vedrørende sæbe og duft påfyldning på toilet
  triggers:
  - entity_id: counter.toilet_motion_sensor_count
    id: counter_changed
    trigger: state
  - trigger: event
    event_type: todo_item_completed
    event_data:
      related: input_number.toilet_freshener_last_count
    id: freshener_completed
  - trigger: event
    event_type: todo_item_completed
    event_data:
      related: input_number.toilet_soap_last_count
    id: soap_completed
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: counter_changed
      sequence:
      - action: script.create_todo_task
        data:
          subject: Tilføj WC-duft på toilettet
          description: Indsæt en ny WC-duftpind i gæste-toilettet.
          related_entity_id: input_number.toilet_freshener_last_count
          entity_id: todo.todo_smart_todo
          is_active: '{{ states(''counter.toilet_motion_sensor_count'') | int(0) >
            states(''input_number.toilet_freshener_last_count'') | int(0) + 400 }}'
      - action: script.create_todo_task
        data:
          subject: Fyld sæbe på dispenser på toilettet
          description: Hæld mere sæbe på sæbedispenser på gæste-toilettet.
          related_entity_id: input_number.toilet_soap_last_count
          entity_id: todo.todo_smart_todo
          is_active: '{{ states(''counter.toilet_motion_sensor_count'') | int(0) >
            states(''input_number.toilet_soap_last_count'') | int(0) + 500 }}'
    - conditions:
      - condition: trigger
        id: freshener_completed
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.toilet_freshener_last_count
        data:
          value: '{{ states(''counter.toilet_motion_sensor_count'') | int(0) }}'
    - conditions:
      - condition: trigger
        id: soap_completed
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.toilet_soap_last_count
        data:
          value: '{{ states(''counter.toilet_motion_sensor_count'') | int(0) }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770473789903'
  alias: Hjem overvåg enheder
  description: Overvåg alle enheder og sikre de er tilgængelige
  triggers:
  - event: start
    trigger: homeassistant
    id: started
  - trigger: state
    entity_id: timer.home_monitor_entities_timer
    from: active
    to: idle
  - at: '16:00:00'
    trigger: time
  conditions: []
  actions:
  - if:
    - condition: trigger
      id: started
    then:
    - action: timer.start
      target:
        entity_id: timer.home_monitor_entities_timer
      data:
        duration:
          minutes: 5
    else:
    - action: timer.cancel
      target:
        entity_id: timer.home_monitor_entities_timer
    - variables:
        exclude_entities:
        - light.living_room_smart_plug_christmas_elf_house
        - light.charlies_room_light_bed_lamp
        - light.charlies_room_light_dresser
        - sensor.living_room_printer_black_bk
        - sensor.living_room_printer_black_pgbk
        - sensor.living_room_printer_cyan
        - sensor.living_room_printer_magenta
        - sensor.living_room_printer_photo_blue
        - sensor.living_room_printer_yellow
        entities: "{% set unavailable = states \n  | rejectattr('domain','in',['button','event','update'])\n
          \ | selectattr('state','eq','unavailable')\n  | map(attribute='entity_id')\n
          \ | list %}\n\n{% set unknown = states \n  | selectattr('domain','in',['media_player','sensor','binary_sensor','climate','cover','lock'])\n
          \ | selectattr('state','eq','unknown') \n  | map(attribute='entity_id')\n
          \ | list %}\n\n{% set entities = (unavailable + unknown)\n  | reject('in',
          exclude_entities)\n  | unique\n  | list %}\n\n{{ entities | to_json }}"
        message: "{% set ns = namespace(result={}) %}\n{% for e in entities | trim
          | from_json %}\n  {% set dev_id = device_id(e) if device_id(e) else '[NO_DEVICE]'
          %}\n\n  {% if dev_id not in ns.result %}\n    {% if dev_id == '[NO_DEVICE]'
          %}\n      {% set dev_name = '[NO_DEVICE]' %}\n      {% set dev_area_name
          = '' %}\n    {% else %}\n      {% set dev_name = device_attr(dev_id, 'name_by_user')\n
          \       if device_attr(dev_id, 'name_by_user')\n        else device_attr(dev_id,
          'name') %}\n      {% set dev_area_name = area_name(device_attr(dev_id, 'area_id'))
          %}\n    {% endif %}\n\n    {% set ns.result = dict(ns.result, **{\n      dev_id:
          {\n        \"device_id\": dev_id,\n        \"name\": dev_name,\n        \"area\":
          dev_area_name,\n        \"entities\": []\n      }\n    }) %}\n  {% endif
          %}\n\n  {% set ent_obj = {\n    \"entity_id\": e,\n    \"friendly_name\":
          state_attr(e,'friendly_name'),\n    \"state\": states(e),\n    \"last_changed\":
          states[e].last_changed.isoformat()\n  } %}\n\n  {% set ns.result = dict(ns.result,
          **{\n    dev_id: dict(ns.result[dev_id], **{\n      \"entities\": ns.result[dev_id][\"entities\"]
          + [ent_obj]\n    })\n  }) %}\n{% endfor %}\n{% set devices = ns.result.values()
          | list %}\ncount_devices: {{ devices | count }} count_entities: {{ entities
          | count }} devices: {% for dev in devices %}\n  - device_id: \"{{ dev.device_id
          }}\"\n    name: \"{{ dev.name }}\"\n    area: \"{{ dev.area }}\"\n    entities:\n{%
          for ent in dev.entities %}\n      - entity_id: \"{{ ent.entity_id }}\"\n
          \       friendly_name: \"{{ ent.friendly_name }}\"\n        state: \"{{
          ent.state }}\"\n        last_changed: \"{{ ent.last_changed }}\"\n{% endfor
          %} {% endfor %}"
    - if:
      - condition: template
        value_template: '{{ entities | trim | from_json | length > 0}}'
      then:
      - action: system_log.write
        data:
          level: warning
          message: '{{ exclude_entities }} {{ exclude_entities is iterable }} {{ exclude_entities
            | count }} {{ message }} x: {{ entities }}'
      - action: script.push_notification
        data:
          type: info
          recipient: anders
          persistent: true
          id: home_assistant_monitor_unavailable_entities
          title: '{{ entities | trim | from_json | length }} sensorer er ikke tilgængelige
            i HomeAssistant'
          message: '{{ message }}'
  mode: single
  trace:
    stored_traces: 50
- id: '1770505461525'
  alias: Indkørsel billader
  description: Disable entities på billader
  triggers:
  - trigger: state
    entity_id: sensor.driveway_ev_charger_status_description_safe
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.driveway_ev_charger_status_description_safe
        state:
        - Locked
        - Locked, car connected
        - Ready
        - unavailable
      sequence:
      - action: homeassistant.disable_entity
        data:
          entity_id:
          - switch.driveway_ev_charger_pause
    default:
    - action: homeassistant.enable_entity
      data:
        entity_id:
        - switch.driveway_ev_charger_pause
  mode: single
  trace:
    stored_traces: 100
- id: '1770507087346'
  alias: Køkken opvaskemaskine
  description: Disable entities på opvaskemaskine
  triggers:
  - trigger: state
    entity_id: binary_sensor.kitchen_dishwasher_switch_safe
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.kitchen_dishwasher_switch_safe
        state: 'on'
      sequence:
      - action: homeassistant.enable_entity
        data:
          entity_id:
          - sensor.kitchen_dishwasher_energy_consumption
          - sensor.kitchen_dishwasher_energy_forecast
          - sensor.kitchen_dishwasher_water_consumption
          - sensor.kitchen_dishwasher_water_forecast
          - sensor.kitchen_dishwasher_remaining_time
          - sensor.kitchen_dishwasher_elapsed_time
          - sensor.kitchen_dishwasher_start_in
          - sensor.kitchen_dishwasher_finish
          - sensor.kitchen_dishwasher_start
    default:
    - action: homeassistant.disable_entity
      data:
        entity_id:
        - sensor.kitchen_dishwasher_energy_consumption
        - sensor.kitchen_dishwasher_energy_forecast
        - sensor.kitchen_dishwasher_water_consumption
        - sensor.kitchen_dishwasher_water_forecast
        - sensor.kitchen_dishwasher_remaining_time
        - sensor.kitchen_dishwasher_elapsed_time
        - sensor.kitchen_dishwasher_start_in
        - sensor.kitchen_dishwasher_finish
        - sensor.kitchen_dishwasher_start
  mode: single
  trace:
    stored_traces: 30
- id: '1770535740851'
  alias: Bryggers todo fryser
  description: Overvåg fryser i bryggerset, send beskeder hvis der opstår fejl
  triggers:
  - trigger: numeric_state
    entity_id: sensor.utility_room_freezer_temperature_sensor_temperature
    above: -17
    id: freezer_to_warm
  - trigger: time_pattern
    hours: /1
    id: periodic
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: freezer_to_warm
      sequence:
      - action: script.push_notification
        data:
          type: critical
          title: Advarsel
          id: utility_room_freezer_temperature
          persistent: false
          recipient: home
          message: Fryseren i bryggerset er for varmt, temperaturen er {{ states('sensor.utility_room_freezer_temperature_sensor_temperature')
            | round(1) }} °C, skal være under -17 °C
    - conditions:
      - condition: trigger
        id: periodic
      sequence:
      - action: script.create_todo_task
        data:
          subject: Indstil temperatur på fryseren i bryggerset
          entity_id: todo.todo_smart_todo
          description: Fryseren i bryggersets temperaturen er {{ states('sensor.utility_room_freezer_temperature_sensor_temperature')
            | round(1) }} °C, bør være -18 °C
          related_entity_id: sensor.utility_room_freezer_temperature_sensor_temperature
          is_active: '{{ not (-22 <= (states(''sensor.utility_room_freezer_temperature_sensor_temperature'')
            | float(0)) <= -17) }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770546802021'
  alias: Loftrum lys
  description: Automatik til at styre lys i loftrummet
  triggers:
  - trigger: state
    entity_id: binary_sensor.storage_door_sensor_door
    to: 'on'
    id: opened
  - trigger: state
    entity_id: binary_sensor.storage_door_sensor_door
    to: 'off'
    id: closed
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: opened
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.storage_light_1
          - light.storage_light_2
        data:
          transition: 1
          brightness_pct: 100
          color_temp_kelvin: 3000
    - conditions:
      - condition: trigger
        id: closed
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.storage_light_1
          - light.storage_light_2
        data:
          transition: 1
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770548858082'
  alias: Køkken køleskab
  description: Styring af power booster på køleskab i køkkenet
  triggers:
  - trigger: template
    value_template: '{{ states(''sensor.kitchen_fridge_fridge_temperature'') | round(0)
      >= states(''number.kitchen_fridge_fridge_temperature'') | float(3) | round(0)
      + 2 }}'
    id: fridge_start_boost
  - trigger: template
    value_template: '{{ states(''sensor.kitchen_fridge_fridge_temperature'') | round(0)
      < states(''number.kitchen_fridge_fridge_temperature'') | float(3) | round(0)
      + 2 }}'
    id: fridge_end_boost
  - trigger: template
    value_template: '{{ states(''sensor.kitchen_fridge_freezer_temperature'') | round(0)
      >= states(''number.kitchen_fridge_freezer_temperature'') | float(18) | round(0)
      + 2 }}'
    id: freezer_start_boost
  - trigger: template
    value_template: '{{ states(''sensor.kitchen_fridge_freezer_temperature'') | round(0)
      < states(''number.kitchen_fridge_freezer_temperature'') | float(18) | round(0)
      + 2 }}'
    id: freezer_end_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: fridge_start_boost
      sequence:
      - action: switch.turn_on
        target:
          entity_id:
          - switch.kitchen_fridge_power_cool
    - conditions:
      - condition: trigger
        id: fridge_end_boost
      sequence:
      - action: switch.turn_off
        target:
          entity_id:
          - switch.kitchen_fridge_power_cool
    - conditions:
      - condition: trigger
        id: freezer_start_boost
      sequence:
      - action: switch.turn_on
        target:
          entity_id:
          - switch.kitchen_fridge_power_freeze
    - conditions:
      - condition: trigger
        id: freezer_end_boost
      sequence:
      - action: switch.turn_off
        target:
          entity_id:
          - switch.kitchen_fridge_power_freeze
  mode: single
- id: '1770568204317'
  alias: Stue TV
  description: Disable entities på TV
  triggers:
  - trigger: state
    entity_id: media_player.living_room_tv_bravia_media_player
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.living_room_tv_bravia_media_player
        state: 'off'
      sequence:
      - action: homeassistant.disable_entity
        data:
          entity_id:
          - media_player.living_room_tv_dlna_media_player
          - media_player.living_room_tv_cast_media_player
          - media_player.living_room_android_tv_media_player
          - remote.living_room_android_tv_remote
    default:
    - action: homeassistant.enable_entity
      data:
        entity_id:
        - media_player.living_room_tv_dlna_media_player
        - media_player.living_room_tv_cast_media_player
        - media_player.living_room_android_tv_media_player
        - remote.living_room_android_tv_remote
  mode: single
  trace:
    stored_traces: 10
- id: '1770581923900'
  alias: Hjem todo Tado
  description: Kontroller batteri status på Tado enheder
  triggers:
  - trigger: time
    at: 03:20:00
  conditions: []
  actions:
  - action: rest_command.tado_get_access_token
    data:
      refresh_token: '{{ states(''input_text.tado_refresh_token'') }}'
    response_variable: response
  - if:
    - condition: template
      value_template: '{{ response.status != 200 }}'
    then:
    - action: script.push_notification
      data:
        type: warning
        recipient: anders
        persistent: true
        id: rest_command.tado_get_access_token
        title: 'Fejl ved get access token fra Tado - Status: {{ response.status }}'
        message: '{{ response }}'
    - stop: Fejl fra get_access_token fra tado
  - variables:
      access_token: '{{ response.content.access_token }}'
      refresh_token: '{{ response.content.refresh_token }}'
  - if:
    - condition: template
      value_template: '{{ refresh_token == '''' or access_token == '''' }}'
    then:
    - action: system_log.write
      data:
        level: debug
        message: 'Response: {{ response }}

          '
    - stop: Ingen token fra get_access_token fra Tado
  - action: input_text.set_value
    target:
      entity_id: input_text.tado_refresh_token
    data:
      value: '{{ refresh_token }}'
  - action: rest_command.tado_get_profile
    data:
      bearer_token: '{{ access_token }}'
    response_variable: response
  - action: system_log.write
    data:
      level: debug
      message: 'Response: {{ response }}

        '
  - variables:
      home_id: '{{ response.content.homes[0].id }}'
  - action: rest_command.tado_get_rooms_and_devices
    data:
      home_id: '{{ home_id }}'
      bearer_token: '{{ access_token }}'
    response_variable: response
  - action: system_log.write
    data:
      level: debug
      message: 'Response: {{ response }}

        '
  - variables:
      devices: "[\n  {% for room in response.content.rooms %}\n    {% for device in
        room.devices %}\n      {\n        \"roomName\": \"{{ room.roomName }}\",\n
        \       \"deviceSerialNo\": \"{{ device.serialNumber }}\",\n        \"batteryState\":
        \"{{ device.batteryState }}\",\n        \"mountingState\": \"{{ device.mountingState
        | default('') }}\",\n        \"type\": \"{{ state_attr('sensor.tado_device_types',
        'types').get(device.type, device.type) }}\",\n        \"location\": \"{{ state_attr('sensor.tado_device_locations',
        'locations').get(device.serialNumber, device.serialNumber) }}\",\n        \"entity_id\":
        \"{{ state_attr('sensor.tado_device_ids', 'ids').get(device.serialNumber,
        device.serialNumber) }}\",\n        \"battery\": \"{{ state_attr('sensor.tado_device_batterys',
        'batterys').get(device.type, device.type) }}\",\n      }{% if not loop.last
        %}, {% endif %}\n    {% endfor %}\n  {% if not loop.last %}, {% endif %}\n
        \ {% endfor %}\n]"
  - repeat:
      count: '{{ devices | length }}'
      sequence:
      - action: system_log.write
        metadata: {}
        data:
          level: debug
          message: '{{ devices[repeat.index - 1] }}'
      - action: script.create_todo_task
        data:
          subject: Skift batteri på {{ devices[repeat.index - 1].type }} i {{ devices[repeat.index
            - 1].roomName }}{{ '' if not devices[repeat.index - 1].location else '
            (' ~ devices[repeat.index - 1].location ~ ')'}}
          description: 'Skift batteri på Tado {{ devices[repeat.index - 1].type }}
            med serie no {{ devices[repeat.index - 1].deviceSerialNo }}, der er pladseret
            {{ devices[repeat.index - 1].roomName }}{{ '''' if not devices[repeat.index
            - 1].location else '' ('' ~ devices[repeat.index - 1].location ~ '')''}},
            batteri status er {{ devices[repeat.index - 1].batteryState }}. Batteri:
            {{ devices[repeat.index - 1].battery }}'
          related_entity_id: '{{ devices[repeat.index - 1].entity_id }}'
          entity_id: todo.todo_smart_todo
          is_active: '{{ devices[repeat.index - 1].batteryState != ''NORMAL'' }}'
      - action: script.create_todo_task
        data:
          subject: Monter {{ devices[repeat.index - 1].type }} korrekt i {{ devices[repeat.index
            - 1].roomName }}{{ '' if not devices[repeat.index - 1].location else '
            (' ~ devices[repeat.index - 1].location ~ ')'}}
          description: Monter og kalibrer Tado {{ devices[repeat.index - 1].type }}
            med serie no {{ devices[repeat.index - 1].deviceSerialNo }}, der er pladseret
            {{ devices[repeat.index - 1].roomName }}{{ '' if not devices[repeat.index
            - 1].location else ' (' ~ devices[repeat.index - 1].location ~ ')'}},
            monteringsstatus er {{ devices[repeat.index - 1].mountingState }}.
          related_entity_id: '{{ devices[repeat.index - 1].entity_id }}_mount'
          entity_id: todo.todo_smart_todo
          is_active: '{{ (devices[repeat.index - 1].mountingState | default(''''))
            not in ['''', ''CALIBRATED''] }}'
  mode: restart
- id: '1770917834825'
  alias: Drivhus todo temperatur
  description: Overvåg temperaturen i drivhuset
  triggers:
  - trigger: numeric_state
    entity_id: sensor.greenhouse_current_temperature
    below: -1
  - trigger: numeric_state
    entity_id: sensor.greenhouse_heating_smart_plug_power
    below: 5
  - trigger: time
    at: 02:00:00
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Tænd varmen i drivhuset
      description: '"Temperaturen i drivhuset er {{ states(''sensor.greenhouse_current_temperature'')
        }}, tænd for varme blæseren."'
      entity_id: todo.todo_smart_todo
      related_entity_id: sensor.greenhouse_current_temperature
      is_active: "{{ states('sensor.greenhouse_current_temperature') | float(10.0)
        < -1.0 and\n   states('sensor.greenhouse_heating_smart_plug_power') | float(0.0)
        < 5.0 }}"
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770918254782'
  alias: Garage todo temperatur
  description: Overvåg temperaturen i garagen
  triggers:
  - trigger: numeric_state
    entity_id: sensor.garage_avarage_temperature_24h
    below: 2
  - trigger: time
    at: 02:01:00
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Der er frost i garagen
      description: Temperaturen i garagen er {{ states('sensor.garage_current_temperature')
        }}°C. Gennemsnittet over de sidste 24 timer er {{ states('sensor.garage_avarage_temperature_24h')
        }}°C. Overvej om sodavand eller andet skal ind.
      entity_id: todo.todo_smart_todo
      related_entity_id: sensor.garage_avarage_temperature_24h
      is_active: '{{ states(''sensor.garage_avarage_temperature_24h'') | float(10.0)
        < 2.0 }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770918500447'
  alias: Teknik todo temperatur
  description: Overvåg temperaturen i teknik rummet
  triggers:
  - trigger: numeric_state
    entity_id: sensor.technic_room_current_temperature
    below: 10
  - trigger: numeric_state
    entity_id: sensor.technic_room_current_temperature
    above: 30
  - trigger: time
    at: 01:00:00
  - trigger: time
    at: '13:00:00'
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Der er {% if states('sensor.technic_room_current_temperature') | float
        <= 20 -%} koldt {%- else -%} varmt {%- endif %} i teknik rummet
      description: Temperaturen i teknik rummet er  {{ states('sensor.technic_room_current_temperature')
        }} °C, kontroller om døren er lukket eller der er et andet problem.
      entity_id: todo.todo_smart_todo
      related_entity_id: sensor.technic_room_current_temperature
      is_active: '{{ not (10.0 <= states(''sensor.technic_room_current_temperature'')
        | float(20.0) <= 30.0) }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770922045690'
  alias: Hjem overvåg automation triggers
  description: Overvåg automations som trigger for meget inden for 24 timer
  triggers:
  - at: '16:00:00'
    trigger: time
  conditions: []
  actions:
  - action: sql.query
    data:
      query: "SELECT\n  json_extract(ed.shared_data, '$.entity_id') AS automation_id,\n
        \ COUNT(*) AS trigger_count\nFROM events e\nJOIN event_types et\n  ON e.event_type_id
        = et.event_type_id\nJOIN event_data ed\n  ON e.data_id = ed.data_id\nWHERE
        et.event_type = 'automation_triggered'\n  AND e.time_fired_ts > strftime('%s','now','-24
        hours')\nGROUP BY automation_id\nORDER BY trigger_count DESC;\n"
    response_variable: sql_result
  - variables:
      default_limit: 100
      custom_limits:
        automation.utility_room_motion_sensor: 1000
        automation.utility_room_light: 200
        automation.hallway_light: 200
        automation.hallway_presence_sensor: 200
        automation.living_room_heat_pump: 200
        automation.driveway_light_house_south: 200
        automation.driveway_light: 200
        automation.kitchen_presence_sensor: 200
        automation.driveway_motion_sensor_entrance: 200
        automation.toilet_motion_sensor: 200
        automation.driveway_motion_sensor_house_south: 200
        automation.garden_motion_sensor_house_east: 200
        automation.entrance_light: 150
        automation.living_room_media_player_set_status: 150
      offenders: "{% set res = sql_result.result if sql_result is defined else []
        %}  {% set ns = namespace(offenders=[]) %} {% for row in res %}\n  {% set
        automation_id = row.automation_id %}\n  {% set count = row.trigger_count |
        int %}\n  {% set limit = custom_limits.get(automation_id, default_limit) |
        int %}\n  {% if count > limit %}\n    {% set ns.offenders = ns.offenders +
        [dict(row, limit=limit)] %}\n  {% endif %}\n{% endfor %} {{ ns.offenders }}\n"
      message: "count: {{ offenders | count }} automations: {% for row in offenders
        %}\n  - automation_id: \"{{ row.automation_id }}\"\n    trigger_count: {{
        row.trigger_count }}\n    limit: {{ row.limit }}\n{% endfor %}"
  - if:
    - condition: template
      value_template: '{{ offenders | length > 0 }}'
    then:
    - action: system_log.write
      data:
        level: warning
        message: 'Automations over trigger limit: {{ message }}'
    - action: script.push_notification
      data:
        type: warning
        recipient: anders
        persistent: true
        id: home_assistant_monitor_automation_trigger_spam
        title: '{{ offenders | length }} automations trigger for meget (24 timer)'
        message: '{{ message }}'
  mode: single
  trace:
    stored_traces: 50
- id: '1770987477517'
  alias: Hjem overvåg system
  description: Overvåg Home Assistant systemet
  triggers:
  - entity_id: sensor.technic_room_system_monitor_swap_usage
    above: 10
    for:
      minutes: 2
    id: high_swap_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_swap_usage
    above: 30
    id: critical_swap_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_processor_temperature
    above: 65
    for:
      minutes: 2
    id: high_cpu_temperature
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_processor_temperature
    above: 75
    id: critical_cpu_temperature
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_processor_use
    above: 70
    for:
      seconds: 60
    id: high_cpu_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_processor_use
    above: 90
    id: critical_cpu_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_memory_usage
    above: 85
    for:
      minutes: 2
    id: high_ram_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_memory_usage
    above: 92
    id: critical_ram_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_disk_usage
    above: 80
    for:
      minutes: 5
    id: high_disk_usage
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_disk_usage
    above: 90
    id: critical_disk_usage
    trigger: numeric_state
  - at:
      entity_id: sensor.technic_room_system_monitor_last_boot
      offset: 00:05:00
    id: system_booted
    trigger: time
  - entity_id: sensor.technic_room_system_monitor_load_1_min
    above: 4
    for:
      minutes: 2
    id: high_load_1
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_load_1_min
    above: 6
    id: critical_load_1
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_load_5_min
    above: 4
    for:
      minutes: 5
    id: high_load_5
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_load_5_min
    above: 6
    id: critical_load_5
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_load_15_min
    above: 4
    for:
      minutes: 10
    id: high_load_15
    trigger: numeric_state
  - entity_id: sensor.technic_room_system_monitor_load_15_min
    above: 6
    id: critical_load_15
    trigger: numeric_state
  conditions: []
  actions:
  - variables:
      title: ''
      message: ''
      entity_id: '{{ trigger.entity_id | default('''') }}'
      trigger_id: '{{ trigger.id | default('''') }}'
      entity_state: '{{ states(entity_id) if entity_id else ''N/A'' }}'
      notification_type: warning
  - choose:
    - conditions:
      - condition: trigger
        id: high_swap_usage
      sequence:
      - variables:
          title: 'Home Assistant: Højt swap-forbrug'
          message: 'Swap-forbrug er for højt (over 10% i mindst 2 minutter). Aktuel
            værdi: {{ entity_state }}% Grænse: 10%

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_swap_usage
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk swap-forbrug'
          message: 'Swap-forbrug er kritisk højt. Aktuel værdi: {{ entity_state }}%
            Grænse: 30%

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: high_cpu_temperature
      sequence:
      - variables:
          title: 'Home Assistant: Høj CPU temperatur'
          message: 'CPU temperaturen er for høj (over 65°C i mindst 2 minutter). Aktuel
            værdi: {{ entity_state }}°C Grænse: 65°C

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_cpu_temperature
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk CPU temperatur'
          message: 'CPU temperaturen er kritisk høj. Aktuel værdi: {{ entity_state
            }}°C Grænse: 75°C

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: high_cpu_usage
      sequence:
      - variables:
          title: 'Home Assistant: Højt CPU forbrug'
          message: 'CPU forbrug har været højt i mindst 60 sekunder. Aktuel værdi:
            {{ entity_state }}% Grænse: 70%

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_cpu_usage
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk CPU forbrug'
          message: 'CPU forbrug er kritisk højt. Aktuel værdi: {{ entity_state }}%
            Grænse: 90%

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: high_ram_usage
      sequence:
      - variables:
          title: 'Home Assistant: Højt RAM forbrug'
          message: 'RAM forbrug er for højt (over 85% i mindst 2 minutter). Aktuel
            værdi: {{ entity_state }}% Grænse: 85%

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_ram_usage
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk RAM forbrug'
          message: 'RAM forbrug er kritisk højt. Aktuel værdi: {{ entity_state }}%
            Grænse: 92%

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: high_disk_usage
      sequence:
      - variables:
          title: 'Home Assistant: Højt diskforbrug'
          message: 'Diskforbrug er for højt (over 80% i mindst 5 minutter). Aktuel
            værdi: {{ entity_state }}% Grænse: 80%

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_disk_usage
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk diskforbrug'
          message: 'Diskforbrug er kritisk højt. Aktuel værdi: {{ entity_state }}%
            Grænse: 90%

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: system_booted
      sequence:
      - variables:
          title: 'Home Assistant: System genstartet'
          message: 'Home Assistant er blevet genstartet for et øjeblik siden. Sidste
            genstart: {{ states(''sensor.technic_room_system_monitor_last_boot'')
            | as_datetime | as_local }}

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: high_load_1
      sequence:
      - variables:
          title: 'Home Assistant: Høj load (1 min)'
          message: 'System belastning (1 minut) er for høj (over 4.0 i mindst 2 minutter).
            Aktuel værdi: {{ entity_state }} Grænse: 4.0

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_load_1
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk load (1 min)'
          message: 'System belastning (1 minut) er kritisk høj. Aktuel værdi: {{ entity_state
            }} Grænse: 6.0

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: high_load_5
      sequence:
      - variables:
          title: 'Home Assistant: Høj load (5 min)'
          message: 'System belastning (5 minutter) er for høj (over 4.0 i mindst 5
            minutter). Aktuel værdi: {{ entity_state }} Grænse: 4.0

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_load_5
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk load (5 min)'
          message: 'System belastning (5 minutter) er kritisk høj. Aktuel værdi: {{
            entity_state }} Grænse: 6.0

            '
          notification_type: critical
    - conditions:
      - condition: trigger
        id: high_load_15
      sequence:
      - variables:
          title: 'Home Assistant: Høj load (15 min)'
          message: 'System belastning (15 minutter) er for høj (over 4.0 i mindst
            10 minutter). Aktuel værdi: {{ entity_state }} Grænse: 4.0

            '
          notification_type: warning
    - conditions:
      - condition: trigger
        id: critical_load_15
      sequence:
      - variables:
          title: 'Home Assistant: Kritisk load (15 min)'
          message: 'System belastning (15 minutter) er kritisk høj. Aktuel værdi:
            {{ entity_state }} Grænse: 6.0

            '
          notification_type: critical
    default:
    - variables:
        title: 'Home Assistant: System alarm'
        message: 'En ukendt trigger blev aktiveret. Trigger ID: {{ trigger_id }} Entity:
          {{ entity_id }} Aktuel værdi: {{ entity_state }}

          '
        notification_type: critical
  - if:
    - condition: template
      value_template: '{{ title != '''' }}'
    then:
    - data:
        level: warning
        message: '{{ title }} - {{ message }} Entity: {{ entity_id }}, Trigger: {{
          trigger_id | default('''') }}

          '
      action: system_log.write
    - data:
        type: '{{ notification_type }}'
        recipient: anders
        persistent: true
        id: '{{ entity_id }}'
        title: '{{ title }}'
        message: '{{ message }}'
      action: script.push_notification
  mode: single
  trace:
    stored_traces: 50
- id: '1770991959858'
  alias: Hjem todo vanding indendørs
  description: Opret todo opgaver vedrørende jordfugtighed måler og vanding af blomster
    indendørs
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.bedroom_soil_moisture_sensor_moisture
    - sensor.charlies_room_soil_moisture_sensor_moisture
    - sensor.living_room_soil_moisture_sensor_moisture
    below: 40
    for:
      seconds: 180
  - trigger: numeric_state
    entity_id:
    - sensor.living_room_soil_moisture_sensor_moisture
    - sensor.bedroom_soil_moisture_sensor_moisture
    - sensor.charlies_room_soil_moisture_sensor_moisture
    above: 60
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Vand blomster indendørs
      description: 'Jordfugtigheden på potteplanter er ved at være lav. I stuen er
        målt {{ states(''sensor.living_room_soil_moisture_sensor_moisture'') | float(0)
        | round(0) }}%, I soveværelset er målt {{ states(''sensor.bedroom_soil_moisture_sensor_moisture'')
        | float(0) | round(0) }}%, og på Charlies værelse er målt {{ states(''sensor.charlies_room_soil_moisture_sensor_moisture'')
        | float(0) | round(0) }}%

        '
      related_entity_id: sensor.living_room_soil_moisture_sensor_moisture
      entity_id: todo.todo_smart_todo
      is_active: "{{ states('sensor.living_room_soil_moisture_sensor_moisture') |
        float(50.0) < 40.0 or\n   states('sensor.bedroom_soil_moisture_sensor_moisture')
        | float(50.0) < 40.0 or\n   states('sensor.charlies_room_soil_moisture_sensor_moisture')
        | float(50.0) < 40.0 }}"
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770993693621'
  alias: Bryggers todo vand
  description: Overvåg om der er vand under vasken bryggerset, send beskeder hvis
    der opstår lækage
  triggers:
  - trigger: state
    entity_id: binary_sensor.utility_room_sink_water_leak_sensor
    to: 'on'
    for:
      seconds: 30
    id: leak
  - trigger: state
    entity_id: binary_sensor.utility_room_sink_water_leak_sensor
    to: 'off'
    for:
      seconds: 30
  - trigger: time_pattern
    hours: /1
  conditions: []
  actions:
  - if:
    - condition: trigger
      id: leak
    then:
    - action: script.push_notification
      data:
        type: warning
        title: Advarsel
        id: utility_room_sink_water_leak
        persistent: false
        recipient: home
        message: Vand lækage sensoren der ligger under skabet med vasken i bryggerst
          har registret vand.
  - action: script.create_todo_task
    data:
      subject: Vand på gulvet under bryggersvasken
      entity_id: todo.todo_smart_todo
      description: Vand lækage sensoren der ligger under skabet med vasken i bryggerst
        har registret vand.
      related_entity_id: binary_sensor.utility_room_sink_water_leak_sensor
      is_active: '{{ is_state(''binary_sensor.utility_room_sink_water_leak_sensor'',
        ''on'') }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1770996223230'
  alias: Køkken todo vand
  description: Overvåg om der er vand under vasken i køkkenet, send beskeder hvis
    der opstår lækage
  triggers:
  - trigger: state
    entity_id: binary_sensor.kitchen_sink_water_leak_sensor
    to: 'on'
    for:
      seconds: 30
    id: leak
  - trigger: state
    entity_id: binary_sensor.kitchen_sink_water_leak_sensor
    to: 'off'
    for:
      seconds: 30
  - trigger: time_pattern
    hours: /1
  conditions: []
  actions:
  - if:
    - condition: trigger
      id: leak
    then:
    - action: script.push_notification
      data:
        type: warning
        title: Advarsel
        id: kitchen_sink_water_leak
        persistent: false
        recipient: home
        message: Vand lækage sensoren der ligger under opvaskemaskinen ved vasken
          i køkkenet har registret vand.
  - action: script.create_todo_task
    data:
      subject: Vand på gulvet under køkkenvasken
      entity_id: todo.todo_smart_todo
      description: Vand lækage sensoren der ligger under opvaskemaskinen ved vasken
        i køkkenet har registret vand.
      related_entity_id: binary_sensor.kitchen_sink_water_leak_sensor
      is_active: '{{ is_state(''binary_sensor.kitchen_sink_water_leak_sensor'', ''on'')
        }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1771052556655'
  alias: Hjem overvåg ikke brugt automation
  description: Overvåg automations som ikke har trigget inden for cutoff (default
    7 dage med undtagelser
  triggers:
  - at: '16:00:00'
    trigger: time
  conditions: []
  actions:
  - variables:
      default_days: 7
      custom_days:
        automation.home_meter_reading_electricity: 32
        automation.home_meter_reading_water: 32
        automation.monitor_data_folder: 32
        automation.emils_room_blind_stop: 9999
        automation.charlies_room_blind_stop: 9999
        automation.living_room_blind_stop: 9999
        automation.garage_3d_printer: 9999
        automation.driveway_todo_mailbox: 9999
        automation.kitchen_fridge: 9999
        automation.living_room_tv: 9999
        automation.home_monitor_system: 9999
      offenders: "{% set ns = namespace(offenders=[]) %}\n{% for a in states.automation
        | list %}\n  {% set days = custom_days.get(a.entity_id, default_days) | int
        %}\n  {% set cutoff = now() - timedelta(days=days) %}\n  {% set last = state_attr(a.entity_id,
        'last_triggered') %}\n\n  {% if last is none %}\n    {% set ns.offenders =
        ns.offenders + [dict(\n      automation_id=a.entity_id,\n      friendly_name=a.name,\n
        \     last_triggered='never',\n      days_since=999999,\n      cutoff_days=days\n
        \   )] %}\n  {% else %}\n    {% set last_dt = as_datetime(last) %}\n    {%
        set age_days = ((now() - last_dt).total_seconds() / 86400) %}\n\n    {% if
        last_dt < cutoff %}\n      {% set ns.offenders = ns.offenders + [dict(\n        automation_id=a.entity_id,\n
        \       friendly_name=a.name,\n        last_triggered=(last_dt | as_local).isoformat(),\n
        \       days_since=age_days | round(1),\n        cutoff_days=days\n      )]
        %}\n    {% endif %}\n  {% endif %}\n{% endfor %}\n{{ (ns.offenders | sort(attribute='days_since',
        reverse=true) | list) | to_json }}\n"
      offenders_obj: '{{ offenders | trim | from_json }}'
      message: "count: {{ offenders_obj | count }} automations:\n{% for row in offenders_obj
        %}\n  - automation_id: \"{{ row.automation_id }}\"\n    friendly_name: \"{{
        row.friendly_name }}\"\n    last_triggered: \"{{ row.last_triggered }}\"\n
        \   days_since: {{ row.days_since }}\n    cutoff_days: {{ row.cutoff_days
        }}\n{% endfor %}"
  - if:
    - condition: template
      value_template: '{{ offenders_obj | length > 0 }}'
    then:
    - action: system_log.write
      data:
        level: warning
        message: 'Automations ikke kørt indenfor cutoff: {{ message }}'
    - action: script.push_notification
      data:
        type: info
        recipient: anders
        persistent: true
        id: home_assistant_monitor_automation_not_triggered
        title: '{{ offenders_obj | length }} automations har ikke kørt for nyligt'
        message: '{{ message }}'
  mode: single
  trace:
    stored_traces: 50
- id: '1771090096437'
  alias: Emils værelse todo blæser
  description: Opret todo opgaver vedrørende blæser på Emils værelse
  triggers:
  - trigger: numeric_state
    entity_id: sensor.emils_room_air_purifier_filter_life_percentage
    below: 5
    id: low
  - trigger: time
    at: 03:57:00
    id: periodic
  - trigger: event
    event_type: todo_item_completed
    event_data:
      related: sensor.emils_room_air_purifier_filter_life_percentage
    id: todo_completed
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - low
        - periodic
      sequence:
      - action: script.create_todo_task
        data:
          subject: Skift filter på blæser på Emil værelse
          description: Luftrenser på Emils værelse skal have skiftet filter, der er
            {{ states('sensor.emils_room_air_purifier_filter_life_percentage') }}%
            tilbage.
          related_entity_id: sensor.emils_room_air_purifier_filter_life_percentage
          entity_id: todo.todo_smart_todo
          is_active: '{{ states(''sensor.emils_room_air_purifier_filter_life_percentage'')
            | int(100) < 5 }}'
    - conditions:
      - condition: trigger
        id: todo_completed
      sequence:
      - action: button.press
        target:
          entity_id: button.emils_room_air_purifier_reset_filter_life
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1771090242421'
  alias: Soveværelse todo blæser
  description: Opret todo opgaver vedrørende blæser på soveværelse
  triggers:
  - trigger: numeric_state
    entity_id: sensor.bedroom_air_purifier_filter_life
    below: 5
  - trigger: time
    at: 03:58:00
  conditions: []
  actions:
  - action: script.create_todo_task
    data:
      subject: Skift filter på blæser i soveværelset
      description: Luftrenser på soveværelset skal have skiftet filter, der er {{
        states('sensor.bedroom_air_purifier_filter_life') }}% tilbage.
      related_entity_id: sensor.bedroom_air_purifier_filter_life
      entity_id: todo.todo_smart_todo
      is_active: '{{ states(''sensor.bedroom_air_purifier_filter_life'') | int(100)
        < 5 }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1771357000655'
  alias: Loftrum todo ventilationsanlæg
  description: Opret todo opgaver vedrørende filter m.m. på ventilationsanlæget i
    loftrummet
  triggers:
  - trigger: numeric_state
    entity_id: sensor.storage_ventilation_system_days_left_until_filter_change
    below: 1
  - trigger: numeric_state
    entity_id: sensor.storage_ventilation_system_days_left_until_filter_change
    above: 1
  - trigger: state
    entity_id: climate.storage_ventilation_system_ventilation
    attribute: fan_mode
    to:
    - 'off'
  - trigger: state
    entity_id: climate.storage_ventilation_system_ventilation
    attribute: fan_mode
    from:
    - 'off'
  - trigger: time
    at: 03:40:00
  - trigger: event
    event_type: todo_item_completed
    event_data:
      related: sensor.storage_ventilation_system_days_left_until_filter_change
    id: todo_completed
  conditions: []
  actions:
  - if:
    - condition: trigger
      id: todo_completed
    then:
    - action: button.press
      target:
        entity_id: button.storage_ventilation_system_reset_filter
    - action: input_boolean.toggle
      target:
        entity_id: input_boolean.storage_ventilation_system_replace_pollen_filter_next
    else:
    - action: script.create_todo_task
      data:
        subject: Udskift filter på ventilationsanlægget
        description: "Udskift {% if is_state('input_boolean.storage_ventilation_system_replace_pollen_filter_next',
          'on') %}\n  både Standardfilter (tynde blå) og Pollenfilter (tykke hvide)\n{%
          else %}\n  Standardfilter (tynde blå)\n{% endif %}\n på ventilationsanlægget
          på loftet.\n Husk at nulstille filter alarm til 90 dage."
        related_entity_id: sensor.storage_ventilation_system_days_left_until_filter_change
        entity_id: todo.todo_smart_todo
        is_active: '{{ states(''sensor.storage_ventilation_system_days_left_until_filter_change'')
          | int(99) < 1 }}'
  - variables:
      message: "{% set raw_list = states('sensor.storage_ventilation_system_active_alarm_list')
        %} {% set raw_count = states('sensor.storage_ventilation_system_active_alarm_count')
        | int(0) %} {% set alarms = raw_list.split('\\n') | map('trim') | reject('equalto','')
        | list %} {% set filtered = alarms | reject('search', 'Change filter') | list
        %} {% set removed = alarms | length - filtered | length %} {% set new_count
        = raw_count - removed %} {% if new_count < 0 %}\n  {% set new_count = 0 %}\n{%
        endif %} {% if new_count > 0 and filtered | length > 0 %} Antal alarmer: {{
        new_count }} Liste: {{ filtered | join('\\n') }} {% endif %}      "
  - action: script.create_todo_task
    data:
      subject: Alarm på ventilationsanlægget
      description: "Der er en eller flere alarmer på ventilationsanlægget. \n{{ message
        }}"
      related_entity_id: sensor.storage_ventilation_system_days_left_until_filter_change
      entity_id: todo.todo_smart_todo
      is_active: '{{ message | trim | length > 0 }}'
  - action: script.create_todo_task
    data:
      subject: Tænd ventilationsanlægget
      description: 'Ventilationsanlægget på loftet er slukket, tænd det igen. '
      related_entity_id: climate.storage_ventilation_system_ventilation
      entity_id: todo.todo_smart_todo
      is_active: '{{ is_state_attr(''climate.storage_ventilation_system_ventilation'',
        ''fan_mode'', ''off'') }}'
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1771522267634'
  alias: Soveværelse sover
  description: Styring af timer til soveværelse sover
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
    from: 'off'
    to: 'on'
    id: sleeping
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_sleeping
    from: 'on'
    to: 'off'
    id: waking
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - sleeping
      sequence:
      - action: timer.start
        metadata: {}
        data:
          duration: 00:30:00
        target:
          entity_id: timer.bedroom_sleeping_timer
    - conditions:
      - condition: trigger
        id:
        - waking
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.bedroom_sleeping_timer
  mode: queued
  max: 10
  trace:
    stored_traces: 20
- id: '1771616998173'
  alias: Hjem overvåg log
  description: Overvåg om der er fejl i loggen
  triggers:
  - trigger: event
    event_type: system_log_event
  conditions:
  - condition: template
    value_template: "{{ trigger.event.data.level in ['ERROR', 'WARNING'] and trigger.event.data.name
      != 'homeassistant.components.automation.home_monitor_log' }} \n"
  actions:
  - variables:
      filters:
        exclude:
          error:
          - name: ^homeassistant\.components\.twinkly
          - name: ^homeassistant\.components\.ipp\.coordinator$
          - name: ^homeassistant\.helpers\.translation$
            message: ^Error while parsing localized (da)
          - name: ^homeassistant\.components\.apple_tv$
            message: ^Failed to connect
          - name: ^homeassistant\.components\.apple_tv$
            message: ^Unloading .+ config entry
          - name: ^pyatv\.protocols\.companion$
            message: ^Could not fetch SystemStatus
          - name: ^custom_components\.sonnenbatterie$
            message: Timeout fetching sonnenbatterie data
          - name: ^homeassistant\.helpers\.dispatcher$
            message: Exception in async_signal_reachable_callback
          - name: ^homeassistant\.components\.unifi$
            message: ^Websocket disconnected$
          - name: ^aiounifi\.interfaces\.connectivity
          - name: ^frontend\.js\.modern
          - name: ^zigpy\.zcl$
          - name: ^homeassistant$
            message: ^Error doing job
          - name: ^pymiele\.pymiele$
            message: Not enough data to satisfy transfer length header
          - name: ^homeassistant\.components\.wallbox\.coordinator$
            message: Error fetching wallbox data
          - name: ^pysmartthings$
            message: Connection error occurred while subscribing to events
          - name: ^metno$
          - name: ^homeassistant\.components\.met\.coordinator$
            message: Error fetching met data
          - name: ^homeassistant\.components\.volvo\.coordinator^$
            message: Unable to update data
          - name: ^homeassistant\.components\.apple_tv\.media_player$
            message: Failed to update app list
        include:
          warning:
          - name: ^homeassistant\.helpers\.template$
          - name: ^homeassistant\.components\.script
            message: Already running$
          - name: ^homeassistant\.helpers\.service
            message: ^Referenced entities .+ are missing or not currently available
  - action: system_log.write
    data:
      level: debug
      message: 'name={{ trigger.event.data.name }}

        level={{ trigger.event.data.level }}

        message={{ trigger.event.data.message | default('''') }}

        trigger={{ trigger }}

        '
  - if:
    - condition: template
      value_template: "{% set name = trigger.event.data.name %} {% set level = trigger.event.data.level
        %} {% set raw = trigger.event.data.message | default('') %}\n{% if raw is
        string %}\n  {% set message = raw %}\n{% elif raw is iterable %}\n  {% set
        message = raw | join(' ') %}\n{% else %}\n  {% set message = raw | string
        %}\n{% endif %}\n{% set ns = namespace(\n    exclude=false,\n    include=false\n)
        %}      \n{% if level == 'ERROR' %}\n  {% for rule in filters.exclude.error
        %}\n    {% if name is search(rule.name) %}\n      {% if rule.message is not
        defined or message is search(rule.message) %}\n        {% set ns.exclude =
        true %}\n      {% endif %}\n    {% endif %}\n  {% endfor %}\n  {{ not ns.exclude
        }}\n{% elif level == 'WARNING' %}\n  {% for rule in filters.include.warning
        %}\n    {% if name is search(rule.name) %}\n      {% if rule.message is not
        defined or message is search(rule.message) %}\n        {% set ns.include =
        true %}\n      {% endif %}\n    {% endif %}\n  {% endfor %}\n  {{ ns.include
        }}\n{% else %}\n  false\n{% endif %}\n"
    then:
    - action: script.push_notification
      data:
        type: warning
        recipient: anders
        persistent: true
        title: '{{ trigger.event.data.level | title }} in Home Assistant Log'
        message: '{{ trigger }}

          '
  mode: queued
  max: 30
  trace:
    stored_traces: 100
- id: '1771692983110'
  alias: Bryggers vaskemaskine
  description: Skaber vaskemaskine status udfra strømforbrug
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    below: 2
    for:
      seconds: 10
    id: nothing
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    above: 2
    for:
      seconds: 3
    id: turned_on
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    above: 3
    for:
      seconds: 10
    id: planning
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_washer_power
    above: 50
    for:
      seconds: 10
    id: running
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: running
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_washer_state
        data:
          option: started
    - conditions:
      - condition: trigger
        id: nothing
      - condition: state
        entity_id: input_select.utility_room_washer_state
        state: started
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_washer_state
        data:
          option: finished
    - conditions:
      - condition: trigger
        id: turned_on
      - condition: state
        entity_id: input_select.utility_room_washer_state
        state: finished
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_washer_state
        data:
          option: emptied
    - conditions:
      - condition: trigger
        id: planning
      - condition: state
        entity_id: input_select.utility_room_washer_state
        state:
        - finished
        - emptied
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_washer_state
        data:
          option: planned
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1771697802150'
  alias: Bryggers tørretumbler
  description: Skaber tørretumbler status udfra strømforbrug
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    below: 3
    for:
      seconds: 5
    id: nothing
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    above: 3
    for:
      seconds: 3
    id: turned_on
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    above: 4
    for:
      seconds: 10
    id: planning
  - trigger: numeric_state
    entity_id:
    - sensor.utility_room_smart_plug_dryer_power
    above: 50
    for:
      seconds: 3
    id: running
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: running
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_dryer_state
        data:
          option: started
    - conditions:
      - condition: trigger
        id: nothing
      - condition: state
        entity_id: input_select.utility_room_dryer_state
        state: started
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_dryer_state
        data:
          option: finished
    - conditions:
      - condition: trigger
        id: turned_on
      - condition: state
        entity_id: input_select.utility_room_dryer_state
        state: finished
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_dryer_state
        data:
          option: emptied
    - conditions:
      - condition: trigger
        id: planning
      - condition: state
        entity_id: input_select.utility_room_dryer_state
        state:
        - finished
        - emptied
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.utility_room_dryer_state
        data:
          option: planned
  mode: queued
  max: 10
  trace:
    stored_traces: 30
- id: '1771745687585'
  alias: Hjem overvåg netværk
  description: Overvåg internet og netværks enheder
  triggers:
  - trigger: time_pattern
    hours: /1
  conditions: []
  actions:
  - variables:
      min_speed: 300
      max_ping: 20
      max_latency: 25
      max_cpu: 80
      max_memory: 90
      download: '{{ states(''sensor.internet_speed_download'') | float(0) }}'
      upload: '{{ states(''sensor.internet_speed_upload'') | float(0) }}'
      ping: '{{ states(''sensor.internet_speed_ping'') | float(0) }}'
      wan_google: '{{ states(''sensor.technic_room_cloud_gateway_google_wan_latency'')
        | float(0) }}'
      wan_cloudflare: '{{ states(''sensor.technic_room_cloud_gateway_cloudflare_wan_latency'')
        | float(0) }}'
      unifi_devices:
      - sensor.technic_room_cloud_gateway
      - sensor.emils_room_network_switch
      - sensor.garage_network_switch
      - sensor.living_room_network_switch
      - sensor.hallway_accesspoint
      - sensor.living_room_accesspoint
      - sensor.garage_accesspoint
      - sensor.patio_accesspoint
      unifi_problems: "{% set ns = namespace(list=[]) %} {% for base in unifi_devices
        %}\n  {% set state_sensor = base ~ '_state' %}\n  {% set cpu_sensor = base
        ~ '_cpu_utilization' %}\n  {% set memory_sensor = base ~ '_memory_utilization'
        %}\n  {% set state = states(state_sensor) | lower %}\n  {% set cpu = states(cpu_sensor)
        | float(0) %}\n  {% set memory = states(memory_sensor) | float(0) %}\n  {%
        set dev_id = device_id(state_sensor) %}\n  {% if dev_id %}\n    {% set dev_name
        = device_attr(dev_id,'name_by_user') if device_attr(dev_id,'name_by_user')
        else device_attr(dev_id,'name') %}\n  {% else %}\n    {% set dev_name = base
        %}\n  {% endif %}\n  {% set issues = [] %}\n  {% if state != 'connected' %}\n
        \   {% set issues = issues + ['ikke forbundet (' ~ state ~ ')'] %}\n  {% endif
        %}\n  {% if cpu > max_cpu %}\n    {% set issues = issues + ['CPU ' ~ cpu ~
        '%'] %}\n  {% endif %}\n  {% if memory > max_memory %}\n    {% set issues
        = issues + ['Hukommelse ' ~ memory ~ '%'] %}\n  {% endif %}\n  {% if issues
        | length > 0 %}\n    {% set ns.list = ns.list + [dev_name ~ ': ' ~ issues
        | join(', ')] %}\n  {% endif %}\n{% endfor %} {{ ns.list }}\n"
      problems: "{% set issues = [] %} {% if download < min_speed %}\n  {% set issues
        = issues + ['Download under ' ~ min_speed ~ ' Mbps (' ~ download ~ ')'] %}\n{%
        endif %} {% if upload < min_speed %}\n  {% set issues = issues + ['Upload
        under ' ~ min_speed ~ ' Mbps (' ~ upload ~ ')'] %}\n{% endif %} {% if ping
        > max_ping %}\n  {% set issues = issues + ['Ping for høj (' ~ ping ~ ' ms)']
        %}\n{% endif %} {% if wan_google > max_latency %}\n  {% set issues = issues
        + ['Google WAN latency høj (' ~ wan_google ~ ' ms)'] %}\n{% endif %} {% if
        wan_cloudflare > max_latency %}\n  {% set issues = issues + ['Cloudflare WAN
        latency høj (' ~ wan_cloudflare ~ ' ms)'] %}\n{% endif %} {% if unifi_problems
        | length > 0 %}\n  {% set issues = issues + unifi_problems %}\n{% endif %}
        {{ issues }}\n"
  - if:
    - condition: template
      value_template: '{{ problems | length > 0 }}'
    then:
    - action: system_log.write
      data:
        level: warning
        message: 'Netværksproblem: {{ problems }}'
    - action: script.push_notification
      data:
        type: info
        recipient: anders
        persistent: true
        id: home_monitor_network
        title: Netværksproblem opdaget
        message: '{{ problems | join(''\n'') }}

          '
  mode: single
  trace:
    stored_traces: 20
