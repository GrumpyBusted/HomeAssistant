- binary_sensor:
    - name: anders_home
      unique_id: 853ACC48-200B-4607-B47B-CA9BB9BA0E84
      device_class: presence
      state: >-
        {{ is_state('person.anders', 'home') or is_state('sensor.anders_iphone_ssid', 'Palantir')  }}
      icon: >-
        {% if is_state('binary_sensor.anders_home', 'on') %}
        mdi:account
        {% else %}
        mdi:account-outline
        {% endif %}
- binary_sensor:
    - name: monique_home
      unique_id: 38C5ECC5-28B8-46B5-BED7-53625445DFCB
      device_class: presence
      state: >-
        {{ is_state('person.monique', 'home') or is_state('sensor.monique_iphone_ssid', 'Palantir')  }}
      icon: >-
        {% if is_state('binary_sensor.monique_home', 'on') %}
        mdi:account
        {% else %}
        mdi:account-outline
        {% endif %}
- binary_sensor:
    - name: emil_home
      unique_id: C0544736-ACBB-4C1C-8874-8E18558E8CF5
      device_class: presence
      state: >-
        {{ is_state('person.emil', 'home') or is_state('sensor.emil_iphone_ssid', 'Palantir') }}
      icon: >-
        {% if is_state('binary_sensor.emil_home', 'on') %}
        mdi:account
        {% else %}
        mdi:account-outline
        {% endif %}
- binary_sensor:
    - name: charlie_home
      unique_id: 40083A08-3457-4093-89DC-95E41E763766
      device_class: presence
      state: >-
        {{ is_state('person.charlie', 'home') or is_state('sensor.charlie_iphone_ssid', 'Palantir')  }}
      icon: >-
        {% if is_state('binary_sensor.charlie_home', 'on') %}
        mdi:account
        {% else %}
        mdi:account-outline
        {% endif %}
- binary_sensor:
    - name: parent_home
      unique_id: 1FB2A489-CADC-4F4A-A521-66597D9D6812
      device_class: presence
      state: >-
        {{ is_state('binary_sensor.monique_home', 'on') or 
           is_state('binary_sensor.anders_home', 'on') }}
      icon: >-
        {% if is_state('binary_sensor.parent_home', 'on') %}
        mdi:account-multiple
        {% else %}
        mdi:account-multiple-outline
        {% endif %}
- binary_sensor:
    - name: "family_home"
      unique_id: 557DD664-F523-4959-B4D7-D6BF9355422E
      device_class: presence
      state: >-
        {{ is_state('binary_sensor.parent_home', 'on') or 
           is_state('binary_sensor.emil_home', 'on') or 
           is_state('binary_sensor.charlie_home', 'on') }}
      icon: >-
        {% if is_state('binary_sensor.parent_home', 'on') %}
        mdi:account-group
        {% else %}
        mdi:account-group-outline
        {% endif %}
- binary_sensor:
    - name: "bedroom_occupancy"
      unique_id: 0A2C2AAA-7F34-484D-9BA5-8031FEDF0E11
      state: >-
        {{ is_state('binary_sensor.bedroom_presence_sensor_occupancy', 'on') or 
           is_state('timer.bedroom_presence_timer', 'active') }}
      icon: >-
        {% if is_state('binary_sensor.bedroom_people_present', 'on') %}
        mdi:location-enter
        {% else %}
        mdi:location-exit
        {% endif %}
- binary_sensor:
    - name: "parent_sleeping"
      unique_id: 6CB2BD82-9ACE-4100-B7B8-DF17E10DD692
      state: >-
        {{ states('sensor.people_home') | int > 0 and 
           not(is_state('media_player.bedroom_apple_tv_media_player', 'playing')) and 
           is_state('binary_sensor.bedroom_occupancy', 'on') and 
           is_state('binary_sensor.bedroom_blind', 'off') and 
           is_state('binary_sensor.bedroom_light', 'off') }}
      icon: >-
        {% if is_state('binary_sensor.parent_sleeping', 'on') %}
        mdi:sleep
        {% else %}
        mdi:sleep-off
        {% endif %}
- binary_sensor:
    - name: "emil_sleeping"
      unique_id: 51259E4B-BF87-448A-839D-0C1996331806
      state: >-
        {{ is_state('binary_sensor.emil_home', 'on') and 
           not(is_state('media_player.emils_room_apple_tv_media_player', 'playing')) and 
           is_state('binary_sensor.emils_room_blind', 'off') and 
           is_state('binary_sensor.emils_room_light', 'off') }}
      icon: >-
        {% if is_state('binary_sensor.emil_sleeping', 'on') %}
        mdi:sleep
        {% else %}
        mdi:sleep-off
        {% endif %}
- binary_sensor:
    - name: "charlie_sleeping"
      unique_id: 56C0C9A8-6803-4F0F-8C5F-9FC9B67D9694
      state: >-
        {{ is_state('binary_sensor.charlie_home', 'on') and 
           not(is_state('media_player.charlies_room_apple_tv_media_player', 'playing')) and 
           is_state('binary_sensor.charlies_room_blind', 'off') and 
           is_state('binary_sensor.charlies_room_light', 'off') }}
      icon: >-
        {% if is_state('binary_sensor.charlie_sleeping', 'on') %}
        mdi:sleep
        {% else %}
        mdi:sleep-off
        {% endif %}
- binary_sensor:
    - name: "everyone_sleeping"
      unique_id: 879F46F0-962B-4061-8BD3-15C179BD85D3
      state: >-
        {{ is_state('binary_sensor.charlie_sleeping', 'on') and 
           is_state('binary_sensor.emil_sleeping', 'on') and 
           is_state('binary_sensor.parent_sleeping', 'on') }}
      icon: >-
        {% if is_state('binary_sensor.charlie_sleeping', 'on') %}
        mdi:sleep
        {% else %}
        mdi:sleep-off
        {% endif %}
- sensor:
    - name: people_home
      unique_id: 13A8D2F1-2B67-45C3-8B9D-4A0D1D12F3C8
      state: >-
        {{
          (is_state('binary_sensor.anders_home', 'on') | int ) +
          (is_state('binary_sensor.monique_home', 'on') | int ) +
          (is_state('binary_sensor.charlie_home', 'on') | int ) +
          (is_state('binary_sensor.emil_home', 'on') | int ) +
          (is_state('input_boolean.house_sitter', 'on') | int ) 
        }}
      unit_of_measurement: ""
      icon: >-
        {% if is_state('sensor.people_home', '0') %}
        mdi:account-off-outline
        {% else %}
        mdi:account
        {% endif %}