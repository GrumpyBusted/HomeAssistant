- sensor:
    - name: volvo_xc40_last_data_update
      unique_id: BDF4FC26-6851-45B8-BE7A-0E764DC77805
      device_class: timestamp
      icon: "mdi:update"
      state: >-
        {% if states('sensor.volvo_ex30_api_status') == 'OK' %}
          {{ state_attr('sensor.volvo_ex30_api_status', 'last_refresh') }}
        {% else %}
          {{ 'unavailable' }}
        {% endif %}
- sensor:
    - name: volvo_ex30_last_data_update
      unique_id: E0DB55B9-0E3F-4E79-877E-DF9BDB1F0D55
      device_class: timestamp
      icon: "mdi:update"
      state: >-
        {% if states('sensor.volvo_xc40_api_status') == 'OK' %}
          {{ state_attr('sensor.volvo_xc40_api_status', 'last_refresh') }}
        {% else %}
          {{ 'unavailable' }}
        {% endif %}
- sensor:
    - name: volvo_xc40_status
      unique_id: 47C6E31A-970F-42C5-B73E-ABF27C439AA9
      device_class: connectivity
      state: >-
        {% if states('sensor.volvo_xc40_last_data_update') != 'unavailable' and
              states('sensor.volvo_xc40_last_data_update') | as_datetime +
              timedelta(seconds=states('number.volvo_xc40_data_update_interval')|int + 10) >
              now() %}
          available
        {% else %}
          unavailable
        {% endif %}
      icon: >-
        {% if states('binary_sensor.volvo_xc40_availability') == 'available' %}
          mdi:check-circle
        {% else %}
          mdi:close-circle
        {% endif %}
- sensor:
    - name: volvo_ex30_status
      unique_id: 039553C2-9CD7-41F6-9FD8-1246CBF26864
      device_class: connectivity
      state: >-
        {% if states('sensor.volvo_ex30_last_data_update') != 'unavailable' and
              states('sensor.volvo_ex30_last_data_update') | as_datetime +
              timedelta(seconds=states('number.volvo_ex30_data_update_interval')|int + 10) >
              now() %}
          available
        {% else %}
          unavailable
        {% endif %}
      icon: >-
        {% if states('binary_sensor.volvo_ex30_availability') == 'available' %}
          mdi:check-circle
        {% else %}
          mdi:close-circle
        {% endif %}
